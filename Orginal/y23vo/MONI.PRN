	MACRO-80 V3.50	25-Oct-85	Page	1


                                .z80
  0000'                         aseg
                                org	100h
                         C      include	EQU.MAC 
                         C      
                         C      ;10.10.88
                         C      ;DEFINITION VON KONSTANTEN
                         C      ;Schalter
  0001                   C      V24	EQU	1		;DRUCKERSCHNITTSTELLE
  0001                   C      GC	EQU	1		;CONSOLEAUSGABE  = GRAFIK-BILDSCHIRM
                         C      ;zeichenorientierter Eingabekanal "rdr:"
  00F3                   C      rmsk	equ	0f3h		;Maske
  0000                   C      IT	EQU	0		;"IN"-GERAET   I = TERMINAL (TASTATUR)
  0004                   C      IP	EQU	4		;"IN"-GERAET   I = Fernschreiber PIO A	
  0008                   C      IS	EQU	8		;"IN"-GERAET   I = Stromschleife SIO B
  000C                   C      IU	EQU	0CH		;"IN"-GERAET   I = VOM ANWENDER IM RAM DEFINIERT
                         C      ;zeichenorientierter Ausgabekanal "pun:"
  00CF                   C      pmsk	equ	0cfh		;Maske
  0000                   C      OT	EQU	0		;"OUT"-GERAET  O = TERMINAL (BILDSCHIRM)
  0010                   C      OP	EQU	10H		;"OUT"-GERAET  O = Fernschreiber PIO A
  0020                   C      OS	EQU	20H		;"OUT"-GERAET  O = Stromschleife SIO B
  0030                   C      OU	EQU	30H		;"OUT"-GERAET  O = VOM ANWENDER DEF. GERAET
                         C      ;Druckerkanal "lst:"	
  003F                   C      lmsk	equ	03fh		;Maske 
  0000                   C      LT	EQU	0		;LIST-GERAET   L = TERMINAL (BILDSCHIRM)
  0040                   C      LV	EQU	40H		;LIST-GERAET   L = V24-Schnittstelle SIO A
  0080                   C      LC	EQU	80H		;LIST-GERAET   L = Centronics-Schnittstelle 
  00C0                   C      LU	EQU	0C0H		;LIST-GERAET   L = VOM ANWENDER DEF. GERAET
  0003                   C      ETX	EQU	003H		;CONTROL/C ( OF TEXT)
  0027                   C      APST	EQU	27H		;APOSTROPH 
  0002                   C      NDISK	EQU	2		;ANZAHL LAUFWERKE,1 IM RAM SIMULIERT
                         C      
                         C      ;Speicheradressen
  C000                   C      MONITOR	EQU	0C000h		;Anfang Monitorprogramm
  BE00                   C      BIOS	EQU	0BE00H		;49K-cpm 
  B000                   C      BDOS	EQU	BIOS-0E00H
  A800                   C      CCP	EQU	BIOS-1600H
  7000                   C      RDSK	EQU	7000H		;IM RAM SIMULIERTE FLOPPY
  F500                   C      eom	equ	0F500h		;Beginn Systemram fuer Monitor
  F600                   C      gdcram	equ	0F600h		;Ramtabelle Grafik-Controller
  F5CA                   C      STACK	EQU	eom+0cah
  FC00                   C      BRAM	EQU	0FC00H		;BILDSCHIRM-RAM
  B400                   C      ASS	EQU	0B400H		;Assembler
  8000                   C      BASIC	EQU	8000H
  B000                   C      TEXT	EQU	0B000h		;TEXTEDITOR
                         C      
                         C      ;Adressen von Peripherieschaltkreisen
                         C      ;PIO auf CPU-Karte
  00FC                   C      PIOAD	EQU	0FCH		;DATENAUSGABE KANAL A
  00FD                   C      PIOBD	EQU	0FDH		;EINGABEDATEN tastatur
  00FE                   C      PIOAC	EQU	0FEH		;STEUERADRESSE KANAL A
  00FF                   C      PIOBC	EQU	0FFH		;STEUERADRESSE KANAL B
                         C      
                         C      ;Grafik-Display-Controller 7220	;lesen		schreiben
  008E                   C      gdcc	equ	8eh		;status		daten 
  008F                   C      gdcd	equ	8fh		;daten 		kommando
                         C      
                         C      ;CTC-SIO-Karte
  006C                   C      ctca	equ	6ch		;taktgeber fuer sio a
  006D                   C      ctcb	equ	6dh		;taktgeber fuer sio b
  006F                   C      ctcd	equ	6fh		;zeitgeber uhr
  0078                   C      sioad	equ	78h		;sio kanal a: v24/kassette
  0079                   C      siobd	equ	79h		;sio kanal b: stromschleife
  007A                   C      sioac	equ	7ah
  007B                   C      siobc	equ	7bh
	MACRO-80 V3.50	25-Oct-85	Page	1-1


                         C      
                         C      
                         C      ;Floppy-Disk-Controller 8272/765
  0040                   C      CFDC	EQU	40H		;STEUERUNG FDC
  0041                   C      DFDC	EQU	41H		;DATEN FDC
  0050                   C      TC	EQU	50H		;TERMINAL COUNT (ENDE-IMPULS) 
                         C      
                         C      ;2PIO-Karte, Centronics-Schnittstelle 
  00AC                   C      p1ad	equ	0ACh		;Daten 
  00AD                   C      p1bd	equ	0ADh		;Steuerung Drucker
  00AE                   C      p1ac	equ	0AEh
  00AF                   C      p1bc	equ	0AFh
                         C      
                         C      
                         C      
                         C      
                                .phase	monitor
                                if	monitor
                                ;hochkopieren
  C000    21 0100               	ld	hl,100h		;Programmanfang
  C003    11 C000               	ld	de,monitor	;Ziel im Ram
  C006    01 1FFF               	ld	bc,1fffh	;8 K Byte
  C009    ED B0                 	ldir
  C00B    C3 C00E               	jp	begin
  C00E                          anf	equ	$
                                endif
                         C      include IO.MAC
                         C      .z80
                         C      	SUBTTL	'Ein-/Ausgabe-Routinen'
                         C      
  C00E    21 F5CA        C      BEGIN:	LD	HL,STACK	;ZIEL
  C011    11 C7CA        C      	LD	DE,TOS		;QUELLE
  C014    01 0036        C      	LD	BC,LTOS		;LAENGE
  C017    F9             C      	LD	SP,HL
  C018    EB             C      	EX	DE,HL
  C019    ED B0          C      	LDIR
  C01B    CD C10B        C      	call	init	;initialisierung peripherieschaltkreise	
  C01E    21 F5DF        C      	LD	HL,SLOC		;USER-STACK
  C021    74             C      	LD	(HL),H
  C022    35             C      	DEC	(HL)
                         C      if	monitor
  C023    3E C3          C      	ld	a,0c3h		;Haltepunkt vorbereiten
  C025    32 0038        C      	ld	(38h),a	
  C028    21 C800        C      	ld	hl,restr
  C02B    22 0039        C      	ld	(39h),hl
                         C      endif
  C02E    21 C04A        C      	LD	HL,RUFZ		;CALL-AUSGABE
  C031    CD C0F8        C      	CALL	STR
  C034    18 21          C      	JR	START
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      if	monitor
                         C      else
                         C      org	monitor+20h
                         C      endif
                         C      ;SUBR. Zur AUSgabe Eines ZEICHENS UEBer TERMINAL
                         C      ;***IN: ZEICHEN AUF SPEICHERPLATZ HINTER CALL
                         C      ;**OUT: C...ZEICHEN
                         C      ;       (SP)=(SP)+1
                         C      ;*KILL: A,F,C
  C036    E3             C      COMC::	EX	(SP),HL
  C037    4E             C      	LD	C,(HL)
  C038    23             C      	INC	HL
  C039    E3             C      	EX	(SP),HL
  C03A    C3 C0E6        C      	JP	MCO 
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
	MACRO-80 V3.50	25-Oct-85	Page	1-2
'Ein-/Ausgabe-Routinen'

                         C      if	monitor
                         C      else
                         C      org	monitor+28h
                         C      endif
                         C      ;ZEITSCHLEIFE
  C03D    E5             C      ZS::	PUSH	HL
  C03E    F5             C      	PUSH	AF
  C03F    2A F5FC        C      	LD	HL,(ZK)
  C042    2B             C      ZS1:	DEC	HL
  C043    7C             C      	LD	A,H
  C044    B5             C      	OR	L
  C045    20 FB          C      	JR	NZ,ZS1
  C047    F1             C      	POP	AF
  C048    E1             C      	POP	HL
  C049    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      if	monitor
                         C      else
                         C      	ORG	Monitor+38H
                         C      	JP	RESTR
                         C      endif
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
  C04A    59 32 33       C      RUFZ:	DB	'Y23'
  C04D    56 4F          C      	DB	'VO'
  C04F    00             C      	DB	00H
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
  C050    31 F5CA        C      ERROR::	LD	SP,STACK	;STACK RESET
  C053    CD C036        C      	CALL	COMC
  C056    3F             C      	DB	'?'		;FEHLERMELDUNG
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;ANFORDERUNG EINES KOMMANDOS
  C057    CD C320        C      START::	CALL	CRLF		;LEERZEILE
  C05A    CD C329        C      	CALL	TON
  C05D    CD C036        C      	CALL	COMC
  C060    3E             C      	DB	'>'
                         C      ;RETTEN DER STARTADRESSE
  C061    11 C057        C      	LD	DE,START
  C064    D5             C      	PUSH	DE
                         C      ;EINGABE PROGRAMMNAME
  C065    CD C174        C      	CALL	TI		;ZEICHENEINGABE+ECHO
  C068    21 C08F        C      	LD	HL,JPTBL	;SPRUNGTABELLE
  C06B    CD C073        C      	CALL	FCGA		;SUCHE
  C06E    38 E0          C      	JR	C,ERROR		;WENN NICHT GEFUNDEN
  C070    0E 02          C      	LD	C,2		;PARAMETERANZAHL
  C072    E9             C      	JP	(HL)
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;                SUBROUTINEN
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      if	monitor
                         C      else
                         C      ;NMI-EINSPRUNG
                         C      ORG	Monitor+66H
                         C      	LD	HL,RAMJP
                         C      	EX	(SP),HL
                         C      	EI
                         C      	RETN
                         C      endif
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBROUTINE VERZWEIGUNG
                         C      ;IN:  ZEICHEN IN A
                         C      ;     TABELLENADRESSE IN HL
                         C      ;OUT: CY=0:HL=ADR,CY=1:Nicht gefunden
  C073    D5             C      FCGA::	PUSH	DE
  C074    5F             C      	LD	E,A		;ZEICHEN
  C075    7E             C      FCGA1:	LD	A,(HL)
	MACRO-80 V3.50	25-Oct-85	Page	1-3
'Ein-/Ausgabe-Routinen'

  C076    FE FF          C      	CP	0ffh		;tabellenende
  C078    28 11          C      	JR	Z,FCGA3
  C07A    BB             C      	CP	E
  C07B    28 05          C      	JR	Z,FCGA2		;gefunden
  C07D    23             C      	INC	HL
  C07E    23             C      	INC	HL
  C07F    23             C      	INC	HL
  C080    18 F3          C      	JR	FCGA1
  C082    7B             C      FCGA2:	LD	A,E
  C083    23             C      	INC	HL
  C084    5E             C      	LD	E,(HL)
  C085    23             C      	INC	HL
  C086    56             C      	LD	D,(HL)
  C087    23             C      	INC	HL
  C088    EB             C      	EX	DE,HL
  C089    18 02          C      	JR	FCGA4
  C08B    37             C      FCGA3:	SCF			;nicht gefunden
  C08C    7B             C      	LD	A,E
  C08D    D1             C      FCGA4:	POP	DE
  C08E    C9             C      	RET
                         C      ;ADRESSTABELLE KOMMANDOS
  C08F    41             C      JPTBL:	DB	'A'
  C090    C366           C      	DW	ASGN		;Peripheriegeraete zuweisen 
  C092    42             C      	DB	'B'
  C093    8000           C      	DW	BASIC		;sprung in basic
  C095    43             C      	DB	'C'
  C096    C970           C      	DW	COPY		;eingabe- auf ausgabekanal
  C098    44             C      	DB	'D'
  C099    C97C           C      	DW	DISP		;speicher darstellen 
  C09B    45             C      	DB	'E'
  C09C    C99D           C      	DW	EOF		;endezeichen intel-hex-code
  C09E    46             C      	DB	'F'
  C09F    C9C1           C      	DW	FILL		;speicher fuellen
  C0A1    47             C      	DB	'G'
  C0A2    C9CF           C      	DW	GOTO		;programmstart
  C0A4    48             C      	DB	'H'
  C0A5    CA0C           C      	DW	HEXN		;hexadezimalarithmetik
  C0A7    49             C      	DB	'I'
  C0A8    C642           C      	DW	LD		;Kassetteneingabe
  C0AA    4A             C      	DB	'J'		
  C0AB    F5E4           C      	DW	RAMJP		;sprung in ram
  C0AD    4B             C      	DB	'K'
  C0AE    CAD5           C      	DW	KNOW		;speichertest
  C0B0    4C             C      	DB	'L'
  C0B1    C3D0           C      	DW	LINK		;Terminalbetrieb
  C0B3    4D             C      	DB	'M'
  C0B4    CA23           C      	DW	MOVE		;speicherinhalt verschieben 
  C0B6    4E             C      	DB	'N'
  C0B7    D000           C      	DW	bium		;sprung in cp/y2
  C0B9    4F             C      	DB	'O'
  C0BA    C63A           C      	DW	SV		;Kassettenausgabe
  C0BC    50             C      	DB	'P'
  C0BD    CC00           C      	DW	PRINT		;DISASSEMBLER
  C0BF    51             C      	DB	'Q'
  C0C0    CA36           C      	DW	query		;Abfrage Zuweisung
  C0C2    52             C      	DB	'R'
  C0C3    CA67           C      	DW	READ		;intel-hex-code lesen
  C0C5    53             C      	DB	'S'
  C0C6    CAB9           C      	DW	SUBS		;speicherinhalt ersetzen
  C0C8    54             C      	DB	'T'
  C0C9    B000           C      	DW	TEXT		;sprung in texteditor
  C0CB    56             C      	DB	'V'
  C0CC    CB32           C      	DW	VER		;speicherinhalt vergleichen
  C0CE    57             C      	DB	'W'
  C0CF    CAF3           C      	DW	WRITE		;intel-hex-code schreiben
	MACRO-80 V3.50	25-Oct-85	Page	1-4
'Ein-/Ausgabe-Routinen'

  C0D1    58             C      	DB	'X'
  C0D2    CB4B           C      	DW	X		;register anzeigen
  C0D4    59             C      	DB	'Y'
  C0D5    0000           C      	DW	0		;speicher ein-/ausschalten
  C0D7    5A             C      	DB	'Z'		
  C0D8    CBCB           C      	DW	ZR		;zweitregister anzeigen
  C0DA    FF             C      	DB	0ffh		;tabellenendekennzeichen
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
  C0DB                   C      ds	monitor+0E0H-$,0ffh
  C0E0    C3 C3F4        C      MCI::	JP	CI		;CONSOLE INPUT =TASTATUR
  C0E3    C3 C197        C      MRI::	JP	RI		;READER INPUT  =LESEKANAL
  C0E6    C3 C18C        C      MCO::	JP	CO		;CONSOLE OUTPUT=BILDSCHIRM
  C0E9    C3 C1C8        C      MWO::	JP	WO		;WRITE OUTPUT  =SCHREIBKANAL
  C0EC    C3 C1E3        C      MLO:: 	JP	LO		;LISTER OUTPUT =DRUCKER
  C0EF    C3 C49E        C      MCSTS:	JP	CSTS		;CONSOLE STATUS
  C0F2    C3 C102        C      MIOC:	JP	IOCHK
  C0F5    C3 C106        C      MIOS:	JP	IOSET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBROUTINE ZUR AUSGABE EINER ZEICHENFOLGE,ABSCHLUSS DER FOLGE MIT 00
                         C      ;***IN: ANFANGSADR. IN HL
                         C      ;**OUT: -
                         C      ;*KILL: AF,HL
  C0F8    7E             C      STR:	LD	A,(HL)
  C0F9    4F             C      	LD	C,A
  C0FA    23             C      	INC	HL
  C0FB    B7             C      	OR	A
  C0FC    C8             C      	RET	Z
  C0FD    CD C0E6        C      	CALL	MCO
  C100    18 F6          C      	JR	STR
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR ABFRAGE DER AKTUELLEN GERAETEZUWEISUNG
                         C      ;***IN: -
                         C      ;**OUT: A...AKTUELLE ZUWEISUNG
                         C      ;*KILL: A
  C102    3A F5FF        C      IOCHK:	LD	A,(IOBYT)
  C105    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR VERAENDERUNG DER AKT. GERAETEZUWEISUNG
                         C      ;***IN: C...NEUE GERAETEZUWEISUNG
                         C      ;**OUT: -
                         C      ;*KILL: A
  C106    79             C      IOSET:	LD	A,C
  C107    32 F5FF        C      	LD	(IOBYT),A
  C10A    C9             C      	RET
                         C      ;-----------------------------------------------------------
                         C      ;Initialisierung Peripherieschaltkreise
                         C      ;PROGRAMMIERUNG PIO FUER TASTATUR
  C10B    06 03          C      init:	LD	B,LPIOA		;LAENGE
  C10D    0E FE          C      	LD	C,PIOAC		;ADRESSE PORT A COMMANDO
  C10F    21 C15B        C      	LD	HL,TPIOA	;TAB.-ANFANG
  C112    ED B3          C      	OTIR
  C114    06 03          C      	LD	B,LPIOB
  C116    0C             C      	INC	C
  C117    ED B3          C      	OTIR
                         C      ;Initialisierung SIOA f.V24 AUSGABE
                         C      ;1200 Baud 8 Bit 
  C119    3E 05          C      iv24:	ld	a,5		;Bytes f}r CTC
  C11B    D3 6C          C      	out	(ctca),a
  C11D    3E 0D          C      	ld	a,13	
  C11F    D3 6C          C      	out	(ctca),a
  C121    06 07          C      	ld	b,lsioa		;Anzahl Bytes f}r SIO
  C123    0E 7A          C      	ld	c,sioac		;Zieladresse SIO
  C125    ED B3          C      	otir
                         C      ;Rechnerkopplung mit Stromschleife 20mA; 600 Baud 
                         C      ;SIOB
	MACRO-80 V3.50	25-Oct-85	Page	1-5
'Ein-/Ausgabe-Routinen'

  C127    3E 05          C      	LD	A,5		;Initialisierung CTC 
  C129    D3 6D          C      	OUT	(CTCb),A
  C12B    3E 08          C       	LD	A,8		
  C12D    D3 6D          C      	OUT	(CTCb),A
  C12F    06 07          C      	LD	B,lsiob		;Initialisierung SIO
  C131    0E 7B          C      	LD	C,SIObC		;Statusport
  C133    ED B3          C      	OTIR
                         C      ;drucker mit CENTRONICS-Schnittstelle
                         C      ;2-PIO-Karte
  C135    3E CF          C      	ld	a,0cfh
  C137    D3 AE          C      	out	(p1ac),a
  C139    AF             C      	xor	a
  C13A    D3 AE          C      	out	(p1ac),a
  C13C    3E CF          C      	ld	a,0cfh
  C13E    D3 AF          C      	out	(p1bc),a
  C140    3E 02          C      	ld	a,2
  C142    D3 AF          C      	out	(p1bc),a
  C144    3E 03          C      	ld	a,3
  C146    D3 AE          C      	out	(p1ac),a
  C148    D3 AF          C      	out	(p1bc),a
  C14A    3E FF          C      	ld	a,0ffh
  C14C    D3 AD          C      	out	(p1bd),a
                         C      ;test, ob grafik-kontroller vorhanden ist
  C14E    DB 8E          C      	in	a,(gdcc)
  C150    E6 02          C      	and	2
  C152    CC D600        C      	call	z,inigdc	;wenn vorhanden
  C155    0E 0C          C      	ld	c,0ch		;bildsch. loeschen
  C157    CD C0E6        C      	call	MCO
  C15A    C9             C      	RET
                         C      ;pio-tabellen
  C15B    CF C0 07       C      TPIOA:	DB	0CFH,0C0H,7
  0003                   C      LPIOA	EQU	$-TPIOA
  C15E    CF FF 07       C      TPIOB:	DB	0CFH,0FFH,7
  0003                   C      LPIOB	EQU	$-TPIOB   
                         C      ;sio-tabellen
  C161    18 04 44 03    C      TSIOA:	DEFB 	18h,4,044H,3,0c1H,5,68H	;Cx16, 1 Stop, 8bit, keine parit{t
  C165    C1 05 68       C      
  0007                   C      lsioa	equ	$-tsioa
  C168    18 04 C4 05    C      Tsiob:	db	18h,4,0C4h,5,28h,3,41h	;Cx64, 1 Stop, 7Bit, keine Parit{t
  C16C    28 03 41       C      
  0007                   C      lsiob	equ	$-tsiob
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUM TEST, OB UNTERBRECHUNG EINGEGEBEN WURDE
                         C      ;***IN: -
                         C      ;**OUT: A=0...KEIN ZEICHEN
                         C      ;       A SONST...ZEICHEN
                         C      ;*KILL: A,F
  C16F    CD C49E        C      BREAK:	CALL	CSTS
  C172    B7             C      	OR	A
  C173    C8             C      	RET	Z
                         C      ;*---*--*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE EINES ASCII-ZEICHENS UEBER DAS TERMINAL
                         C      ;UND AUSGABE DES ECHOS
                         C      ;***IN: -
                         C      ;**OUT: A...ZEICHEN
                         C      ;*KILL: A,F
  C174    C5             C      TI::	PUSH	BC
  C175    CD C0E0        C      	CALL	MCI
  C178    FE 03          C      	CP	ETX
  C17A    CA C057        C      	JP	Z,START
  C17D    4F             C      	LD	C,A
  C17E    CD C0E6        C      	CALL	MCO
  C181    79             C      	LD	A,C
  C182    CB 77          C      	BIT	6,A		;KLEINBUCHSTABE ?
  C184    28 02          C      	JR	Z,TI1
	MACRO-80 V3.50	25-Oct-85	Page	1-6
'Ein-/Ausgabe-Routinen'

  C186    CB AF          C      	RES	5,A
  C188    C1             C      TI1:	POP	BC
  C189    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE EINES LEERZEICHENS UEBER BILDSCHIRM
  C18A    0E 20          C      BLK::	LD	C,' '
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE UEBER BILDSCHIRM MIT TEST AUF CTRL/C
                         C      ;***IN: C...ZEICHEN
                         C      ;**OUT: -
                         C      ;*KILL: A,F
  C18C    3A F5FF        C      CO:	LD	A,(IOBYT)
  C18F    E6 03          C      	AND	03H		
  C191    C2 F603        C      	JP	NZ,gdcco	;Grafikbildschirm	
  C194    C3 C4FE        C      	JP	bs1co		;alphanumerischer Bildschirm
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE EINES ZEICHENS UEBER DAS GERAET rdr:
                         C      ;***IN: -
                         C      ;**OUT: A...ZEICHEN
  C197    3A F5FF        C      RI::	LD	A,(IOBYT)
  C19A    E6 0C          C      	AND	0CH		;bits ausblenden
  C19C    CA C0E0        C      	JP	Z,MCI		;EINGABE UEBER TASTATUR
  C19F    FE 04          C      	CP	IP
  C1A1    28 10          C      	jr	z,fep		;Fernschrebeingabe pio 
  C1A3    FE 08          C      	cp	is
  C1A5    C2 F5F3        C      	JP	nz,riusr	;vom anwender definiertes geraet
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;EINGABE sio KANAL B, stromschleife, ZEICHEN IN A
  C1A8    CD C16F        C      esio:	call	break
  C1AB    DB 7B          C      	IN 	A,(SIOBC)	;statusabfrege
  C1AD    0F             C      	RRCA
  C1AE    30 F8          C      	JR	NC,esio
  C1B0    DB 79          C      	IN	A,(SIOBD)	;zeicheneingabe
  C1B2    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;FERNSCHREIBEINGABE UEBER PIO
  C1B3    CD C16F        C      FEP:	call	break
  C1B6    DB FC          C      	IN	A,(PIOAD)
  C1B8    CB 7F          C      	BIT	7,A		;WARTEN AUF STARTBIT
  C1BA    28 F7          C      	JR	Z,FEP
  C1BC    CD C2FB        C      	CALL	FSE
  C1BF    1F             C      	RRA			;STARTBIT RAUSSCHIEBEN
  C1C0    E6 1F          C      	AND	1FH		;STOPBITS AUSBLENDEN
  C1C2    CD C284        C      	CALL	CVCA
  C1C5    28 EC          C      	JR	Z,FEP
  C1C7    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Ausgabe eines Zeichens ueber Geraet pun:
                         C      ;***IN: C...ZEICHEN
                         C      ;**OUT: -
                         C      ;*KILL: A,F
  C1C8    3A F5FF        C      WO::	LD	A,(IOBYT)
  C1CB    E6 30          C      	AND	30H		;bits ausblenden
  C1CD    CA C0E6        C      WO1:	JP	Z,MCO		;ausgabe ueber bildschirm
  C1D0    FE 10          C      	CP	OP
  C1D2    28 55          C      	JR	Z,fap		;Fernschreibausgabe ueber pio
  C1D4    FE 20          C      	cp	os
  C1D6    C2 F5F6        C      	jp	nz,wousr		;AUSGABE UEBER ANWENDERGERAET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;AUSGABE sio KANAL B, stromschleife, ZEICHEN IN C
  C1D9    DB 7B          C      asio:	IN	A,(SIOBC)
  C1DB    E6 04          C      	AND	4
  C1DD    28 FA          C      	JR	Z,asio
  C1DF    79             C      	LD	A,C
  C1E0    D3 79          C      	OUT	(SIOBD),A
	MACRO-80 V3.50	25-Oct-85	Page	1-7
'Ein-/Ausgabe-Routinen'

  C1E2    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE UEB. D. GER. "lst:" MIT TEST AUF CTRL/C
                         C      ;***IN: C...ZEICHEN
                         C      ;**OUT: -
                         C      ;*KILL: A,F
  C1E3    CD C16F        C      LO:	call	break
  C1E6    3A F5FF        C      	LD	A,(IOBYT)
  C1E9    E6 C0          C      	AND	0C0H		;BITS AUSBLENDEN
  C1EB    CA C0E6        C      	JP	Z,MCO		;AUSGABE UEBER BILDSCHIRM
  C1EE    FE 80          C      	CP	LC
  C1F0    28 1E          C      	JR	Z,centr		;AUSGABE UEBER centronics an DRUCKER
  C1F2    FE 40          C      	CP	LV
  C1F4    C2 F5F9        C      	JP	NZ,LOUSR	;AUSGABE UEBER ANWENDERGERAET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Druckprogramm V24
                         C      ;in:	Zeichen in C
                         C      ;out:	A=C
                         C      ;kill:	A,F
  C1F7    C5             C      lstv24:	push	bc
  C1F8    DB 7A          C      v241:	in	a,(sioac)
  C1FA    E6 04          C      	and	4		;Sendepuffer leer ?
  C1FC    28 FA          C      	jr	z,v241
  C1FE    CD C16F        C      lst2:	call	break
  C201    3E 10          C      	ld	a,10h
  C203    D3 7A          C      	out	(sioac),a	;reset extern status
  C205    DB 7A          C      	in	a,(sioac)	;status lesen
  C207    E6 20          C      	and	20h		;CTS-Test
  C209    20 F3          C      	jr	nz,lst2		;warten auf Freigabe
  C20B    79             C      	ld	a,c
  C20C    D3 78          C      	out	(sioad),a	;Zeichenausgabe
  C20E    C1             C      	pop	bc
  C20F    C9             C      	ret
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Drucker mit CENTRONICS-Schnittstelle
                         C      ;2-PIO-Karte
                         C      ;Drucker an pio1,Kanal a Daten, Kanal b Steuerung
  C210    CD C16F        C      centr:	call	break
  C213    DB AD          C      	in	a,(p1bd)	;warten auf Fertigmeldung des Druckers
  C215    1F             C      	rra
  C216    1F             C      	rra
  C217    38 F7          C      	jr	c,centr
  C219    79             C      	ld	a,c
  C21A    D3 AC          C      	out	(p1ad),a	;Ausgabedaten
  C21C    3E 2F          C      	ld	a,02fh
  C21E    3D             C      centr1:	dec	a
  C21F    20 FD          C      	jr	nz,centr1
  C221    3E 00          C      	ld	a,0		;Abtastimpuls erzeugen
  C223    D3 AD          C      	out	(p1bd),a
  C225    3D             C      	dec	a
  C226    D3 AD          C      	out	(p1bd),a
  C228    C9             C      	ret
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;FERNSCHREIBAUSGABE UEBER PIO
  C229    F5             C      FAP:	PUSH	AF
  C22A    CD C237        C      	CALL	CVAC
  C22D    B7             C      	OR	A
  C22E    C4 C2E8        C      	CALL	NZ,FSA		;ERST STEUERZEICHEN
  C231    79             C      	LD	A,C
  C232    CD C2E8        C      	CALL	FSA
  C235    F1             C      	POP	AF
  C236    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR KONVERTIERUNG ASCII-CCITT
                         C      ;***IN: C...ZEICHEN IM ASCII-KODE
	MACRO-80 V3.50	25-Oct-85	Page	1-8
'Ein-/Ausgabe-Routinen'

                         C      ;**OUT: C...ZEICHEN IM CCITT-KODE
                         C      ;       A=0...KEINE UMSCHALTUNG BUCHST.-ZEICHEN
                         C      ;       A>0...KODE FUER UMSCH. BUCHST.-ZEICHEN
                         C      ;*KILL: A,F,C
  C237    E5             C      CVAC:	PUSH	HL
  C238    C5             C      	PUSH	BC
  C239    79             C      	LD	A,C
  C23A    E6 7F          C      	AND	7FH
  C23C    CB 77          C      	BIT	6,A		;GROSS:=KLEIN
  C23E    28 02          C      	jr	Z,cvac0
  C240    CB AF          C      	res	5,a
  C242    21 C2E7        C      CVAC0:	LD	HL,TBCVZ+LTB-1
  C245    01 0040        C      	LD	BC,LTB
  C248    ED B9          C      	CPDR
  C24A    28 04          C      	JR	Z,CVAC1
  C24C    3E 40          C      	LD	A,'@'
  C24E    18 F2          C      	JR	CVAC0
  C250    FE 0D          C      CVAC1:	CP	0dh
  C252    28 1C          C      	JR	Z,CVAC6
  C254    FE 0A          C      	CP	0ah
  C256    28 18          C      	JR	Z,CVAC6
  C258    FE 20          C      	CP	' '
  C25A    28 14          C      	JR	Z,CVAC6
  C25C    79             C      CVAC2:	LD	A,C
  C25D    FE 1F          C      	CP	1fh
  C25F    21 F5FE        C      	LD	HL,FLGIO
  C262    30 12          C      	JR	NC,CVAC5
  C264    CB 4E          C      	BIT	1,(HL)		;OZ
  C266    20 09          C      	JR	NZ,CVAC4
  C268    CB CE          C      	SET	1,(HL)		;OZ
  C26A    C1             C      CVAC3:	POP	BC
  C26B    4F             C      	LD	C,A
  C26C    3E 1B          C      	LD	A,1bh
  C26E    E1             C      	POP	HL
  C26F    C9             C      	RET
  C270    79             C      CVAC6:	LD	A,C
  C271    C1             C      CVAC4:	POP	BC
  C272    4F             C      	LD	C,A
  C273    AF             C      	XOR	A
  C274    E1             C      	POP	HL
  C275    C9             C      	RET
  C276    D6 20          C      CVAC5:	SUB	20H
  C278    CB 4E          C      	BIT	1,(HL)		;OZ
  C27A    28 F5          C      	JR	Z,CVAC4
  C27C    CB 8E          C      	RES	1,(HL)		;OZ
  C27E    C1             C      	POP	BC
  C27F    4F             C      	LD	C,A
  C280    3E 1F          C      	LD	A,1fh
  C282    E1             C      	POP	HL
  C283    C9             C      	RET
                         C      ;SUBR.ZUR KONVERTIERUNG CCITT-ASCII
                         C      ;***IN: A...CCITT-ZEHBHEN
                         C      ;**OUT: A...ASCII-ZEICHEN
                         C      ;*KILL A,F
  C284    E5             C      CVCA:	PUSH	HL
  C285    21 F5FE        C      	LD	HL,FLGIO
  C288    FE 1F          C      	CP	1fh
  C28A    20 02          C      	JR	NZ,CVCA1
  C28C    CB 86          C      	RES	0,(HL)
  C28E    FE 1B          C      CVCA1:	CP	1bh
  C290    20 02          C      	JR	NZ,CVCA2
  C292    CB C6          C      	SET	0,(HL)
  C294    CB 46          C      CVCA2:	BIT	0,(HL)
  C296    21 C2A8        C      	LD	HL,TBCVZ
  C299    20 03          C      	JR	NZ,CVCA0
	MACRO-80 V3.50	25-Oct-85	Page	1-9
'Ein-/Ausgabe-Routinen'

  C29B    21 C2C8        C      	LD	HL,TBCVB
  C29E    85             C      CVCA0:	ADD	A,L
  C29F    6F             C      	LD	L,A
  C2A0    7C             C      	LD	A,H
  C2A1    CE 00          C      	ADC	A,0
  C2A3    67             C      	LD	H,A
  C2A4    7E             C      	LD	A,(HL)
  C2A5    E1             C      	POP	HL
  C2A6    B7             C      	OR	A
  C2A7    C9             C      	RET
                         C      ;TABELLE ZUR KONVERTIERUNG CCITT <--> ASCII
  C2A8    23 33          C      TBCVZ:	DB	'#3'
  C2AA    0A             C      	DB	0ah
  C2AB    2D 20          C      	DB	'- '
  C2AD    27             C      	DB	APST
  C2AE    38 37          C      	DB	'87'
  C2B0    0D             C      	DB	0dh
  C2B1    03             C      	DB	ETX
  C2B2    34 3B 2C 21    C      	DB	'4;,!'
  C2B6    3A 28 35 2B    C      	DB	':(5+'
  C2BA    29 32 40 36    C      	DB	')2@6'
  C2BE    30 31 39       C      	DB	'019'
  C2C1    3F 25          C      	DB	'?%'
  C2C3    00             C      	DB	0
  C2C4    2E 2F 3D       C      	DB	'./='
  C2C7    00             C      	DB	0
  C2C8    2A 45          C      TBCVB:	DB	'*E'
  C2CA    0A             C      	DB	0ah
  C2CB    41 20          C      	DB	'A '
  C2CD    53 49 55       C      	DB	'SIU'
  C2D0    0D             C      	DB	0dh
  C2D1    44 52 4A 4E    C      	DB	'DRJN'
  C2D5    46 43 4B 54    C      	DB	'FCKT'
  C2D9    5A 4C 57 48    C      	DB	'ZLWH'
  C2DD    59 50 51 4F    C      	DB	'YPQO'
  C2E1    42 47          C      	DB	'BG'
  C2E3    00             C      	DB	0
  C2E4    4D 58 56       C      	DB	'MXV'
  C2E7    00             C      	DB	0
  0040                   C      LTB	EQU	$-TBCVZ
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;FERNSCHREIBZEICHENAUSGABE(PIO)
                         C      ;IN:A-ZEICHEN IN CCITT OHNE START- UND STOP-BITS
                         C      ;OUT:A-ZEICHEN KOMPLETT
                         C      ;KILL:PIOAD
  C2E8    C5             C      FSA:	PUSH	BC
  C2E9    06 08          C      	LD	B,8
  C2EB    F6 60          C      	OR	60H		;CY=0,2 STOP-BITS
  C2ED    17             C      	RLA			;CY=STARTBIT
  C2EE    D3 FC          C      FSA1:	OUT	(PIOAD),A
  C2F0    CD C03D        C      	CALL	ZS
  C2F3    CD C03D        C      	CALL	ZS
  C2F6    1F             C      	RRA
  C2F7    10 F5          C      	DJNZ	FSA1
  C2F9    C1             C      	POP	BC
  C2FA    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;FERNSCHREIBZEICHENEINGABE(PIO)
                         C      ;IN:-
                         C      ;OUT:A...FS-ZEICHEN
                         C      ;KILL:AF
  C2FB    C5             C      FSE:	PUSH	BC
  C2FC    06 07          C      	LD	B,07		;BITZAEHLER
  C2FE    CD C03D        C      	CALL	ZS
  C301    DB FC          C      FSE1:	IN	A,(PIOAD)	;BIT EINLESEN
	MACRO-80 V3.50	25-Oct-85	Page	1-10
'Ein-/Ausgabe-Routinen'

  C303    CD C03D        C      	CALL	ZS
  C306    CD C03D        C      	CALL	ZS
  C309    17             C      	RLA
  C30A    CB 19          C      	RR	C
  C30C    10 F3          C      	DJNZ	FSE1
  C30E    CB 19          C      	RR	C
  C310    79             C      	LD	A,C
  C311    2F             C      	CPL
  C312    F6 C0          C      	OR	0C0H
  C314    C1             C      	POP	BC
  C315    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON CR UND LF AUF DEM GERAET "LST:"
                         C      ;***IN: -
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C316    0E 0D          C      LCRLF::	LD	C,0DH	;Wagenruecklauf
  C318    CD C0EC        C      	CALL	MLO
  C31B    0E 0A          C      	LD	C,0AH	;Zeilenvorschub
  C31D    C3 C0EC        C      	jp	mlo
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON CR UND LF AUF BILDSCHIRM
                         C      ;***IN: -
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C320    CD C036        C      CRLF::	CALL	COMC
  C323    0D             C      	DB	0DH
  C324    CD C036        C      	CALL	COMC
  C327    0A             C      	DB	0AH
  C328    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBROUTINE TON
                         C      ;IN:-
                         C      ;OUT:TON AN PIO AD
                         C      ;KILL:PIOAD
  C329    F5             C      TON::	PUSH	AF
  C32A    C5             C      	PUSH	BC
  C32B    0E FF          C      	LD	C,0FFH		;PERIODENANZAHL
  C32D    06 30          C      TON1:	LD	B,30H		;PERIODENLAENGE
  C32F    10 FE          C      TON2:	DJNZ	TON2		;1/2 PERIODE
  C331    DB FC          C      	IN	A,(PIOAD)
  C333    CB 6F          C      	BIT	5,A
  C335    28 0A          C      	JR	Z,TON3
  C337    CB AF          C      	RES	5,A
  C339    D3 FC          C      TON4:	OUT	(PIOAD),A
  C33B    0D             C      	DEC	C
  C33C    20 EF          C      	JR	NZ,TON1
  C33E    C1             C      	POP	BC
  C33F    F1             C      	POP	AF
  C340    C9             C      	RET
  C341    CB EF          C      TON3:	SET	5,A
  C343    18 F4          C      	JR	TON4
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Routine fuer ASCII-Tastaturen
                         C      ;IN:	PIOBD 0..6 Daten,
                         C      ;	bit 7 = 1 = Zeichen gueltig
                         C      ;OUT:	Zeichen in A
  C345    DB FD          C      aci:	in	a,(piobd)
  C347    CB 7F          C      	bit	7,a	;Test auf Zeichen
  C349    28 FA          C      	jr	z,aci
  C34B    CD C03D        C      	call	zs
  C34E    DB FD          C      	in	a,(piobd)
  C350    E6 7F          C      	and	7fh
  C352    F5             C      	push	af
  C353    CD C329        C      	call	ton
	MACRO-80 V3.50	25-Oct-85	Page	1-11
'Ein-/Ausgabe-Routinen'

  C356    DB FD          C      aci1:	in	a,(piobd)	
  C358    CB 7F          C      	bit	7,a	;warten bis Taste frei
  C35A    20 FA          C      	jr	nz,aci1
  C35C    F1             C      	pop	af
  C35D    C9             C      	ret
                         C      
                         C      ;Tastaturstatus ASCII-Tastatur
                         C      ;IN:	-
                         C      ;OUT:	A=0  kein Zeichen 
                         C      ;	A=FF Zeichen liegt an
  C35E    DB FD          C      acsts:	in	a,(piobd)
  C360    E6 80          C      	and	80h	;bit 7 testen
  C362    C8             C      	ret	z	;kein Zeichen
  C363    3E FF          C      	ld	a,0ffh
  C365    C9             C      	ret
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Zuweisung von Peripheriegeraeten
                         C      ;R=RDR:, P=PUN:, L=LST:
  C366    CD C174        C      asgn:	call	ti	;Eingabe des Kanals 
  C369    21 C3AC        C      	ld	hl,ltbl	;kanaele
  C36C    01 0003        C      	ld	bc,3
  C36F    ED A1          C      asg:	cpi
  C371    28 08          C      	jr	z,as1	;gefunden
  C373    23             C      	inc	hl
  C374    23             C      	inc	hl
  C375    23             C      	inc	hl
  C376    E2 C050        C      	jp	po,error
  C379    18 F4          C      	jr	asg	;naechstes
  C37B    46             C      as1:	ld	b,(hl)	;maske ??????????
  C37C    C5             C      	push	bc
                         C      ;Adresse der physischen Geraete nach de
  C37D    23             C      	inc	hl
  C37E    5E             C      	ld	e,(hl)
  C37F    23             C      	inc	hl
  C380    56             C      	ld	d,(hl)
  C381    EB             C      	ex	de,hl
  C382    CD C174        C      loop0:	call	ti	;warten auf "="
  C385    FE 3D          C      	cp	'='
  C387    20 F9          C      	jr	nz,loop0
  C389    CD C174        C      loop1:	call	ti	;Eingabe des physischen Geraetes
  C38C    FE 20          C      	cp	' '	;Leerzeichen unterdruecken
  C38E    28 F9          C      	jr	z,loop1
                         C      ;Test, ob Zuweisung ausfuehrbar
  C390    01 0004        C      	ld	bc,4
  C393    ED A1          C      as2:	cpi
  C395    28 06          C      	jr	z,as3
  C397    23             C      	inc	hl
  C398    E2 C050        C      	jp	po,error
  C39B    18 F6          C      	jr	as2
  C39D    CD C924        C      as3:	call	pchk	;warten auf Eingabe von CR
  C3A0    30 FB          C      	jr	nc,as3
  C3A2    3A F5FF        C      	ld	a,(iobyt)
  C3A5    C1             C      	pop	bc
  C3A6    A0             C      	and	b
  C3A7    B6             C      	or	(hl)
  C3A8    32 F5FF        C      	ld	(iobyt),a
  C3AB    C9             C      	ret
                         C      ;Tabelle der logischen Geraete
  C3AC    52 F3          C      ltbl:	db	'R',rmsk
  C3AE    C3B8           C      	dw	arz
  C3B0    50 CF          C      	db	'P',pmsk
  C3B2    C3C0           C      	dw	apz
  C3B4    4C 3F          C      	db	'L',lmsk
  C3B6    C3C8           C      	dw	alz
                         C      ;Tabelle der physischen Geraete fuer 'RDR:'
	MACRO-80 V3.50	25-Oct-85	Page	1-12
'Ein-/Ausgabe-Routinen'

  C3B8    54 00 53 04    C      arz:	db	'T',0,'S',4,'P',8,'U',0ch
  C3BC    50 08 55 0C    C      
                         C      ;Tabelle der physischen Geraete fuer 'PUN:'
  C3C0    54 00 53 10    C      apz:	db	'T',0,'S',10h,'P',20h,'U',30h
  C3C4    50 20 55 30    C      
                         C      ;Tabelle der physischen Geraete fuer 'LST:'
  C3C8    54 00 56 40    C      alz:	db	'T',0,'V',40h,'C',80h,'U',0c0h
  C3CC    43 80 55 C0    C      
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Kommando Terminal (simplex)
                         C      ;IN:	Tastatur oder SIO B
                         C      ;OUT:	Zeichen auf Bildschirm und SIO B
  C3D0    DB 7B          C      LINK:	in 	a,(siobc);sio-status
  C3D2    0F             C      	rrca
  C3D3    38 19          C      	jr	c,term2	;zeichen von leitung
  C3D5    CD C49E        C      	call	csts	;tastaturstatus
  C3D8    28 F6          C      	jr	z,link	;wenn kein zeichen
  C3DA    CD C0E0        C      	call	mci	;tastaturzeichen
  C3DD    F5             C      	push	af
  C3DE    4F             C      	ld	c,a
  C3DF    CD C1D9        C      	call	asio	;ausgabe auf leitung
  C3E2    CD C1A8        C      	call	esio	;ruecklesen wegen simplex
  C3E5    F1             C      	pop	af
  C3E6    FE 03          C      term1:	cp	3	;abbruch ?
  C3E8    C8             C      	ret	z
  C3E9    CD C0E6        C      	call	mco	;ausgabe bildschirm
  C3EC    18 E2          C      	jr	link
  C3EE    CD C1A8        C      term2:	call	esio
  C3F1    4F             C      	ld	c,a
  C3F2    18 F2          C      	jr	term1
                         C      
                         C      include	CI80.MAC
                         C      
                         C      
                         C      ;9.7.88.
                         C      ;SUBR. ZUR EINGABE EINES ZEICHENS UEBER Tastatur 8x10
                         C      ;***IN: -
                         C      ;**OUT: A...ZEICHEN IN ASCII
                         C      ;*KILL: A,F
  C3F4    C5             C      CI::	PUSH	BC		
  C3F5    D5             C      	PUSH	DE
  C3F6    E5             C      	PUSH	HL
  C3F7    21 F5FE        C      	LD	HL,FLGIO
  C3FA    CD C416        C      CI2:	CALL	ZYKL
  C3FD    B7             C      	or	a
  C3FE    28 FA          C      	JR	Z,CI2
                         C      ;TASTE GEDRUECKT
  C400    CD C03D        C      	call	zs		;entprellzeit
  C403    57             C      	LD	D,A
  C404    CD C472        C      	CALL	CVTA		;UMWANDLUNG IN ASCII
  C407    F5             C      	PUSH	AF
  C408    CD C329        C      	CALL	TON
  C40B    CD C416        C      CI1:	CALL	ZYKL
  C40E    B7             C      	or	a
  C40F    20 FA          C      	JR	NZ,CI1		;WARTEN BIS TASTE FREI
  C411    F1             C      	POP	AF		
  C412    E1             C      	POP	HL
  C413    D1             C      	POP	DE
  C414    C1             C      	POP	BC
  C415    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. FUER EINEN ZYKLUS DER TASTENEINGABE
                         C      ;***IN: -
                         C      ;**OUT: A=0...KEINE EINGABE
                         C      ;       A...SONST SPALTENBYTE
	MACRO-80 V3.50	25-Oct-85	Page	1-13
'Ein-/Ausgabe-Routinen'

                         C      ;       E...ZEILENBYTE
                         C      ;*KILL: A,B,C,E,F
  C416    0E FC          C      ZYKL:	LD	C,PIOAD
  C418    ED 78          C      	IN	A,(C)
  C41A    E6 E1          C      	AND	0e1H		;Spalte 0 einstellen
  C41C    F6 0C          C      	or	0ch
  C41E    5F             C      	ld	e,a
  C41F    ED 59          C      	out	(c),e
  C421    DB FD          C      	in	a,(piobd)
  C423    CB A6          C      	res	4,(hl)
  C425    E6 20          C      	and	20h
  C427    20 02          C      	jr	nz,ci3
  C429    CB E6          C      	set	4,(hl)
  C42B    7B             C      ci3:	ld	a,e
  C42C    C6 02          C      	add	a,02
  C42E    ED 79          C      	out	(c),a
  C430    DB FD          C      	in	a,(piobd)
  C432    F5             C      	push	af
  C433    CB 9E          C              res	3,(hl)
  C435    E6 40          C      	and	40h
  C437    20 02          C      	jr	nz,ci4
  C439    CB DE          C      	set	3,(hl)
  C43B    F1             C      ci4:	pop	af
  C43C    E6 80          C      	and	80h
  C43E    20 02          C      	jr	nz,ci5
  C440    CB E6          C      	set	4,(hl)
  C442    ED 78          C      ci5:	in	a,(c)
  C444    06 0A          C      	LD	B,10		;Anzahl Spalten
  C446    E6 E1          C      	and	0e1h
  C448    5F             C      ZYK1:	LD	E,A
  C449    ED 59          C      	OUT	(C),E
  C44B    16 00          C      	ld	d,0
  C44D    78             C      	ld	a,b
  C44E    FE 04          C      	cp	4
  C450    20 02          C      	jr	nz,zy1
  C452    16 20          C      	ld	d,20h
  C454    FE 03          C      zy1:	cp	3
  C456    20 02          C      	jr	nz,zy2
  C458    16 60          C      	ld	d,060h
  C45A    DB FD          C      zy2:	IN	A,(PIOBD)	;Zeile in A, 1 von 8
  C45C    B2             C      	or	d
  C45D    FE FF          C      	CP	0FFH
  C45F    20 0B          C      	JR	NZ,ZYK2		;TASTE GEDRUECKT
  C461    7B             C      	LD	A,E
  C462    C6 02          C      	ADD	A,02H		;Dekoder auf naechste Spalte
  C464    10 E2          C      	DJNZ	ZYK1		;KEINE TASTE GEDRUECKT
  C466    E6 E1          C      	and	0e1h
  C468    ED 79          C      	out	(c),a
  C46A    AF             C      	XOR	A
  C46B    C9             C      	RET
  C46C    1E 0A          C      ZYK2:	LD	E,10
  C46E    1D             C      ZYK3:	deC	E
  C46F    10 FD          C      	DJNZ	ZYK3
  C471    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR KONVERTIERUNG TASTENKODE -> ASCII
                         C      ;***IN: DE..ZEICHEN IM TASTENKODE
                         C      ;**OUT: A...ZEICHEN IM ASCII-KODE
                         C      ;*KILL: A,B,C,D,E,F
  C472    E5             C      CVTA:	PUSH	HL
  C473    AF             C      	XOR	A
  C474    47             C      	LD	B,A		;B=0 F.ADD HL,BC
                         C      ;REL. TAB.PLATZ FUER zeile
  C475    C6 0A          C      CVTA0:	add	a,10		;Zeilenanfang 0...70
  C477    CB 0A          C      	rrc	D
	MACRO-80 V3.50	25-Oct-85	Page	1-14
'Ein-/Ausgabe-Routinen'

  C479    38 FA          C      	JR	C,CVTA0
  C47B    D6 0A          C      	sub	10
                         C      ;Tabellenplatz FUER spalte in e
  C47D    83             C      	ADD	A,E		;Spalte dazu
  C47E    4F             C      	LD	C,A		;Tabellenplatz FUER ZEICHEN 
  C47F    21 C4AE        C      	LD	HL,TTAB
  C482    09             C      	ADD	HL,BC
  C483    7E             C      	LD	A,(HL)
                         C      ;TEST AUF UMSCHALTUNG
  C484    21 F5FE        C      	LD	HL,FLGIO
  C487    CB 5E          C      	BIT	3,(HL)		;SHIFT-FLAG
  C489    C4 C494        C      	CALL	NZ,SHIFT
                         C      ;TEST AUF CONTROL
  C48C    CB 66          C      	BIT	4,(hl)
  C48E    28 02          C      	jr	Z,Cvta2
  C490    E6 1F          C              and     1fh
  C492    E1             C      cvta2:	POP	HL
  C493    C9             C      	RET
  C494    CB 77          C      SHIFT:	BIT	6,A		;BUCHST.
  C496    28 03          C      	JR	Z,SH1
  C498    CB AF          C      SH2:	RES	5,A		;GROSS:=KLEIN
  C49A    C9             C      	RET
  C49B    CB A7          C      SH1:	RES	4,A		;ZEICHEN:=ZIFFER
  C49D    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;consolstatus, TEST AUF EINGABE UEBER TASTATUR
                         C      ;***IN: -
                         C      ;**OUT: A=0... KEINE EINGABE
                         C      ;       A=-1... EINGABE
                         C      ;*KILL: A,F
  C49E    C5             C      CSTS:	PUSH	BC
  C49F    D5             C      	PUSH	DE
  C4A0    E5             C      	push	hl
  C4A1    0E FC          C      	ld	c,pioad
  C4A3    CD C442        C      	call	ci5
  C4A6    E1             C      	pop	hl
  C4A7    D1             C      	POP	DE
  C4A8    C1             C      	POP	BC
  C4A9    B7             C      	or	A
  C4AA    C8             C      	RET	Z
  C4AB    3E FF          C      	LD	A,0FFH
  C4AD    C9             C      endf:	RET 
                         C      
                         C      include	TTAB80.MAC
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;16.10.88
                         C      ;S6011-TASTATUR 8x10  
                         C      ;KONVERTIERUNGSTABELLE FUER TASTEN
                         C      ;nb=nicht belegt, Fn = Funktionstaste n
  C4AE    31 33 35 37    C      TTAB:	DB	'1','3','5','7','9','?',04,00h,00h,0ffh
  C4B2    39 3F 04 00    C      
  C4B6    00 FF          C      
                         C      ;				           nb   nb   F7  
  C4B8    71 65 74 75    C      	DB	71H,65h,74h,75h,6fh,7dh,0dh,00h,07fh,0ffh
  C4BC    6F 7D 0D 00    C      
  C4C0    7F FF          C      
                         C      	;	 q   e   t   u   o   ue  cr  nb	 del  F8  
                         C      ;
  C4C2    61 64 67 6A    C      	DB	61H,64h,67h,6ah,6ch,7bh,12h,00h,09h,0ffh
  C4C6    6C 7B 12 00    C      
  C4CA    09 FF          C      
                         C      	;	 a   d   g   j   l   ae      nb tab  F9
                         C      ;
  C4CC    79 63 62 6D    C      	DB	79H,63h,62h,6dH,':',08h,03h,00h,0ffh,0ffh
  C4D0    3A 08 03 00    C      
	MACRO-80 V3.50	25-Oct-85	Page	1-15
'Ein-/Ausgabe-Routinen'

  C4D4    FF FF          C      
                         C      	;	 y   c   b   m      bs       nb  F1  F10
                         C      ;
  C4D6    32 34 36 38    C      	DB	'2','4','6','8','0',18H,20H,00h,0ffh,0ffh
  C4DA    30 18 20 00    C      
  C4DE    FF FF          C      
                         C      ;					     nb  F2  F11 	
  C4E0    77 72 7A 69    C      	DB	77H,72H,7AH,69H,70H,';',82H,00h,0ffh,060h
  C4E4    70 3B 82 00    C      
  C4E8    FF 60          C      
                         C      	;	 w   r   z   i   p      ctrl nb  F3   `
                         C      ;
  C4EA    73 66 68 6B    C      	DB	73H,66H,68H,6BH,7cH,'<',01,81H,0ffh,05h
  C4EE    7C 3C 01 81    C      
  C4F2    FF 05          C      
                         C      	;	 s   f   h   k   oe       shift F4
                         C      ;
  C4F4    78 76 6E 3D    C      	DB	78H,76H,6EH,'=','>',7eH,06,83h,0ffh,1bh
  C4F8    3E 7E 06 83    C      
  C4FC    FF 1B          C      
                         C      	;	 x   v   n           ~     lock F6  esc
                         C      
                         C      include	BCCO.MAC
                         C      ;Bildschirmausgabe alphanumerisch BS1K
                         C      ;IN:	Zeichen in C
                         C      
  0040                   C      ZL	EQU	40H		;ZEILENLAENGE
  0010                   C      ZZ	EQU	10H		;ZEILENZAHL
                         C      
  C4FE    F5             C      BS1CO:	push	af
  C4FF    C5             C      	push	bc
  C500    D5             C      	push	de
  C501    E5             C      	push	hl
  C502    CD C50A        C      	call	bcco
  C505    E1             C      	pop	hl
  C506    D1             C      	pop	de
  C507    C1             C      	pop	bc
  C508    F1             C      	pop	af
  C509    C9             C      	ret
  C50A    21 C545        C      bcco:	LD	HL,CO15
  C50D    E5             C      	PUSH	HL
  C50E    2A F5ED        C      	LD	HL,(CURS)
  C511    CB BE          C      	RES	7,M
  C513    3A F5EF        C      	LD	A,(POS1)	;LAEUFT POSITIONIERUNG?
  C516    B7             C      	OR	A
  C517    20 35          C      	JR	NZ,M0044		;JA
  C519    79             C      	LD	A,C
  C51A    FE 20          C      	CP	20H		;STEUERZEICHEN?
  C51C    38 55          C      	JR	C,M0049
  C51E    FE 7F          C      	CP	7FH
  C520    30 51          C      	JR	NC,M0049
  C522    77             C      M0042:	LD	M,A
  C523    EB             C      	EX	DE,HL
  C524    13             C      CO9:	INC	DE		;15H
  C525    7B             C      	ld	a,e
  C526    B2             C      	or	d
  C527    EB             C      	EX	DE,HL
  C528    C0             C      	ret	nz
  C529    11 FFBF        C      	LD	DE,BRAM +zl*zz-ZL-1
  C52C    D5             C      M0043:	PUSH	DE		;scroll
  C52D    21 FC40        C      	LD	HL,bram+zl	
  C530    11 FC00        C      	LD	DE,BRAM
  C533    01 03C0        C      	LD	BC,zz*zl-ZL
  C536    ED B0          C      	LDIR
  C538    2B             C      	DEC	HL
	MACRO-80 V3.50	25-Oct-85	Page	1-16
'Ein-/Ausgabe-Routinen'

  C539    36 00          C      	LD	M,00H
  C53B    11 FFFE        C      	LD	DE,bram+zz*zl-2	
  C53E    01 003F        C      	LD	BC,ZL-1
  C541    ED B8          C      	LDDR
  C543    E1             C      	POP	HL
  C544    C9             C      	RET
  C545    22 F5ED        C      CO15:	LD	(CURS),HL	;Ende der Ausgabe
  C548    3A F5F0        C      	LD	A,(POS2)
  C54B    B6             C      	OR	M
  C54C    77             C      	LD	M,A
  C54D    C9             C      	RET
                         C      ;CURSORPOSITIONIERUNG
                         C      ;IN:	A ZEILE,C SPALTE mit gesetztem 7. bit
                         C      ;	HL BRAM,DE ZEILENLAENGE
                         C      ;out:	hl Cursorposition
  C54E    CB B9          C      M0044:	RES	7,C
  C550    3D             C      	DEC	A
  C551    32 F5EF        C      	LD	(POS1),A
  C554    28 13          C      	JR	Z,spalte
  C556    3E 0F          C      	LD	A,0fH
  C558    B9             C      	CP	C
  C559    38 01          C      	JR	C,zeile
  C55B    79             C      	LD	A,C
  C55C    21 FC00        C      zeile:	LD	HL,BRAM
  C55F    B7             C      	OR	A
  C560    C8             C      	RET	Z
  C561    11 0040        C      	LD	DE,ZL
  C564    47             C      	LD	B,A
  C565    19             C      zeil1:	ADD	HL,DE
  C566    10 FD          C      	DJNZ	zeil1
  C568    C9             C      	RET
  C569    3E 3F          C      spalte:	LD	A,ZL-1
  C56B    B9             C      	CP	C
  C56C    30 01          C      	JR	NC,spalt1
  C56E    4F             C      	LD	C,A
  C56F    06 00          C      spalt1:	LD	B,00H
  C571    09             C      	ADD	HL,BC
  C572    C9             C      	RET
                         C      ;-----------------------------------------------------------
                         C      ;STEUERZEICHENAUSWERTUNG
  C573    EB             C      M0049:	EX	DE,HL
  C574    21 C62B        C      	LD	HL,bstab
  C577    01 000F        C      	LD	BC,lbstab	;ANZAHL STEUERZEICHEN
  C57A    ED B1          C      	CPIR
  C57C    28 0F          C      	JR	Z,M004B
  C57E    EB             C      	EX	DE,HL
  C57F    FE 84          C      	CP	84H
  C581    D8             C      	RET	C
  C582    FE 88          C      	CP	88H
  C584    38 03          C      	JR	C,M004A
  C586    FE B0          C      	CP	0B0H
  C588    D8             C      	RET	C
  C589    CB BF          C      M004A:	RES	7,A
  C58B    18 95          C      	JR	M0042
  C58D    21 C62A        C      M004B:	LD	HL,BSTAB-1	;Steuerzeichen gefunden
  C590    AF             C      	XOR	A
  C591    ED 42          C      	SBC	HL,BC
  C593    ED 42          C      	SBC	HL,BC
  C595    46             C      	LD	B,M
  C596    2B             C      	DEC	HL
  C597    4E             C      	LD	C,M
  C598    C5             C      	PUSH	BC
  C599    6B             C      	LD	L,E
  C59A    62             C      	LD	H,D
  C59B    C9             C      	RET
	MACRO-80 V3.50	25-Oct-85	Page	1-17
'Ein-/Ausgabe-Routinen'

  C59C    01 0040        C      bcr:	LD	BC,ZL		;Wagenruecklauf
  C59F    21 FFFF        C      	LD	HL,bram+zl*zz-1	
  C5A2    ED 42          C      bcr1:	SBC	HL,BC
  C5A4    E5             C      	PUSH	HL
  C5A5    ED 52          C      	SBC	HL,DE
  C5A7    E1             C      	POP	HL
  C5A8    30 F8          C      	JR	NC,bcr1
  C5AA    23             C      	INC	HL
  C5AB    C9             C      	RET
  C5AC    21 FFBF        C      blf:	LD	HL,bram+zz*zl-zl-1	;Zeilenvorschub	
  C5AF    ED 52          C      	SBC	HL,DE
  C5B1    DA C52C        C      	JP	C,M0043
  C5B4    21 0040        C      	LD	HL,ZL
  C5B7    19             C      	ADD	HL,DE
  C5B8    C9             C      	RET
  C5B9    12             C      bdel:	LD	(DE),A		;linkes Zeichen loeschen
  C5BA    21 FC00        C      bbs:	LD	HL,BRAM		;backspace
  C5BD    ED 52          C      	SBC	HL,DE
  C5BF    EB             C      	EX	DE,HL
  C5C0    C8             C      	RET	Z
  C5C1    2B             C      	DEC	HL
  C5C2    C9             C      	RET
  C5C3    11 FC00        C      blhm:	LD	DE,BRAM		;Bildschirm loeschen
  C5C6    21 FFFF        C      CO8:	LD	HL,bram+zz*zl-1	;ab Cursor loeschen
  C5C9    ED 52          C      	SBC	HL,DE
  C5CB    EB             C      	EX	DE,HL
  C5CC    77             C      	LD	M,A
  C5CD    C8             C      	RET	Z
  C5CE    E5             C      	PUSH	HL
  C5CF    42             C      	LD	B,D
  C5D0    4B             C      	LD	C,E
  C5D1    54             C      	LD	D,H
  C5D2    5D             C      	LD	E,L
  C5D3    13             C      	INC	DE
  C5D4    ED B0          C      	LDIR
  C5D6    E1             C      	POP	HL
  C5D7    C9             C      	RET
  C5D8    21 FC00        C      CHOME:	LD	HL,BRAM		;cursor home
  C5DB    C9             C      	RET
  C5DC    21 FC3F        C      CUP:	LD	HL,BRAM+ZL-1	;cursor hoch
  C5DF    ED 52          C      	SBC	HL,DE
  C5E1    EB             C      	EX	DE,HL
  C5E2    D0             C      	RET	NC
  C5E3    11 FFC0        C      	LD	DE,bram+zz*zl-zl	
  C5E6    19             C      	ADD	HL,DE
  C5E7    C9             C      	RET
  C5E8    CD C59C        C      M004E:	CALL	bcr
  C5EB    EB             C      	EX	DE,HL
  C5EC    D5             C      CO10:	PUSH	DE
  C5ED    CD C59C        C      	CALL	bcr
  C5F0    09             C      	ADD	HL,BC
  C5F1    AF             C      	XOR	A
  C5F2    ED 52          C      	SBC	HL,DE
  C5F4    12             C      M004F:	LD	(DE),A
  C5F5    13             C      	INC	DE
  C5F6    2D             C      	DEC	L
  C5F7    20 FB          C      	JR	NZ,M004F
  C5F9    E1             C      	POP	HL
  C5FA    C9             C      	RET
  C5FB    3E 02          C      CO11:	LD	A,02H
  C5FD    32 F5EF        C      	LD	(POS1),A
  C600    C9             C      	RET
  C601    3E 80          C      CO13:	LD	A,80H
  C603    18 01          C      	JR	M0051
  C605    AF             C      M0050:	XOR	A
	MACRO-80 V3.50	25-Oct-85	Page	1-18
'Ein-/Ausgabe-Routinen'

  C606    32 F5F0        C      M0051:	LD	(POS2),A
  C609    C9             C      	RET
  C60A    C3 C329        C      bell:	jp	ton
                         C      ;--------------------------------------------------------------------
                         C      ;ADRESSEN
  C60D    C59C C5AC      C      	DW	BCR,blf,bbs,blhm,chome,CUP,BDEL,CO8
  C611    C5BA C5C3      C      
  C615    C5D8 C5DC      C      
  C619    C5B9 C5C6      C      
  C61D    C524 C5EC      C      	DW	CO9,CO10,M004E,CO11,bell,CO13,M0050
  C621    C5E8 C5FB      C      
  C625    C60A C601      C      
  C629    C605           C      
                         C      ;STEUERZEICHEN
  C62B    0D 0A 08 0C    C      bstab:	DB	0DH,0AH,8,0CH,1,1AH,7FH,14H,15H,16H,18H,1BH,7,82H,83H
  C62F    01 1A 7F 14    C      
  C633    15 16 18 1B    C      
  C637    07 82 83       C      
  000F                   C      lbstab	equ	$-bstab
                         C      include LDSV.MAC
                         C      .z80
  C63A                   C      aseg
                         C      ; Kassettenspeicherung
                         C      ; DEFINTION VON KONSTANTEN
                         C      
                         C      ;save: cpu-pio a5, load: cpu-pio a6
                         C      
                         C      ; ZEITKONSTANTEN SAVE
  1F80                   C      SHDTON	EQU	1f80H
  0C98                   C      SDTTON	EQU	0c98H
  00A4                   C      SHEAD	EQU	0a4H
  002F                   C      SSYN1	EQU	2fH
  0037                   C      SSYN2	EQU	37H
  2220                   C      SBITBC	EQU	2220H
  003E                   C      SBIT0	EQU	3eH
  0042                   C      SBIT1	EQU	42H
  0031                   C      SBITS2	EQU	31H
  003B                   C      SENDE	EQU	3BH
                         C      
                         C      ;ZEITKONSTANTEN LOAD
  0414                   C      LDWART	EQU	414h
  009C                   C      LHEADA	EQU	9ch
  00C6                   C      LHEADE	EQU	LHEADA+2ah
  00C9                   C      LSYNA	EQU	0c9h
  00D4                   C      LSYNE	EQU	LSYNA+0bh
  00B0                   C      LBITA0	EQU	0b0h
  00B2                   C      LBITA1	EQU	LBITA0+2
  00CD                   C      LBITE	EQU	LBITA1+1bh
  0016                   C      LFLNK0	EQU	16h
                         C      
  C63A    CD C64B        C      sv:	call	adr
  C63D    3E FF          C      	ld	a,0ffh
  C63F    C3 C65C        C      	jp	save0
  C642    CD C64B        C      ld:	call	adr
  C645    3E FF          C      	ld	a,0ffh
  C647    37             C      	scf
  C648    C3 C6D0        C      	jp	load1
                         C      
  C64B    0E 02          C      adr:	ld	c,2
  C64D    CD C8D3        C      	call	expr
  C650    E1             C      	pop	hl	;endeadresse
  C651    D1             C      	pop	de	;anfangsadresse
  C652    D5             C      	push	de
  C653    ED 52          C      	sbc	hl,de	;laenge ermitteln
  C655    DA C050        C      	jp	c,error
	MACRO-80 V3.50	25-Oct-85	Page	1-19
'Ein-/Ausgabe-Routinen'

  C658    EB             C      	ex	de,hl
  C659    DD E1          C      	pop	ix	;anfangsadresse
  C65B    C9             C      	ret
                         C      ;*----*----*----*----*----*----*----*----*----*----*-----*-----*
                         C      ; ELEMENTARROUTINEN fuer einen block
                         C      ;*----*----*----*----*----*----*----*----*----*----*-----*-----*
                         C      ;Block laden 
                         C      ;***IN:	IX	Ladeadresse 
                         C      ;	DE	Laenge
                         C      ;	A	Kennung, BIT 6 = 0 = Header, BIT 7 = 1 = Daten"
                         C      ;  	Standard A=0 bzw.A=255"
                         C      ;**OUT:	1.Byte = A, 2....N.= Daten, N+1.=  Paritaet
                         C      
  C65C    21 C6CE        C      SAVE0:	LD	HL,SAVLD		; RETURNADRESSE AUF STACK
  C65F    E5             C      	PUSH	HL
  C660    21 1F80        C      	LD      HL,SHDTON
  C663    CB 7F          C      	BIT	7,A
  C665    28 03          C      	JR	Z,HD
  C667    21 0C98        C      	LD      HL,SDTTON
  C66A    08             C      HD:	EX	AF,AF'
  C66B    13             C      	INC	DE
  C66C    DD 2B          C      	DEC	IX
                         C      ;  "Headerton senden"
  C66E    3E 02          C      	LD	A,2
  C670    47             C      	LD	B,A
  C671    10 FE          C      HEADR:	DJNZ	HEADR
  C673    D3 FC          C      	OUT	(PIOAD),A
  C675    EE 20          C      	XOR	20H
  C677    06 A4          C      	LD	B,SHEAD		;bitperiode headerton
  C679    2D             C      	DEC	L
  C67A    20 F5          C              JR	NZ,HEADR
  C67C    05             C      	DEC	B
  C67D    25             C      	DEC	H
  C67E    F2 C671        C      	JP	P,HEADR
                         C      ;  "Synchronimpuls senden"
  C681    06 2F          C      	LD	B,SSYN1
  C683    10 FE          C      SYN1:	DJNZ	SYN1
  C685    D3 FC          C      	OUT	(PIOAD),A
  C687    3E 20          C      	LD	A,020h
  C689    06 37          C      	LD	B,SSYN2
  C68B    10 FE          C      SYN2:	DJNZ	SYN2
  C68D    D3 FC          C      	OUT	(PIOAD),A
                         C      ;  "Vorbereitung zur Ausgabe"
  C68F    01 2220        C      	LD	BC,SBITBC
  C692    08             C      	EX	AF,AF'
  C693    6F             C      	LD	L,A
  C694    18 09          C      	JR	BOUT1
  C696    7A             C      BOUT:	LD	A,D
  C697    B3             C      	OR	E
  C698    28 0B          C      	JR	Z,BEND
  C69A    DD 6E 00       C      	LD	L,(IX+0)
  C69D    7C             C      PAR:	LD	A,H	;  "Parity-Bildung"
  C69E    AD             C              XOR	L
  C69F    67             C      BOUT1:	LD      H,A
  C6A0    3E 01          C      	LD	A,01H 	; INIT A=1. PENDELT ZW. 1 UND 0
  C6A2    37             C      	SCF		; CY ALS ENDEMARKIERUNG
  C6A3    18 17          C      	JR	SAVE8
  C6A5    6C             C      BEND:	LD      L,H	;  "Bit senden"
  C6A6    18 F5          C      	JR	PAR
  C6A8    79             C      BIEND:	LD	A,C	; C=14 UNVERAENDERT
  C6A9    CB 78          C      	BIT	7,B
  C6AB    10 FE          C      BIANF:	DJNZ	BIANF
  C6AD    30 04          C      	JR	NC,BIOUT
  C6AF    06 3E          C      	LD	B,SBIT0
  C6B1    10 FE          C      BISET:	DJNZ	BISET
	MACRO-80 V3.50	25-Oct-85	Page	1-20
'Ein-/Ausgabe-Routinen'

  C6B3    D3 FC          C      BIOUT:	OUT	(PIOAD),A
  C6B5    06 42          C      	LD	B,SBIT1
  C6B7    20 EF          C      	JR	NZ,BIEND
  C6B9    05             C      	DEC	B
  C6BA    AF             C      	XOR	A
  C6BB    3C             C      	INC	A
  C6BC    CB 15          C      SAVE8:	RL	L
  C6BE    C2 C6AB        C      	JP	NZ,BIANF
  C6C1    1B             C      	DEC	DE	;  "Naechstes Byte"
  C6C2    DD 23          C      	INC	IX
  C6C4    06 31          C      	LD	B,SBITS2
  C6C6    7A             C      	LD	A,D	;  "D schon FF?"
  C6C7    3C             C      	INC	A
  C6C8    20 CC          C      	JR	NZ,BOUT
  C6CA    06 3B          C      	LD	B,SENDE	;  "Alles fertig"
  C6CC    10 FE          C      WAIT:	DJNZ	WAIT
  C6CE    FB             C      SAVLD:	EI
  C6CF    C9             C      	RET
                         C      ;x----x----x----x----x----x----x----x----x----y----x----x----x
                         C      ;  Block laden
                         C      ;***IN:	IX  Zieladresse, DE  Laenge des Datenblockes, A   Typ
                         C      ;	muss mit 1.geladenem Byte identisch sein, sonst RETURN
                         C      ;	Carry = 1; LOAD, Carry = 0: VERIFY
                         C      ;  	Falls D=0FFH, wird alles geladen, unabhaengig von A
                         C      ;	A wird aber dann selbst mit gespeichert, wodurch der 
                         C      ;	Datenblock um ein Byte versetzt im Speicher steht
                         C      
  C6D0    14             C      LOAD1:	INC	D
  C6D1    08             C      	EX	AF,AF'
  C6D2    15             C      	DEC	D
  C6D3    F3             C      	DI
                         C      ;  	INITIALISIERUNG
  C6D4    21 C6CE        C      	LD	HL,SAVLD
  C6D7    E5             C      	PUSH	HL
  C6D8    DB FC          C      	IN	A,(PIOAD)
  C6DA    E6 40          C      	AND	40H 
  C6DC    F6 02          C      	OR	2
  C6DE    4F             C      	LD	C,A
  C6DF    BF             C      	CP	A
  C6E0    CD C16F        C      LDBRK:	CALL	BREAK		; BREAK GEDRUECKT?
  C6E3    CD C75E        C      LDBEG:	CALL	FLNK1
  C6E6    30 F8          C      	JR	NC,LDBRK
  C6E8    21 0414        C      	LD	HL,LDWART
  C6EB    10 FE          C      LDWRT:	DJNZ	LDWRT
  C6ED    2B             C      	DEC	HL
  C6EE    7C             C      	LD	A,H
  C6EF    B5             C      	OR      L
  C6F0    20 F9          C      	JR	NZ,LDWRT
  C6F2    CD C75A        C      	CALL	FLNK2
  C6F5    30 E9          C      	JR	NC,LDBRK
  C6F7    06 9C          C      HEDIN:	LD	B,LHEADA	;  "Nur ein Headersignal akzeptieren"
  C6F9    CD C75A        C      	CALL	FLNK2
  C6FC    30 E2          C      	JR	NC,LDBRK
  C6FE    3E C6          C      	LD	A,LHEADE
  C700    B8             C      	CP	B
  C701    30 E0          C      	JR	NC,LDBEG
  C703    24             C      	INC	H
  C704    20 F1          C      	JR	NZ,HEDIN
  C706    06 C9          C      SYNWT:	LD	B,LSYNA		;  "Synchronimpuls?"
  C708    CD C75E        C      	CALL	FLNK1
  C70B    30 D3          C      	JR	NC,LDBRK
  C70D    78             C      	LD	A,B
  C70E    FE D4          C      	CP	LSYNE
  C710    30 F4          C      	JR	NC,SYNWT
  C712    CD C75E        C      	CALL	FLNK1
	MACRO-80 V3.50	25-Oct-85	Page	1-21
'Ein-/Ausgabe-Routinen'

  C715    D0             C      	RET	NC
  C716    79             C      	LD	A,C		;Bytes LOAD oder VERIFY
  C717    EE 03          C      	XOR	3
  C719    4F             C      	LD	C,A
  C71A    26 00          C      	LD	H,0
  C71C    06 B0          C      	LD	B,LBITA0
  C71E    18 1F          C      	JR	CFLAG
  C720    08             C      EXAF:	EX	AF,AF'
  C721    20 07          C      	JR	NZ,LDTYP
  C723    30 0F          C      	JR	NC,VERFY
  C725    DD 75 00       C      	LD	(IX+0),L
  C728    18 0F          C      	JR	WEITR
  C72A    CB 11          C      LDTYP:	RL	C
  C72C    AD             C      	XOR	L
  C72D    C0             C      	RET	NZ
  C72E    79             C      	LD	A,C
  C72F    1F             C      	RRA
  C730    4F             C      	LD	C,A
  C731    13             C      	INC	DE
  C732    18 07          C      	JR	MK1
  C734    DD 7E 00       C      VERFY:	LD	A,(IX+0)
  C737    AD             C      	XOR	L
  C738    C0             C      	RET	NZ
  C739    DD 23          C      WEITR:	INC	IX
  C73B    1B             C      MK1:	DEC	DE
  C73C    08             C      	EX	AF,AF'
  C73D    06 B2          C      	LD	B,LBITA1
  C73F    2E 01          C      CFLAG:	LD	L,1
  C741    CD C75A        C      BIT:	CALL	FLNK2
  C744    D0             C      	RET	NC
  C745    3E CD          C      	LD	A,LBITE		; ORIGINALWERT 0CBH
  C747    B8             C      	CP	B
  C748    CB 15          C      	RL	L
  C74A    06 B0          C      	LD	B,LBITA0
  C74C    D2 C741        C      	JP	NC,BIT
  C74F    7C             C      	LD	A,H
  C750    AD             C      	XOR	L
  C751    67             C      	LD	H,A
  C752    7A             C      	LD	A,D
  C753    B3             C      	OR	E
  C754    20 CA          C      	JR	NZ,EXAF
  C756    7C             C      	LD	A,H
  C757    FE 01          C      	CP	1
  C759    C9             C      	RET
                         C      ;  "Flankenerfassung. B dient als Zaehler."
                         C      ;  "Falls nicht gefunden, error mit CY=0"
  C75A    CD C75E        C      FLNK2:	CALL	FLNK1
  C75D    D0             C      	RET	NC
  C75E    3E 16          C      FLNK1:	LD	A,LFLNK0
  C760    3D             C      WRTLD:	DEC	A
  C761    20 FD          C      	JR	NZ,WRTLD
  C763    A7             C      	AND	A
  C764    04             C      FLNK:	INC	B
  C765    C8             C      	RET	Z
  C766    3E 7F          C       	LD	A,7FH
  C768    DB FC          C      	IN	A,(PIOAD)
  C76A    A9             C      	XOR	C
  C76B    E6 40          C      	AND	40H 	; BIT 5 BEHALTEN
  C76D    28 F5          C      	JR	Z,FLNK
                         C      ;  "Innerhalb der erlaubten Zeit (B) wurde Flanke"
                         C      ;  "erkannt"
  C76F    79             C      	LD	A,C
  C770    2F             C      	CPL
  C771    4F             C      	LD	C,A
  C772    37             C      	SCF		; CY SETZEN: OKAY
	MACRO-80 V3.50	25-Oct-85	Page	1-22
'Ein-/Ausgabe-Routinen'

  C773    C9             C      	RET
                         C      
  C774                          ds	monitor+800h-36h-$,0ffh
  C7CA                          tos	equ	$
                                	.dephase
                         C      include	STAB.MAC
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SYSTEMTABELLEN
                         C      .phase	stack
  F5C2                   C      USER	EQU	stack-8
                         C      ;TABELLE DER REGISTERINHALTE DES ANWENDERPROGRAMMS
  F5CA    EE             C      ELOC::	DB	0EEH
  F5CB    DD             C      DLOC::	DB	0DDH
  F5CC    CC             C      CLOC::	DB	0CCH
  F5CD    BB             C      BLOC::	DB	0BBH
  F5CE    FF             C      FLOC::	DB	0FFH
  F5CF    AA             C      ALOC::	DB	0AAH
  F5D0    1234           C      XLOC::	DW	1234H
  F5D2    5678           C      YLOC::	DW	5678H
  F5D4    00             C      MLOC:	DB	0
  F5D5    F5             C      ILOC::	DB	high(iloc)
  F5D6    00             C      LSLC::	DB	00H
  F5D7    00             C      HSLC::	DB	00H
  F5D8    0E             C      ESLC::	DB	0EH
  F5D9    0D             C      DSLC::	DB	0DH
  F5DA    0C             C      CSLC::	DB	0CH
  F5DB    0B             C      BSLC::	DB	0BH
  F5DC    0F             C      FSLC::	DB	0FH
  F5DD    0A             C      ASLC::	DB	0AH
  F5DE    C2             C      	DB	LOW(USER)
  F5DF    00             C      SLOC::	DB	0
  F5E0    21             C      EXI1::	DB	21H		;LD	HL,1234H
  F5E1    34             C      LLOC::	DB	34H
  F5E2    12             C      HLOC::	DB	12H
  F5E3    FB             C      	EI
  F5E4    C3             C      RAMJP:	DB	0C3H		;JP	6789H 
  F5E5    89             C      	DB	89H
  F5E6    67             C      PLOC::	DB	67H
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;TABELLE DER HALTEPUNKTE
  F5E7    0000           C      TLOC::	DW	0
  F5E9    00             C      	DB	0
  F5EA    0000           C      	DW	0
  F5EC    00             C      	DB	0
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
  F5ED    FC00           C      curs:	DW	BRAM		;bildschirm-ram
  F5EF    00             C      pos1:	db	0		;Cursorpositionierung
  F5F0    80             C      pos2:	db	80h		;Cursor ein/aus
  F5F1    0000           C      res:	dw	0		;Reserve	
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;einspruenge fuer anwendergeraete
  F5F3    C3 C3F4        C      riusr:	JP	ci		;lesekanal
  F5F6    C3 C0E6        C      wousr:	JP	mco		;schreibkanal
  F5F9    C3 C0E6        C      lousr:	JP	mco		;drucker
  F5FC    18             C      ZK:	DB	18H		;30 F.50 BAUD
  F5FD    01             C      	DB	01		;2 F. 50 BAUD
  F5FE    00             C      FLGIO:	DB	0		;steuerung in/out-geraete
  F5FF    00             C      IOBYT:	db	0		;zuweisung in/out-geraete
  0036                   C      LTOS	EQU	$-sTack
                         C      .dephase
                                	.phase	monitor+800h
                                	SUBTTL	'DEBUGGER'
                                page
	MACRO-80 V3.50	25-Oct-85	Page	1-23
'DEBUGGER'

                                
                         C      include DE.MAC
                         C      
                         C      	SUBTTL	'DEBUGGER'
                         C      
                         C      
                         C      
                         C      ;RUECKSPRUNG IN DEN MONITOR
                         C      ;RETTEN DER REGISTERINHALTE DES ANWENDERPROGRAMMS
  C800    F3             C      RESTR::	DI
  C801    E5             C      	PUSH	HL
  C802    D5             C      	PUSH	DE
  C803    C5             C      	PUSH	BC
  C804    F5             C      	PUSH	AF
  C805    DD E5          C      	PUSH	IX
  C807    FD E5          C      	PUSH	IY
  C809    ED 57          C      	LD	A,I
  C80B    F5             C      	PUSH	AF
  C80C    08             C      	EX	AF,AF'
  C80D    D9             C      	EXX
  C80E    E5             C      	PUSH	HL
  C80F    D5             C      	PUSH	DE
  C810    C5             C      	PUSH	BC
  C811    F5             C      	PUSH	AF
  C812    D9             C      	EXX
  C813    08             C      	EX	AF,AF'
                         C      ;REGISTER AUF TAB.IM SYST.-RAM UMSPEICHERN
  C814    21 0018        C      	LD	HL,24
  C817    39             C      	ADD	HL,SP
  C818    06 0B          C      	LD	B,11
  C81A    EB             C      	EX	DE,HL
  C81B    21 F5E0        C      	LD	HL,EXI1
  C81E    2B             C      RST0:	DEC	HL
  C81F    72             C      	LD	(HL),D
  C820    2B             C      	DEC	HL
  C821    73             C      	LD	(HL),E
  C822    D1             C      	POP	DE
  C823    10 F9          C      	DJNZ	RST0
                         C      ;TEST OB HALTEPUNKT ERREICHT IST
  C825    C1             C      	POP	BC
  C826    0B             C      	DEC	BC
  C827    F9             C      	LD	SP,HL
  C828    21 F5E7        C      	LD	HL,TLOC
  C82B    7E             C      	LD	A,(HL)
  C82C    91             C      	SUB	C
  C82D    23             C      	INC	HL
  C82E    20 04          C      	JR	NZ,RSTA
  C830    7E             C      	LD	A,(HL)
  C831    98             C      	SBC	A,B
  C832    28 0C          C      	JR	Z,RST1		;HALTEPUNKT 1 ERREICHT
                         C      ;TEST, OB HALTEPUNKT 2 ERREICHT WURDE
  C834    23             C      RSTA:	INC	HL
  C835    23             C      	INC	HL
  C836    7E             C      	LD	A,(HL)
  C837    91             C      	SUB	C
  C838    23             C      	INC	HL
  C839    20 04          C      	JR	NZ,RSTB
  C83B    7E             C      	LD	A,(HL)
  C83C    98             C      	SBC	A,B
  C83D    28 01          C      	JR	Z,RST1		;HALTEPUNKT 2 ERREICHT
                         C      ;KEIN HALTEPUNKT ERREICHT
  C83F    03             C      RSTB:	INC	BC
                         C      ;RETTEN VON HL
  C840    21 F5E1        C      RST1:	LD	HL,LLOC
	MACRO-80 V3.50	25-Oct-85	Page	1-24
'DEBUGGER'

  C843    73             C      	LD	(HL),E
  C844    23             C      	INC	HL
  C845    72             C      	LD	(HL),D
                         C      ; RETTEN VON PC
  C846    2E E5          C      	LD	L,LOW(PLOC-1)
  C848    71             C      	LD	(HL),C
  C849    23             C      	INC	HL
  C84A    70             C      	LD	(HL),B
                         C      ;AUSGABE DER STOP-ADRESSE
  C84B    C5             C      	PUSH	BC
  C84C    CD C036        C      	CALL	COMC
  C84F    40             C      	DB	'@'
  C850    E1             C      	POP	HL
  C851    CD C8BC        C      	CALL	LADR
                         C      ;RESTAURIEREN DES SPEICHERINHALTES AN DEN HALTEPUNKTEN
                         C      ;UND LOESCHEN DER TABELLE FUER DIE HALTEPUNKTE
  C854    21 F5E7        C      	LD	HL,TLOC
  C857    16 02          C      	LD	D,2
  C859    4E             C      RST2:	LD	C,(HL)
  C85A    AF             C      	XOR	A
  C85B    77             C      	LD	(HL),A
  C85C    23             C      	INC	HL
  C85D    46             C      	LD	B,(HL)
  C85E    77             C      	LD	(HL),A
  C85F    23             C      	INC	HL
  C860    79             C      	LD	A,C
  C861    B0             C      	OR	B
  C862    28 02          C      	JR	Z,RST3
  C864    7E             C      	LD	A,(HL)
  C865    02             C      	LD	(BC),A
  C866    23             C      RST3:	INC	HL
  C867    15             C      	DEC	D
  C868    20 EF          C      	JR	NZ,RST2
  C86A    21 CBA9        C      	LD	HL,ACTBL
  C86D    CD CB8A        C      	CALL	X5
  C870    21 CBD8        C      	LD	HL,ZACTL
  C873    CD CB8A        C      	CALL	X5
  C876    C3 C057        C      	JP	START
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;RUECKSPRUNGROUTINE ZUM STARTEN EINES ANWENDERPROGRAMMS
  C879    D1             C      EXIT:	POP	DE
  C87A    C1             C      	POP	BC
  C87B    F1             C      	POP	AF
  C87C    DD E1          C      	POP	IX
  C87E    FD E1          C      	POP	IY
  C880    08             C      	EX	AF,AF'
  C881    D9             C      	EXX
  C882    F1             C      	POP	AF
  C883    ED 47          C      	LD	I,A
  C885    E1             C      	POP	HL
  C886    D1             C      	POP	DE
  C887    C1             C      	POP	BC
  C888    F1             C      	POP	AF
  C889    D9             C      	EXX
  C88A    08             C      	EX	AF,AF'
  C88B    E1             C      	POP	HL
  C88C    F9             C      	LD	SP,HL
  C88D    C3 F5E0        C      	JP	EXI1
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUM INKREMENTIEREN VON HL UND VERGLEICHEN MIT DE
                         C      ;***IN: HL...1. OPERAND
                         C      ;       DE...2. OPERAND
                         C      ;**OUT: HL=HL+1
                         C      ;       CARRY=0: HL<=DE
                         C      ;       CARRY=1: HL>DE,HL=0
	MACRO-80 V3.50	25-Oct-85	Page	1-25
'DEBUGGER'

                         C      ;*KILL: A,F,H,L
  C890    23             C      HILO:	INC	HL
  C891    7C             C      	LD	A,H
  C892    B5             C      	OR	L
  C893    37             C      	SCF
  C894    C8             C      	RET	Z
  C895    7B             C      	LD	A,E
  C896    95             C      	SUB	L
  C897    7A             C      	LD	A,D
  C898    9C             C      	SBC	A,H
  C899    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE EINES ZEICHENS UEBER DAS GERAET "O"
                         C      ;***IN: ZEICHEN AUF SPEICHERPLATZ HINTER CALL
                         C      ;**OUT: C...ZEICHEN
                         C      ;       (SP)=(SP)+1
                         C      ;*KILL: A,F,C
  C89A    E3             C      POC:	EX	(SP),HL
  C89B    4E             C      	LD	C,(HL)
  C89C    23             C      	INC	HL
  C89D    E3             C      	EX	(SP),HL
  C89E    C3 C0E9        C      	JP	MWO
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR KONVERTIERUNG EINES HALBBYTES IN EIN HEXADEZ. ASCII-ZEICHEN
                         C      ;***IN: A...HALBBYTE
                         C      ;**OUT: A,C...HEXADEZ. ASCII-ZEICHEN
                         C      ;*KILL: A,F,C
  C8A1    E6 0F          C      CONV:	AND	0FH
  C8A3    C6 90          C      	ADD	A,90H
  C8A5    27             C      	DAA
  C8A6    CE 40          C      	ADC	A,40H
  C8A8    27             C      	DAA
  C8A9    4F             C      	LD	C,A
  C8AA    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE EINES REGISTERINHALTES UEBER DAS GERAET "L"
                         C      ;***IN: HL...TABELLENPLATZ DES REGISTERS
                         C      ;**OUT: HL=HL+3
                         C      ;*KILL: A,F,B,C,D,E,H,L
  C8AB    23             C      LREG:	INC	HL
  C8AC    5E             C      	LD	E,(HL)
  C8AD    16 F5          C      	LD	D,HIGH(EOM)
  C8AF    23             C      	INC	HL
  C8B0    46             C      	LD	B,(HL)
  C8B1    23             C      	INC	HL
  C8B2    1A             C      	LD	A,(DE)
  C8B3    CD C8C1        C      	CALL	LBYTE
  C8B6    05             C      	DEC	B
  C8B7    F8             C      	RET	M
  C8B8    1B             C      	DEC	DE
  C8B9    1A             C      	LD	A,(DE)
  C8BA    18 05          C      	JR	LBYTE
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON 16 BIT BIN. INF. ALS ASCII-ZEICHEN
                         C      ;UEBER DAS GERAET "L"
                         C      ;***IN: HL...BIN. INF.
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C8BC    7C             C      LADR:	LD	A,H
  C8BD    CD C8C1        C      	CALL	LBYTE
  C8C0    7D             C      	LD	A,L
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON 8 BIT BIN. INF. ALS ASCII-ZEICHEN
                         C      ;UEBER DAS GERAET "L"
                         C      ;***IN: A...BIN. INF.
	MACRO-80 V3.50	25-Oct-85	Page	1-26
'DEBUGGER'

                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C8C1    F5             C      LBYTE:	PUSH	AF
  C8C2    0F             C      	RRCA
  C8C3    0F             C      	RRCA
  C8C4    0F             C      	RRCA
  C8C5    0F             C      	RRCA
  C8C6    CD C8A1        C      	CALL	CONV
  C8C9    CD C0EC        C      	CALL	MLO
  C8CC    F1             C      	POP	AF
  C8CD    CD C8A1        C      	CALL	CONV
  C8D0    C3 C0EC        C      	JP	MLO
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE VON HEXADEZ. PARAMETERN UEBER DAS TERMINAL
                         C      ;***IN: C...ZAHL DER PARAMETER
                         C      ;**OUT: PARAMETER IM STACK
                         C      ;       SP=SP-2*C
                         C      ;*KILL: A,F,B,C,H,L,SP
  C8D3    CD C8E3        C      EXPR:	CALL	PARAM
  C8D6    E3             C      	EX	(SP),HL
  C8D7    E5             C      	PUSH	HL
  C8D8    0D             C      	DEC	C
  C8D9    30 03          C      	JR	NC,EX0
  C8DB    20 03          C      	JR	NZ,ERR1
  C8DD    C9             C      	RET
  C8DE    20 F3          C      EX0:	JR	NZ,EXPR
  C8E0    C3 C050        C      ERR1:	JP	ERROR
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE VON 24 BIT BIN. INF. ALS HEXADEZ. ASCII-ZEICHEN
                         C      ; UEBER DAS TERMINAL
                         C      ;***IN: -
                         C      ;**OUT: A,H,L...BIN. INF.
                         C      ;       B...TRENNZEICHEN
                         C      ;*KILL: A,F,B,H,L
  C8E3    CD C924        C      PARAM:	CALL	PCHK
  C8E6    28 F8          C      	JR	Z,ERR1
  C8E8    C5             C      PA0:	PUSH	BC
  C8E9    21 0000        C      	LD	HL,0
  C8EC    4C             C      	LD	C,H
  C8ED    47             C      PA1:	LD	B,A
  C8EE    CD C912        C      	CALL	NIBLE
  C8F1    38 13          C      	JR	C,PA2
  C8F3    47             C      	LD	B,A
  C8F4    79             C      	LD	A,C
  C8F5    29             C      	ADD	HL,HL
  C8F6    17             C      	RLA
  C8F7    29             C      	ADD	HL,HL
  C8F8    17             C      	RLA
  C8F9    29             C      	ADD	HL,HL
  C8FA    17             C      	RLA
  C8FB    29             C      	ADD	HL,HL
  C8FC    17             C      	RLA
  C8FD    4F             C      	LD	C,A
  C8FE    78             C      	LD	A,B
  C8FF    B5             C      	OR	L
  C900    6F             C      	LD	L,A
  C901    CD C174        C      	CALL	TI
  C904    18 E7          C      	JR	PA1
  C906    78             C      PA2:	LD	A,B
  C907    CD C927        C      	CALL	P2C
  C90A    20 D4          C      	JR	NZ,ERR1
  C90C    E3             C      	EX	(SP),HL
  C90D    60             C      	LD	H,B
  C90E    E3             C      	EX	(SP),HL
  C90F    79             C      	LD	A,C
	MACRO-80 V3.50	25-Oct-85	Page	1-27
'DEBUGGER'

  C910    C1             C      	POP	BC
  C911    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR KONVERTIERUNG VON 1 HEXAD. ASCII-Z. IN 1 HALBBYTE BIN. INF.
                         C      ;***IN: A...HEXADEZ. ASCII-Z.
                         C      ;**OUT: A...HALBBYTE
                         C      ;       CARRY=1: FALSCHES ASCII-Z.
                         C      ;*KILL: A,F
  C912    D6 30          C      NIBLE:	SUB	'0'
  C914    D8             C      	RET	C
  C915    C6 E9          C      	ADD	A,0E9H
  C917    D8             C      	RET	C
  C918    C6 06          C      	ADD	A,6
  C91A    F2 C920        C      	JP	P,NI0
  C91D    C6 07          C      	ADD	A,7
  C91F    D8             C      	RET	C
  C920    C6 0A          C      NI0:	ADD	A,10
  C922    B7             C      	OR	A
  C923    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE EINES ZEICHENS UEBER DAS TERMINAL
                         C      ;UND TEST AUF ERLAUBTE TRENNZEICHEN
                         C      ;***IN: -
                         C      ;**OUT: A...EINGEGEBENES ZEICHEN
                         C      ;       CARRY=1: EINGEG. Z. IST CR
                         C      ;        ZERO=1: EINGEG. Z. IST LEERZ., KOMMA ODER CR
                         C      ;*KILL: A,F,C
  C924    CD C174        C      PCHK:	CALL	TI
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUM TEST AUF ERLAUBTE TRENNZEICHEN
                         C      ;***IN: A...ZEICHEN
                         C      ;**OUT: -
                         C      ;       CARRY=1: EINGEG. Z. IST CR
                         C      ;        ZERO=1: EINGEG. Z. IST LEERZ., KOMMA ODER CR
                         C      ;*KILL: F
  C927    FE 20          C      P2C:	CP	' '
  C929    C8             C      	RET	Z
  C92A    FE 2C          C      	CP	','
  C92C    C8             C      	RET	Z
  C92D    FE 0D          C      	CP	0DH
  C92F    37             C      	SCF
  C930    C8             C      	RET	Z
  C931    3F             C      	CCF
  C932    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR EINGABE EINES BIN. BYTES UEBER DAS LOG. GERAET "I"
                         C      ;UND ADDIEREN DES BYTES ZUM INHALT VON D
                         C      ;***IN: -
                         C      ;**OUT: A...EINGEGEBENES BYTE
                         C      ;       D=D+A
                         C      ;       FLAGS...ENTSPR. DEM ERGEBNIS DER ADD.
                         C      ;*KILL: A,F,D
  C933    C5             C      IBYTE:	PUSH	BC
  C934    CD C0E3        C      	CALL	MRI
  C937    CD C912        C      	CALL	NIBLE
  C93A    07             C      	RLCA
  C93B    07             C      	RLCA
  C93C    07             C      	RLCA
  C93D    07             C      	RLCA
  C93E    4F             C      	LD	C,A
  C93F    CD C0E3        C      	CALL	MRI
  C942    CD C912        C      	CALL	NIBLE
  C945    B1             C      	OR	C
  C946    4F             C      	LD	C,A
  C947    82             C      	ADD	A,D
	MACRO-80 V3.50	25-Oct-85	Page	1-28
'DEBUGGER'

  C948    57             C      	LD	D,A
  C949    79             C      	LD	A,C
  C94A    C1             C      	POP	BC
  C94B    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON 16 BIT BIN. INF. ALS ASCII-Z. UEBER GERAET "O"
                         C      ;***IN: HL...BIN. INF.
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C94C    7C             C      OADR:	LD	A,H
  C94D    CD C951        C      	CALL	OBYTE
  C950    7D             C      	LD	A,L
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON  8 BIT BIN. INF. ALS ASCII-Z. UEBER GERAET "O"
                         C      ;***IN: A...BIN. INF.
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C951    5F             C      OBYTE:	LD	E,A
  C952    0F             C      	RRCA
  C953    0F             C      	RRCA
  C954    0F             C      	RRCA
  C955    0F             C      	RRCA
  C956    CD C8A1        C      	CALL	CONV
  C959    CD C0E9        C      	CALL	MWO
  C95C    7B             C      	LD	A,E
  C95D    CD C8A1        C      	CALL	CONV
  C960    CD C0E9        C      	CALL	MWO
  C963    7B             C      	LD	A,E
  C964    82             C      	ADD	A,D
  C965    57             C      	LD	D,A
  C966    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON CR UND LF AUF DEM GERAET "O"
                         C      ;***IN: -
                         C      ;**OUT: -
                         C      ;*KILL: A,F,C
  C967    CD C89A        C      OCRLF:	CALL	POC
  C96A    0D             C      	DB	0DH
  C96B    CD C89A        C      	CALL	POC
  C96E    0A             C      	DB	0AH
  C96F    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Monitorkommandos
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;KOMMANDO COPY
  C970    CD C0E3        C      COPY::	CALL	MRI
  C973    FE 03          C      	CP	ETX
  C975    C8             C      	RET	Z
  C976    4F             C      	LD	C,A
  C977    CD C0EC        C      	CALL	MLO
  C97A    18 F4          C      	JR	COPY
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;DISPLAY-KOMMANDO
  C97C    CD C8D3        C      DISP::	CALL	EXPR
  C97F    D1             C      	POP	DE		;ENDADRESSE IN DE
  C980    E1             C      	POP	HL		;ANFANGSADRESSE IN HL
                         C      ;AUSGABE DER ADRESSE
  C981    CD C320        C      DI0:	CALL	CRLF
  C984    CD C8BC        C      	CALL	LADR
                         C      ;AUSGABE EINES LEERZEICHENS
  C987    0E 20          C      DI1:	LD	C,' '
  C989    CD C0EC        C      	CALL	MLO
                         C      ;AUSGABE EINES BYTES
  C98C    7E             C      	LD	A,(HL)
  C98D    CD C8C1        C      	CALL	LBYTE
	MACRO-80 V3.50	25-Oct-85	Page	1-29
'DEBUGGER'

                         C      ;KOMMANDO-ENDE ?
  C990    CD C890        C      	CALL	HILO
  C993    DA C320        C      	JP	C,CRLF
                         C      ;ZEILENENDE ?
  C996    7D             C      	LD	A,L
  C997    E6 0F          C      	AND	0FH
  C999    20 EC          C      	JR	NZ,DI1
  C99B    18 E4          C      	JR	DI0
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;END-FILE KOMMANDO
  C99D    0D             C      EOF::	DEC	C
  C99E    CD C8D3        C      	CALL	EXPR		;EINGABE DER STARTADRESSE
                         C      ;AUSGABE VON ":"
  C9A1    CD C89A        C      	CALL	POC
  C9A4    3A             C      	DB	':'
                         C      ;AUSGABE DER REKORDLAENGE 0
  C9A5    AF             C      	XOR	A
  C9A6    57             C      	LD	D,A
  C9A7    CD C951        C      	CALL	OBYTE
                         C      ;AUSGABE DER STARTADRESSE
  C9AA    E1             C      	POP	HL
  C9AB    CD C94C        C      	CALL	OADR
                         C      ;AUSGABE DES DATENTYPS
  C9AE    3E 01          C      	LD	A,1
  C9B0    CD C951        C      	CALL	OBYTE
                         C      ;BERECHNUNG UND AUSGABE DER CHECKSUMME
  C9B3    AF             C      	XOR	A
  C9B4    92             C      	SUB	D
  C9B5    CD C951        C      	CALL	OBYTE
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBR. ZUR AUSGABE VON 60 LEERSTELLEN AUF DEM GERAET "O"
                         C      ;***IN: -
                         C      ;**OUT: -
                         C      ;*KILL: A,F,B,C
  C9B8    06 3C          C      LEAD:	LD	B,60
  C9BA    CD C89A        C      LE0:	CALL	POC
  C9BD    00             C      	DB	0
  C9BE    10 FA          C      	DJNZ	LE0
  C9C0    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;FILL-KOMMANDO
  C9C1    0C             C      FILL::	INC	C
  C9C2    CD C8D3        C      	CALL	EXPR
  C9C5    C1             C      	POP	BC		;KONSTANTE IN C
  C9C6    D1             C      	POP	DE		;ENDADRESSE IN DE
  C9C7    E1             C      	POP	HL		;ANFANGSADRESSE IN HL
  C9C8    71             C      FI0:	LD	(HL),C
  C9C9    CD C890        C      	CALL	HILO
  C9CC    30 FA          C      	JR	NC,FI0
  C9CE    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;GO-KOMMANDO
                         C      ;VORBEREITEN DES SPRUNGES IN DAS ANWENDERPROGRAMM
  C9CF    21 C879        C      GOTO::	LD	HL,EXIT
  C9D2    E3             C      	EX	(SP),HL
                         C      ;STARTADRESSE ?
  C9D3    CD C924        C      	CALL	PCHK
  C9D6    28 0A          C      	JR	Z,GO0		;KEINE STARTADRESSE ANGEGEBEN
                         C      ;EINGABE DER STARTADRESSE
  C9D8    CD C8E8        C      	CALL	PA0
  C9DB    EB             C      	EX	DE,HL
  C9DC    21 F5E6        C      	LD	HL,PLOC
  C9DF    72             C      	LD	(HL),D
  C9E0    2B             C      	DEC	HL
  C9E1    73             C      	LD	(HL),E
	MACRO-80 V3.50	25-Oct-85	Page	1-30
'DEBUGGER'

  C9E2    38 25          C      GO0:	JR	C,GO4		;KEINE HALTEPUNKTE ANGEGEBEN
  C9E4    11 0002        C      	LD	DE,2
                         C      ;EINGABE DES HALTEPUNKTES
  C9E7    CD C036        C      GO1:	CALL	COMC
  C9EA    2D             C      	DB	'-'
  C9EB    CD C8E3        C      	CALL	PARAM
  C9EE    E5             C      	PUSH	HL
  C9EF    14             C      	INC	D
  C9F0    38 06          C      	JR	C,GO2		;NUR EIN HALTEPUNKT
  C9F2    1D             C      	DEC	E
  C9F3    20 F2          C      	JR	NZ,GO1
  C9F5    D2 C050        C      	JP	NC,ERROR
  C9F8    21 F5E7        C      GO2:	LD	HL,TLOC
                         C      ;ADRESSE DER HALTEPUNKTE IN TABELLE
  C9FB    C1             C      GO3:	POP	BC
  C9FC    71             C      	LD	(HL),C
  C9FD    23             C      	INC	HL
  C9FE    70             C      	LD	(HL),B
  C9FF    23             C      	INC	HL
                         C      ;RETTEN DES SPEICHERINHALTES AM HALTEPUNKT
  CA00    0A             C      	LD	A,(BC)
  CA01    77             C      	LD	(HL),A
  CA02    23             C      	INC	HL
                         C      ;SETZEN DES HALTEPUNKTES
  CA03    3E FF          C      	LD	A,0FFH		;RST 56
  CA05    02             C      	LD	(BC),A
  CA06    15             C      	DEC	D
  CA07    20 F2          C      	JR	NZ,GO3
  CA09    C3 C320        C      GO4:	JP	CRLF		;SPRUNG IN ANWENDERPROGRAMM
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;ADDITION UND SUBTRAKTION VON HEXADEZIMALZAHLEN
  CA0C    CD C8D3        C      HEXN::	CALL	EXPR
  CA0F    CD C320        C      	CALL	CRLF
  CA12    D1             C      	POP	DE		;2. OPERAND IN DE
  CA13    E1             C      	POP	HL		;1. OPERAND IN HL
  CA14    E5             C      	PUSH	HL
  CA15    19             C      	ADD	HL,DE		;ADDITION
  CA16    CD C8BC        C      	CALL	LADR		;AUSGABE DER SUMME
  CA19    CD C18A        C      	CALL	BLK
  CA1C    E1             C      	POP	HL
  CA1D    B7             C      	OR	A
  CA1E    ED 52          C      	SBC	HL,DE		;SUBTRAKTION
  CA20    C3 C8BC        C      	JP	LADR		;AUSGABE DER DIFFERENZ
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;MOVE-KOMMANDO
  CA23    0C             C      MOVE::	INC	C
  CA24    CD C8D3        C      	CALL	EXPR
  CA27    C1             C      	POP	BC		;ADRESSE DES ZIELGEBIETES IN BC
  CA28    D1             C      	POP	DE		;ENDADRESSE DES QUELLGEB. IN DE
  CA29    E1             C      	POP	HL		;ANFANGSADRESSE DES QUELLGEB. IN HL
  CA2A    7E             C      MV0:	LD	A,(HL)
  CA2B    02             C      	LD	(BC),A
  CA2C    03             C      	INC	BC
  CA2D    CD C03D        C      	CALL	ZS		;ERHOLZEIT PROG.-MONO
  CA30    CD C890        C      	CALL	HILO
  CA33    30 F5          C      	JR	NC,MV0
  CA35    C9             C      	RET
                         C      ;-------------------------------------------------------
                         C      ;Abfrage der Geraetezuweisung und Ausgabe auf Bildschirm
  CA36    06 03          C      query:	ld	b,3	;Anzahl Kanaele
  CA38    21 C3AC        C      	ld	hl,ltbl
  CA3B    CD C320        C      q0:	call	crlf
  CA3E    4E             C      	ld	c,(hl)
  CA3F    CD C0E6        C      	call	mco
  CA42    CD C036        C      	call	comc
	MACRO-80 V3.50	25-Oct-85	Page	1-31
'DEBUGGER'

  CA45    3D             C      	db	'='
  CA46    23             C      	inc	hl	;Bestimmung des zugewiesenen Geraetes
  CA47    7E             C      	ld	a,(hl)
  CA48    2F             C      	cpl
  CA49    4F             C      	ld	c,a
  CA4A    23             C      	inc	hl
  CA4B    5E             C      	ld	e,(hl)
  CA4C    23             C      	inc	hl
  CA4D    56             C      	ld	d,(hl)
  CA4E    23             C      	inc	hl
  CA4F    EB             C      	ex	de,hl
  CA50    3A F5FF        C      	ld	a,(iobyt)
  CA53    A1             C      	and	c
  CA54    C5             C      	push	bc
  CA55    06 04          C      	ld	b,4
  CA57    4E             C      q1:	ld	c,(hl)
  CA58    23             C      	inc	hl
  CA59    BE             C      	cp	(hl)
  CA5A    28 03          C      	jr	z,q2
  CA5C    23             C      	inc	hl
  CA5D    10 F8          C      	djnz	q1
  CA5F    CD C0E6        C      q2:	call	mco	;Ausgabe des physischen Geraetes
  CA62    EB             C      	ex	de,hl
  CA63    C1             C      	pop	bc
  CA64    10 D5          C      	djnz	q0
  CA66    C9             C      	ret
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;READ-KOMMANDO
                         C      ;E,C RECORDLAENGE
                         C      ;HL,DE RECORDADRESSE
                         C      ;D PRUEFSUMME 
  CA67    0D             C      READ::	DEC	C		;NUR 1 PARAMETER
  CA68    CD C8D3        C      	CALL	EXPR		;EINGABE DES OFFSET AUF STACK
  CA6B    CD C320        C      	CALL	CRLF
                         C      ;WARTEN AUF EINGABE VON ":"
  CA6E    CD C0E3        C      RED0:	CALL	MRI
  CA71    FE 3A          C      	CP	':'
  CA73    20 F9          C      	JR	NZ,RED0
  CA75    AF             C      	XOR	A
  CA76    57             C      	LD	D,A		;LOESCHEN F. PRFUEFSUMME
  CA77    CD C933        C      	CALL	IBYTE		;EINGABE DER REKORDLAENGE
  CA7A    28 2F          C      	JR	Z,RED3		;REKORDLAENGE = 0
  CA7C    5F             C      	LD	E,A
  CA7D    4B             C      	LD	C,E
                         C      ;EINGABE DER REKORDADRESSE 
  CA7E    CD C933        C      	CALL	IBYTE
  CA81    67             C      	LD	H,A
  CA82    CD C933        C      	CALL	IBYTE
  CA85    6F             C      	LD	L,A
  CA86    E5             C      	PUSH	HL		;AUF STACK SCHAFFEN
                         C      ;EINGABE DES DATENTYPS
  CA87    CD C933        C      	CALL	IBYTE		;NICHT AUSGEWERTET
                         C      ;EINGABE DER REKORDINFORMATION IN PUFFER
  CA8A    21 FF00        C      	LD	HL,0FF00H	;PUFFER 0FFH UNTER STACK
  CA8D    39             C      	ADD	HL,SP
  CA8E    CD C933        C      RED1:	CALL	IBYTE
  CA91    77             C      	LD	(HL),A
  CA92    23             C      	INC	HL
  CA93    1D             C      	DEC	E
  CA94    20 F8          C      	JR	NZ,RED1
  CA96    CD C933        C      	CALL	IBYTE		;EINGABE DER CHECKSUMME
  CA99    C2 C050        C      	JP	NZ,ERROR	;FALSCHE CHECKSUMME
                         C      ;BERECHNUNG DER LADEADRESSE
  CA9C    D1             C      	POP	DE		;RECORDADRESSE
  CA9D    E3             C      	EX	(SP),HL		;OFFSET
	MACRO-80 V3.50	25-Oct-85	Page	1-32
'DEBUGGER'

  CA9E    EB             C      	EX	DE,HL
  CA9F    19             C      	ADD	HL,DE
  CAA0    06 00          C      	LD	B,0
  CAA2    09             C      	ADD	HL,BC
  CAA3    EB             C      	EX	DE,HL
  CAA4    E3             C      	EX	(SP),HL
                         C      ;LADEN DES GELESENEN REKORDS AUF RICHTIGE ADRESSE
  CAA5    2B             C      RED2:	DEC	HL
  CAA6    1B             C      	DEC	DE
  CAA7    ED B8          C      	LDDR
  CAA9    18 C3          C      	JR	RED0
                         C      ;LADEN DER STARTADRESSE
  CAAB    21 F5E6        C      RED3:	LD	HL,PLOC
  CAAE    CD C933        C      	CALL	IBYTE
  CAB1    77             C      	LD	(HL),A
  CAB2    2B             C      	DEC	HL
  CAB3    CD C933        C      	CALL	IBYTE
  CAB6    77             C      	LD	(HL),A
  CAB7    E1             C      	POP	HL
  CAB8    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SUBSTITUTE-KOMMANDO
  CAB9    CD C8E3        C      SUBS::	CALL	PARAM		;EINGABE DER 1. ADRESSE (HL)
  CABC    D8             C      	RET	C
                         C      ;ANZEIGE DES BYTES
  CABD    7E             C      SU0:	LD	A,(HL)
  CABE    CD C8C1        C      	CALL	LBYTE
  CAC1    CD C036        C      	CALL	COMC
  CAC4    2D             C      	DB	'-'
  CAC5    CD C924        C      	CALL	PCHK
  CAC8    D8             C      	RET	C		;ENDE DES KOMMANDOS (CR)
  CAC9    28 07          C      	JR	Z,SU1		;KEINE AENDERUNG DES INHALTES (LEERZ.)
                         C      ;EINGABE DES NEUEN SPEICHERINHALTES
  CACB    EB             C      	EX	DE,HL
  CACC    CD C8E8        C      	CALL	PA0
  CACF    EB             C      	EX	DE,HL
  CAD0    73             C      	LD	(HL),E
  CAD1    D8             C      	RET	C			;ENDE DES KOMMANDOS (CR)
  CAD2    23             C      SU1:	INC	HL
  CAD3    18 E8          C      	JR	SU0
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;SPEICHERTEST
  CAD5    CD C8D3        C      KNOW::	CALL	EXPR
  CAD8    06 00          C      	LD	B,0
  CADA    D1             C      	POP	DE		;ENDEADR
  CADB    E1             C      ST1:	POP	HL		;ANF-ADR
  CADC    E5             C      	PUSH	HL
  CADD    7D             C      ST2:	LD	A,L		;FILL
  CADE    AC             C      	XOR	H
  CADF    A8             C      	XOR	B
  CAE0    77             C      	LD	(HL),A
  CAE1    CD C890        C      	CALL	HILO
  CAE4    30 F7          C      	JR	NC,ST2
  CAE6    E1             C      	POP	HL
  CAE7    7D             C      ST3:	LD	A,L
  CAE8    AC             C      	XOR	H
  CAE9    A8             C      	XOR	B
  CAEA    BE             C      	CP	(HL)
  CAEB    20 57          C      	JR	NZ,V1
  CAED    CD C890        C      	CALL	HILO
  CAF0    30 F5          C      	JR	NC,ST3
  CAF2    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;WRITE-KOMMANDO
  CAF3    CD C8D3        C      WRITE::	CALL	EXPR
	MACRO-80 V3.50	25-Oct-85	Page	1-33
'DEBUGGER'

  CAF6    CD C320        C      	CALL	CRLF
  CAF9    D1             C      	POP	DE		;ENDADRESSE IN DE
  CAFA    E1             C      	POP	HL		;ANFANGSADRESSE IN HL
                         C      ;AUSGABE VON ":"
  CAFB    CD C89A        C      WR0:	CALL	POC
  CAFE    3A             C      	DB	':'
                         C      ;BESTIMMEN DER REKORDLAENGE
  CAFF    01 0010        C      	LD	BC,16
  CB02    E5             C      	PUSH	HL
  CB03    04             C      WR1:	INC	B
  CB04    0D             C      	DEC	C
  CB05    28 05          C      	JR	Z,WR2
  CB07    CD C890        C      	CALL	HILO
  CB0A    30 F7          C      	JR	NC,WR1
  CB0C    E1             C      WR2:	POP	HL
  CB0D    D5             C      	PUSH	DE
  CB0E    16 00          C      	LD	D,0
  CB10    78             C      	LD	A,B
  CB11    CD C951        C      	CALL	OBYTE		;AUSGABE DER REKORDLAENGE
  CB14    CD C94C        C      	CALL	OADR		;AUSGABE DER REKORDADRESSE
                         C      ;AUSGABE DES DATENTYPS
  CB17    AF             C      	XOR	A
  CB18    CD C951        C      	CALL	OBYTE
                         C      ;AUSGABE DER REKORDINFORMATION
  CB1B    7E             C      WR3:	LD	A,(HL)
  CB1C    CD C951        C      	CALL	OBYTE
  CB1F    23             C      	INC	HL
  CB20    10 F9          C      	DJNZ	WR3
                         C      ;BERECHNUNG UND AUSGABE DER CHECKSUMME
  CB22    AF             C      	XOR	A
  CB23    92             C      	SUB	D
  CB24    CD C951        C      	CALL	OBYTE
  CB27    D1             C      	POP	DE
  CB28    2B             C      	DEC	HL
                         C      ;AUSGABE VON CR,LF
  CB29    CD C967        C      	CALL	OCRLF
  CB2C    CD C890        C      	CALL	HILO
  CB2F    30 CA          C      	JR	NC,WR0
  CB31    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;VERGLEICH VON SPEICHERINHALTEN
  CB32    0C             C      VER::	INC	C
  CB33    CD C8D3        C      	CALL	EXPR
  CB36    C1             C      	POP	BC		;ZIEL
  CB37    D1             C      	POP	DE		;ENDE
  CB38    E1             C      	POP	HL		;START
  CB39    0A             C      V2:	LD	A,(BC)
  CB3A    BE             C      	CP	(HL)
  CB3B    20 07          C      	JR	NZ,V1		;BEI FEHLER
  CB3D    03             C      	INC	BC
  CB3E    CD C890        C      	CALL	HILO
  CB41    30 F6          C      	JR	NC,V2
  CB43    C9             C      	RET
  CB44    CD C320        C      V1:	CALL	CRLF
  CB47    CD C8BC        C      	CALL	LADR
  CB4A    C9             C      	RET
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;X-KOMMANDO
  CB4B    21 CBA9        C      X::	LD	HL,ACTBL
  CB4E    CD C924        C      	CALL	PCHK
  CB51    38 37          C      	JR	C,X5		;AUSGABE ALLER REGISTER
                         C      ;BESTIMMUNG DER AUSZUGEBENDEN REGISTER
  CB53    0E 0B          C      	LD	C,NREGS
  CB55    BE             C      X0:	CP	(HL)
  CB56    28 09          C      	JR	Z,MX1
	MACRO-80 V3.50	25-Oct-85	Page	1-34
'DEBUGGER'

  CB58    23             C      	INC	HL
  CB59    23             C      	INC	HL
  CB5A    23             C      	INC	HL
  CB5B    0D             C      	DEC	C
  CB5C    20 F7          C      	JR	NZ,X0
  CB5E    C3 C050        C      	JP	ERROR
  CB61    CD C18A        C      MX1:	CALL	BLK
                         C      ;AUSGABE DES AKTUELLEN REGISTERINHALTES
  CB64    CD C8AB        C      MX2:	CALL	LREG
  CB67    CD C036        C      	CALL	COMC
  CB6A    2D             C      	DB	'-'
  CB6B    CD C924        C      	CALL	PCHK
  CB6E    D8             C      	RET	C			;ENDE DES KOMMANDOS (CR)
  CB6F    28 10          C      	JR	Z,X4		;ANZEIGE DES NAECHSTEN REG. (LEERZ.)
  CB71    E5             C      	PUSH	HL
  CB72    C5             C      	PUSH	BC
                         C      ;EINGABE EINES NEUEN REGISTERINHALTES
  CB73    CD C8E8        C      	CALL	PA0
  CB76    7D             C      	LD	A,L
  CB77    12             C      	LD	(DE),A
  CB78    F1             C      	POP	AF
  CB79    B7             C      	OR	A
  CB7A    FA CB80        C      	JP	M,X3		; 8 BIT-REGISTER
                         C      ;16 BIT-REGISTER
  CB7D    13             C      	INC	DE
  CB7E    7C             C      	LD	A,H
  CB7F    12             C      	LD	(DE),A
  CB80    E1             C      X3:	POP	HL
  CB81    AF             C      X4:	XOR	A
  CB82    B6             C      	OR	(HL)
  CB83    F8             C      	RET	M		;ALLE REGISTER ANGEZEIGT
  CB84    78             C      	LD	A,B
  CB85    FE 0D          C      	CP	0DH
  CB87    C8             C      	RET	Z			;ENDE DES KOMMANDOS
  CB88    18 DA          C      	JR	MX2
                         C      ;ANZEIGE ALLER REGISTER
  CB8A    CD C320        C      X5:	CALL	CRLF
  CB8D    E5             C      	PUSH	HL			;M AKTUALISIEREN
  CB8E    2A F5E1        C      	LD	HL,(LLOC)
  CB91    7E             C      	LD	A,M
  CB92    32 F5D4        C      	LD	(MLOC),A
  CB95    E1             C      	POP	HL
  CB96    CD C18A        C      X6:	CALL	BLK
  CB99    AF             C      	XOR	A
  CB9A    B6             C      	OR	(HL)
  CB9B    F8             C      	RET	M		;TABELLENENDE MINUS=FF
  CB9C    4E             C      	LD	C,(HL)
  CB9D    CD C0E6        C      	CALL	MCO		;AUSGABE DES REGISTER-NAMENS
  CBA0    CD C036        C      	CALL	COMC
  CBA3    3D             C      	DB	'='
  CBA4    CD C8AB        C      	CALL	LREG		;AUSGABE DES REGISTER-INHALTES
  CBA7    18 ED          C      	JR	X6
                         C      ;TABELLE DER REGISTER-ADRESSEN
  CBA9    41 CF 00       C      ACTBL:	DB	'A',LOW(ALOC),0
  CBAC    42 CD 00       C      	DB	'B',LOW(BLOC),0
  CBAF    43 CC 00       C      	DB	'C',LOW(CLOC),0
  CBB2    44 CB 00       C      	DB	'D',LOW(DLOC),0
  CBB5    45 CA 00       C      	DB	'E',LOW(ELOC),0
  CBB8    46 CE 00       C      	DB	'F',LOW(FLOC),0
  CBBB    48 E2 00       C      	DB	'H',LOW(HLOC),0
  CBBE    4C E1 00       C      	DB	'L',LOW(LLOC),0
  CBC1    4D D4 00       C      	DB	'M',LOW(MLOC),0
  CBC4    50 E6 01       C      	DB	'P',LOW(PLOC),1
  CBC7    53 DF 01       C      	DB	'S',LOW(SLOC),1
  CBCA    FF             C      	DB	0FFH
	MACRO-80 V3.50	25-Oct-85	Page	1-35
'DEBUGGER'

  000B                   C      NREGS	EQU	($-ACTBL)/3
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;Z-KOMMANDO
  CBCB    21 CBD8        C      ZR::	LD	HL,ZACTL
  CBCE    CD C924        C      	CALL	PCHK
  CBD1    38 B7          C      	JR	C,X5		;ANZEIGE ALLER REGISTER
  CBD3    0E 0B          C      	LD	C,ZREGS
  CBD5    C3 CB55        C      	JP	X0
                         C      ;TABELLE DER REGISTERADRESSEN
  CBD8    41 DD 00       C      ZACTL:	DB	'A',LOW(ASLC),0
  CBDB    42 DB 00       C      	DB	'B',LOW(BSLC),0
  CBDE    43 DA 00       C      	DB	'C',LOW(CSLC),0
  CBE1    44 D9 00       C      	DB	'D',LOW(DSLC),0
  CBE4    45 D8 00       C      	DB	'E',LOW(ESLC),0
  CBE7    46 DC 00       C      	DB	'F',LOW(FSLC),0
  CBEA    48 D7 00       C      	DB	'H',LOW(HSLC),0
  CBED    4C D6 00       C      	DB	'L',LOW(LSLC),0
  CBF0    49 D5 00       C      	DB	'I',LOW(ILOC),0
  CBF3    58 D1 01       C      	DB	'X',LOW(XLOC+1),1
  CBF6    59 D3 01       C      	DB	'Y',LOW(YLOC+1),1
  CBF9    FF             C      	DB	0FFH
  000B                   C      ZREGS	EQU	($-ZACTL)/3
  CBFA                          ds	monitor+0c00h-$,0ffh
                                	SUBTTL	'REASSEMBLER'
                                page
	MACRO-80 V3.50	25-Oct-85	Page	1-36
'REASSEMBLER'

                                
                         C      include RE.MAC
                         C      
                         C      ;IX=ANFANGSADRESSE
                         C      ;BC=ENDEADRESSE
                         C      ;E'=0 NORM.BEF.
                         C      ;E'=80 DD-BEF.
                         C      ;E'=C0 FD-BEF.
                         C      ;E'=E+1 CB-BEF.
                         C      ;D'=OP.-CODE VOM SPEICHER
                         C      ;A'=DISPLACEMENT BEI FD-BEFEHLEN
                         C      ;MNETAB,CBTAB,EDTAB IN EINER SPEICHERSEITE
                         C      ;TABELLEN DER OP-CODES: 
                         C      ;1.BYTE GLEICHE BITS EINER GRUPPE AUF H
                         C      ;2.BYTE GLEICHE BITS AUF 0
                         C      ;3.-LETZTES BYTE=TEXT, MANCHMAL CODIERT ALS NICHT-ASCII-ZEICHEN
                         C      
  CC00    CD C8D3        C      PRINT:	CALL	EXPR
  CC03    C1             C      	POP	BC
  CC04    03             C      	INC	BC
  CC05    DD E1          C      	POP	IX
  CC07    11 0000        C      	LD	DE,0000H	;ZAEHL.AUSGEG.BYTES
  CC0A    DD E5          C      M0001:	PUSH	IX
  CC0C    E1             C      	POP	HL
  CC0D    7D             C      	LD	A,L
  CC0E    91             C      	SUB	C
  CC0F    7C             C      	LD	A,H
  CC10    98             C      	SBC	A,B
  CC11    D0             C      	RET	NC
  CC12    19             C      	ADD	HL,DE
  CC13    CD CE8C        C      	CALL	M0018
  CC16    D9             C      	EXX
  CC17    3E 03          C      	LD	A,03H		;3 LEERZEICH.
  CC19    CD CE45        C      	CALL	M0015
  CC1C    1E 00          C      	LD	E,00H
  CC1E    DD 7E 00       C      M0002:	LD	A,(IX)
  CC21    FE DD          C      	CP	0DDH
  CC23    20 04          C      	JR	NZ,M0003
  CC25    1E 80          C      	LD	E,80H		;DD-BEF.
  CC27    18 06          C      	JR	M0004
  CC29    FE FD          C      M0003:	CP	0FDH
  CC2B    20 0A          C      	JR	NZ,M0005
  CC2D    1E C0          C      	LD	E,0C0H		;FD-BEF.
  CC2F    DD 7E 02       C      M0004:	LD	A,(IX+2)	;DISPLACEMENT
  CC32    08             C      	EX	AF,AF'
  CC33    DD 23          C      	INC	IX
  CC35    18 E7          C      	JR	M0002
  CC37    21 CCEC        C      M0005:	LD	HL,MNETB-1
  CC3A    FE ED          C      	CP	0EDH
  CC3C    28 13          C      	JR	Z,M0006
  CC3E    FE CB          C      	CP	0CBH
  CC40    20 18          C      	JR	NZ,M0008
  CC42    CB C3          C      	SET	0,E		;CB-BEF.
  CC44    2E 77          C      	LD	L,LOW(CBTAB-1)
  CC46    CB 7B          C      	BIT	7,E
  CC48    28 0B          C      	JR	Z,M0007
  CC4A    DD 23          C      	INC	IX
  CC4C    DD 7E 01       C      	LD	A,(IX+1)	;OP.CODE CB-BEF.
  CC4F    18 09          C      	JR	M0008
  CC51    2E 97          C      M0006:	LD	L,LOW(EDTAB-1)	;ED-BEF.
  CC53    1E 20          C      	LD	E,20H
  CC55    DD 23          C      M0007:	INC	IX
  CC57    DD 7E 00       C      	LD	A,(IX)
                         C      ;SUCHE OP-CODE IN TABELLE
	MACRO-80 V3.50	25-Oct-85	Page	1-37
'REASSEMBLER'

                         C      ;IN: A OP.-CODE HL TAB.-ANF.
  CC5A    57             C      M0008:	LD	D,A
  CC5B    CB 7E          C      M0009:	BIT	7,M
  CC5D    23             C      	INC	HL
  CC5E    28 FB          C      	JR	Z,M0009
  CC60    7A             C      	LD	A,D
  CC61    AE             C      	XOR	M		;GLEICHE BITS WEG
  CC62    23             C      	INC	HL
  CC63    A6             C      	AND	M		;VERAENDERLICHE BITS WEG
  CC64    23             C      	INC	HL
  CC65    20 F4          C      	JR	NZ,M0009	;NAECHSTEN TAB.-BLOCK
  CC67    CD CDE8        C      	CALL	M000D
  CC6A    CD CE40        C      	CALL	M0013		;CRLF
  CC6D    DD 23          C      	INC	IX
  CC6F    D9             C      	EXX
  CC70    18 98          C      	JR	M0001
                         C      ;AUFBEREITUNG REGISTER ZUR AUSWERTUNG
                         C      ;Z.B. BEI LD R,R
  CC72    7A             C      M000A:	LD	A,D
  CC73    0F             C      	RRCA
  CC74    0F             C      	RRCA
  CC75    0F             C      	RRCA
  CC76    A1             C      	AND	C
  CC77    C9             C      	RET
                         C      ;AUSGABE ZEICHEN (A)
                         C      ;CB-BEFEHLE
  CC78    00             C      CBTAB:	DB	0		;RLC B
  CC79    C0             C      	DB	0C0H
  CC7A    7B             C      	DB	7BH
  CC7B    02             C      	DB	02
  CC7C    F4             C      	DB	0F4H
  CC7D    40             C      	DB	40H		;BIT 0,B
  CC7E    C0             C      	DB	0C0H
  CC7F    42 49 54       C      	DB	'BIT'
  CC82    02             C      	DB	2
  CC83    68             C      	DB	68H
  CC84    2C             C      	DB	','
  CC85    F4             C      	DB	0F4H
  CC86    80             C      	DB	80H		;RES 0,B
  CC87    C0             C      	DB	0C0H
  CC88    52 45 53       C      	DB	'RES'
  CC8B    02             C      	DB	2
  CC8C    68             C      	DB	68H
  CC8D    2C             C      	DB	','
  CC8E    F4             C      	DB	0F4H
  CC8F    C0             C      	DB	0C0H		;SET 0,B
  CC90    C0             C      	DB	0C0H
  CC91    53 45 54       C      	DB	'SET'
  CC94    02             C      	DB	2
  CC95    68             C      	DB	68H
  CC96    2C             C      	DB	','
  CC97    F4             C      	DB	0F4H
                         C      ;------------------------------------------------ED-BEFEHLE
  CC98    40             C      EDTAB:	DB	40H		;IN B,(C)
  CC99    C7             C      	DB	0C7H
  CC9A    1A             C      	DB	1AH
  CC9B    03             C      	DB	3
  CC9C    76             C      	DB	76H
  CC9D    0A             C      	DB	0AH
  CC9E    43             C      	DB	43H
  CC9F    A9             C      	DB	0A9H 
  CCA0    41             C      	DB	41H		;OUT (C),B
  CCA1    C7             C      	DB	0C7H
  CCA2    1B             C      	DB	1BH
  CCA3    02             C      	DB	2
	MACRO-80 V3.50	25-Oct-85	Page	1-38
'REASSEMBLER'

  CCA4    28             C      	DB	28H
  CCA5    43             C      	DB	43H
  CCA6    0B             C      	DB	0BH
  CCA7    F6             C      	DB	0F6H
  CCA8    42             C      	DB	42H		;SBC HL,BC
  CCA9    CF             C      	DB	0CFH
  CCAA    1F             C      	DB	1FH
  CCAB    02             C      	DB	2H
  CCAC    12             C      	DB	12H
  CCAD    2C             C      	DB	','
  CCAE    EB             C      	DB	0EBH
  CCAF    4A             C      	DB	4AH		;ADC HL,BC
  CCB0    CF             C      	DB	0CFH
  CCB1    1D             C      	DB	1DH
  CCB2    02             C      	DB	2
  CCB3    12             C      	DB	12H
  CCB4    2C             C      	DB	','
  CCB5    EB             C      	DB	0EBH
  CCB6    4B             C      	DB	4BH		;LD BC,(ADR)
  CCB7    CF             C      	DB	0CFH
  CCB8    01             C      	DB	1
  CCB9    6B             C      	DB	6BH
  CCBA    0A             C      	DB	0AH
  CCBB    70             C      	DB	70H
  CCBC    A9             C      	DB	0A9H
  CCBD    43             C      	DB	43H		;LD (ADR),BC
  CCBE    CF             C      	DB	0CFH
  CCBF    01             C      	DB	1
  CCC0    28             C      	DB	'('
  CCC1    70             C      	DB	70H
  CCC2    0B             C      	DB	0BH
  CCC3    EB             C      	DB	0EBH
  CCC4    44             C      	DB	44H		;NEG
  CCC5    C7             C      	DB	0C7H
  CCC6    4E 45          C      	DB	'NE'
  CCC8    C7             C      	DB	0C7H
  CCC9    4D             C      	DB	4DH		;RETI
  CCCA    CF             C      	DB	0CFH
  CCCB    08             C      	DB	8
  CCCC    C9             C      	DB	0C9H
  CCCD    45             C      	DB	45H		;RETN
  CCCE    CF             C      	DB	0CFH
  CCCF    08             C      	DB	8
  CCD0    CE             C      	DB	0CEH
  CCD1    46             C      	DB	46H		;IM 0
  CCD2    FF             C      	DB	0FFH
  CCD3    0D             C      	DB	0DH
  CCD4    B0             C      	DB	0B0H
  CCD5    56             C      	DB	56H		;IM 1
  CCD6    FF             C      	DB	0FFH
  CCD7    0D             C      	DB	0DH
  CCD8    B1             C      	DB	0B1H
  CCD9    5E             C      	DB	5EH		;IM 2
  CCDA    FF             C      	DB	0FFH
  CCDB    0D             C      	DB	0DH
  CCDC    B2             C      	DB	0B2H
  CCDD    47             C      	DB	47H		;LD I,A
  CCDE    E7             C      	DB	0E7H
  CCDF    01             C      	DB	1
  CCE0    F8             C      	DB	0F8H
  CCE1    67             C      	DB	67H		;RRD
  CCE2    F7             C      	DB	0F7H
  CCE3    77             C      	DB	77H
  CCE4    C4             C      	DB	0C4H
  CCE5    A0             C      	DB	0A0H		;LDI
	MACRO-80 V3.50	25-Oct-85	Page	1-39
'REASSEMBLER'

  CCE6    E4             C      	DB	0E4H
  CCE7    6A             C      	DB	6AH
  CCE8    FA             C      	DB	0FAH
  CCE9    00             C      	DB	0
  CCEA    00             C      	DB	0
  CCEB    2A             C      	DB	'*'
  CCEC    F2             C      	DB	0F2H
  CCED    76             C      MNETB:	DB	76H		;HALT
  CCEE    FF             C      	DB	0FFH
  CCEF    48 41 4C       C      	DB	'HAL'
  CCF2    D4             C      	DB	0D4H
  CCF3    40             C      	DB	40H		;LD B,B
  CCF4    C0             C      	DB	0C0H
  CCF5    01             C      	DB	1
  CCF6    76             C      	DB	76H
  CCF7    2C             C      	DB	','
  CCF8    F4             C      	DB	0F4H
  CCF9    06             C      	DB	6		;LD B,N
  CCFA    C7             C      	DB	0C7H
  CCFB    01             C      	DB	1
  CCFC    76             C      	DB	76H
  CCFD    2C             C      	DB	','
  CCFE    EF             C      	DB	0EFH
  CCFF    02             C      	DB	2		;LD (BC),A
  CD00    E7             C      	DB	0E7H
  CD01    01             C      	DB	1
  CD02    F9             C      	DB	0F9H
  CD03    3A             C      	DB	3AH		;LD A,(ADR)
  CD04    FF             C      	DB	0FFH
  CD05    01             C      	DB	1
  CD06    41             C      	DB	'A'
  CD07    0A             C      	DB	0AH
  CD08    70             C      	DB	70H
  CD09    A9             C      	DB	0A9H
  CD0A    32             C      	DB	32H		;LD (ADR),A
  CD0B    FF             C      	DB	0FFH
  CD0C    01             C      	DB	1
  CD0D    28             C      	DB	'('
  CD0E    70             C      	DB	70H
  CD0F    0B             C      	DB	0BH
  CD10    C1             C      	DB	0C1H
  CD11    01             C      	DB	1		;LD BC,NN
  CD12    CF             C      	DB	0CFH
  CD13    01             C      	DB	1
  CD14    6B             C      	DB	6BH
  CD15    2C             C      	DB	','
  CD16    F0             C      	DB	0F0H
  CD17    2A             C      	DB	2AH		;LD XX,(ADR)
  CD18    FF             C      	DB	0FFH
  CD19    01             C      	DB	1
  CD1A    75             C      	DB	75H
  CD1B    0A             C      	DB	0AH
  CD1C    70             C      	DB	70H
  CD1D    A9             C      	DB	0A9H
  CD1E    22             C      	DB	22H		;LD (ADR),XX
  CD1F    FF             C      	DB	0FFH
  CD20    01             C      	DB	1
  CD21    28             C      	DB	'('
  CD22    70             C      	DB	70H
  CD23    0B             C      	DB	0BH
  CD24    F5             C      	DB	0F5H
  CD25    F9             C      	DB	0F9H		;LD SP,XX
  CD26    FF             C      	DB	0FFH
  CD27    01             C      	DB	1
  CD28    13             C      	DB	13H
	MACRO-80 V3.50	25-Oct-85	Page	1-40
'REASSEMBLER'

  CD29    2C             C      	DB	','
  CD2A    F5             C      	DB	0F5H
  CD2B    F5             C      	DB	0F5H		;PUSH AF
  CD2C    FF             C      	DB	0FFH
  CD2D    05             C      	DB	5
  CD2E    84             C      	DB	84H
  CD2F    C5             C      	DB	0C5H		;PUSH BC
  CD30    CF             C      	DB	0CFH
  CD31    05             C      	DB	5
  CD32    EB             C      	DB	0EBH
  CD33    F1             C      	DB	0F1H		;POP AF
  CD34    FF             C      	DB	0FFH
  CD35    06             C      	DB	6
  CD36    84             C      	DB	84H
  CD37    C1             C      	DB	0C1H		;POP BC
  CD38    CF             C      	DB	0CFH
  CD39    06             C      	DB	6
  CD3A    EB             C      	DB	0EBH
  CD3B    20             C      	DB	20H		;JR	NZ
  CD3C    E7             C      	DB	0E7H
  CD3D    4A 52          C      	DB	'JR'
  CD3F    03             C      	DB	3
  CD40    7E             C      	DB	7EH
  CD41    2C             C      	DB	','
  CD42    F1             C      	DB	0F1H
  CD43    18             C      	DB	18H		;JR
  CD44    FF             C      	DB	0FFH
  CD45    4A 52          C      	DB	'JR'
  CD47    03             C      	DB	3
  CD48    F1             C      	DB	0F1H
  CD49    10             C      	DB	10H		;DJNZ
  CD4A    FF             C      	DB	0FFH
  CD4B    44 4A 4E 5A    C      	DB	'DJNZ '
  CD4F    20             C      
  CD50    F1             C      	DB	0F1H
  CD51    CD             C      	DB	0CDH		;CALL
  CD52    FF             C      	DB	0FFH
  CD53    07             C      	DB	7
  CD54    F0             C      	DB	0F0H
  CD55    C4             C      	DB	0C4H		;CALL NZ
  CD56    C7             C      	DB	0C7H
  CD57    07             C      	DB	7
  CD58    7D             C      	DB	7DH
  CD59    2C             C      	DB	2CH
  CD5A    F0             C      	DB	0F0H
  CD5B    C9             C      	DB	0C9H		;RET
  CD5C    FF             C      	DB	0FFH
  CD5D    88             C      	DB	88H
  CD5E    C0             C      	DB	0C0H		;RET NZ
  CD5F    C7             C      	DB	0C7H
  CD60    08             C      	DB	8
  CD61    02             C      	DB	2
  CD62    FD             C      	DB	0FDH
  CD63    E9             C      	DB	0E9H		;JP (HL)
  CD64    FF             C      	DB	0FFH
  CD65    0C             C      	DB	0CH
  CD66    ED             C      	DB	0EDH
  CD67    04             C      	DB	4		;INC B
  CD68    C6             C      	DB	0C6H
  CD69    69             C      	DB	69H
  CD6A    F6             C      	DB	0F6H
  CD6B    09             C      	DB	9		;ADD XX,BC
  CD6C    CF             C      	DB	0CFH
  CD6D    1C             C      	DB	1CH
  CD6E    02             C      	DB	2
	MACRO-80 V3.50	25-Oct-85	Page	1-41
'REASSEMBLER'

  CD6F    75             C      	DB	75H
  CD70    2C             C      	DB	','
  CD71    EB             C      	DB	0EBH
  CD72    03             C      	DB	3		;INC BC
  CD73    CF             C      	DB	0CFH
  CD74    16             C      	DB	16H
  CD75    EB             C      	DB	0EBH
  CD76    0B             C      	DB	0BH		;DEC BC
  CD77    CF             C      	DB	0CFH
  CD78    17             C      	DB	17H
  CD79    EB             C      	DB	0EBH
  CD7A    80             C      	DB	80H		;ADD B
  CD7B    C0             C      	DB	0C0H
  CD7C    7F             C      	DB	7FH
  CD7D    02             C      	DB	2
  CD7E    F4             C      	DB	0F4H
  CD7F    C6             C      	DB	0C6H		;ADD N
  CD80    C7             C      	DB	0C7H
  CD81    7F             C      	DB	7FH
  CD82    02             C      	DB	2
  CD83    EF             C      	DB	0EFH
  CD84    C3             C      	DB	0C3H		;JP
  CD85    FF             C      	DB	0FFH
  CD86    0C             C      	DB	0CH
  CD87    F0             C      	DB	0F0H
  CD88    C2             C      	DB	0C2H		;JP NZ
  CD89    C7             C      	DB	0C7H
  CD8A    0C             C      	DB	0CH
  CD8B    7D             C      	DB	7DH
  CD8C    2C             C      	DB	2CH 
  CD8D    F0             C      	DB	0F0H
  CD8E    EB             C      	DB	0EBH		;EX DE,HL
  CD8F    FF             C      	DB	0FFH
  CD90    09             C      	DB	9
  CD91    11             C      	DB	11H
  CD92    2C             C      	DB	','
  CD93    92             C      	DB	92H
  CD94    D9             C      	DB	0D9H		;EXX
  CD95    FF             C      	DB	0FFH
  CD96    45 58          C      	DB	'EX'
  CD98    D8             C      	DB	0D8H
  CD99    08             C      	DB	8		;EX	AF,AF'
  CD9A    FF             C      	DB	0FFH
  CD9B    09             C      	DB	9
  CD9C    04             C      	DB	4H
  CD9D    2C             C      	DB	','
  CD9E    04             C      	DB	4
  CD9F    A7             C      	DB	0A7H
  CDA0    E3             C      	DB	0E3H		;EX SP,(XX)
  CDA1    FF             C      	DB	0FFH
  CDA2    09             C      	DB	9
  CDA3    28             C      	DB	'('
  CDA4    13             C      	DB	13H
  CDA5    0B             C      	DB	0BH
  CDA6    F5             C      	DB	0F5H
  CDA7    07             C      	DB	7		;RLCA
  CDA8    E7             C      	DB	0E7H
  CDA9    7C             C      	DB	7CH
  CDAA    C1             C      	DB	0C1H
  CDAB    DB             C      	DB	0DBH		;IN A,(N)
  CDAC    FF             C      	DB	0FFH
  CDAD    1A             C      	DB	1AH
  CDAE    03             C      	DB	3H
  CDAF    41             C      	DB	'A'
  CDB0    0A             C      	DB	0AH
	MACRO-80 V3.50	25-Oct-85	Page	1-42
'REASSEMBLER'

  CDB1    6F             C      	DB	6FH
  CDB2    A9             C      	DB	0A9H
  CDB3    D3             C      	DB	0D3H		;OUT (N),A
  CDB4    FF             C      	DB	0FFH
  CDB5    1B             C      	DB	1BH
  CDB6    02             C      	DB	2
  CDB7    28             C      	DB	'('
  CDB8    6F             C      	DB	6FH
  CDB9    0B             C      	DB	0BH
  CDBA    C1             C      	DB	0C1H
  CDBB    27             C      	DB	27H		;DAA
  CDBC    FF             C      	DB	0FFH
  CDBD    44 41          C      	DB	'DA'
  CDBF    C1             C      	DB	0C1H
  CDC0    2F             C      	DB	2FH		;CPL
  CDC1    FF             C      	DB	0FFH
  CDC2    19             C      	DB	19H
  CDC3    CC             C      	DB	0CCH
  CDC4    3F             C      	DB	3FH		;CCF
  CDC5    FF             C      	DB	0FFH
  CDC6    43 43          C      	DB	'CC'
  CDC8    C6             C      	DB	0C6H
  CDC9    F3             C      	DB	0F3H		;DI
  CDCA    FF             C      	DB	0FFH
  CDCB    44             C      	DB	'D'
  CDCC    C9             C      	DB	0C9H
  CDCD    FB             C      	DB	0FBH		;EI
  CDCE    FF             C      	DB	0FFH
  CDCF    45             C      	DB	'E'
  CDD0    C9             C      	DB	0C9H
  CDD1    37             C      	DB	37H		;SCF
  CDD2    FF             C      	DB	0FFH
  CDD3    53 43          C      	DB	'SC'
  CDD5    C6             C      	DB	0C6H
  CDD6    C7             C      	DB	0C7H		;RST 0
  CDD7    C7             C      	DB	0C7H
  CDD8    52 53 54       C      	DB	'RST'
  CDDB    02             C      	DB	2
  CDDC    6C             C      	DB	6CH
  CDDD    C8             C      	DB	0C8H
  CDDE    00             C      	DB	0		;NOP
  CDDF    FF             C      	DB	0FFH
  CDE0    4E 4F          C      	DB	'NO'
  CDE2    D0             C      	DB	0D0H
                         C      ;STOP TEXTAUSGABE MIT HL AUF Z. HINTER STOP
  CDE3    E1             C      M000C:	POP	HL
  CDE4    CB 7E          C      	BIT	7,M
  CDE6    23             C      	INC	HL
  CDE7    C0             C      	RET	NZ
  CDE8    7E             C      M000D:	LD	A,M		;TEXTAUSGABE (HL')
  CDE9    E5             C      	PUSH	HL
  CDEA    E6 7F          C      	AND	7FH
  CDEC    21 CDE3        C      	LD	HL,M000C
  CDEF    E5             C      	PUSH	HL
  CDF0    FE 20          C      	CP	20H
  CDF2    38 51          C      	JR	C,M0015		;ZEICHEN <20H AUSG.
  CDF4    FE 60          C      	CP	60H
  CDF6    38 4B          C      	JR	C,M0014		;ASCII-ZEICHEN
  CDF8    0E 07          C      	LD	C,07H
  CDFA    C6 89          C      	ADD	A,89H
  CDFC    38 07          C      	JR	C,M000E
  CDFE    21 CE28        C      	LD	HL,M0011	;ZEICHEN <77H
  CE01    85             C      	ADD	A,L
  CE02    6F             C      	LD	L,A
  CE03    6E             C      	LD	L,M
	MACRO-80 V3.50	25-Oct-85	Page	1-43
'REASSEMBLER'

  CE04    E9             C      	JP	(HL)
                         C      
                         C      
  CE05    21 CF37        C      M000E:	LD	HL,T2
  CE08    85             C      	ADD	A,L
  CE09    6F             C      	LD	L,A
  CE0A    6E             C      	LD	L,M
  CE0B    CD CC72        C      	CALL	M000A		;REG. VORB.
  CE0E    3C             C      M000F:	INC	A
  CE0F    CB 7E          C      M0010:	BIT	7,M		;SUCHE Z.MIT STOP,MAX (A) PLAETZE
  CE11    23             C      	INC	HL
  CE12    28 FB          C      	JR	Z,M0010
  CE14    3D             C      	DEC	A
  CE15    20 F8          C      	JR	NZ,M0010
  CE17    18 CF          C      	JR	M000D
                         C      
                         C      ;OPERANDEN ERMITTELN, L-TEILE D.BEHANDLUNGSROUTINEN
                         C      
  CE19    28             C      TAB2:	DB	LOW(M0011)	;Z68
  CE1A    9D             C      	DB	LOW(BE)		;Z69
  CE1B    A2             C      	DB	LOW(BD)		;Z6A
  CE1C    AD             C      	DB	LOW(B8)		;Z6B
  CE1D    4A             C      	DB	LOW(B1)		;Z6C
  CE1E    5B             C      	DB	LOW(B3)		;Z6D
  CE1F    5D             C      	DB	LOW(B4)		;Z6E
  CE20    53             C      	DB	LOW(B2)		;Z6F
  CE21    66             C      	DB	LOW(B5)		;Z70
  CE22    75             C      	DB	LOW(B6)		;Z71
  CE23    31             C      	DB	LOW(B7)		;Z72
  CE24    40             C      	DB	LOW(M0013)	;Z73
  CE25    C7             C      	DB	LOW(BA)		;Z74
  CE26    A9             C      	DB	LOW(B9)		;Z75
  CE27    C2             C      	DB	LOW(BB)		;Z76
                         C      
  CE28    CD CC72        C      M0011:	CALL	M000A
  CE2B    C5             C      	PUSH	BC
  CE2C    CD C8A1        C      	CALL	CONV
  CE2F    18 63          C      	JR	RELO
  CE31    CB 7B          C      B7:	BIT	7,E
  CE33    28 06          C      	JR	Z,M0012
  CE35    DD 7E FE       C      	LD	A,(IX-2)
  CE38    CD CE4D        C      	CALL	M0019
  CE3B    6A             C      M0012:	LD	L,D
  CE3C    26 ED          C      	LD	H,0EDH
  CE3E    18 4C          C      	JR	M0018
  CE40    C3 C320        C      M0013:	jp	CRLF
  CE43    18 4D          C      M0014:	JR	M001B		;AUSGABE AKKU
  CE45    21 CF3F        C      M0015:	LD	HL,M0027-1	;TEXTTAB-ANF.
  CE48    18 C4          C      M0016:	JR	M000F
  CE4A    7A             C      B1:	LD	A,D		;DOPPELREG.ERM.
  CE4B    E6 38          C      	AND	38H
  CE4D    C5             C      M0019:	PUSH	BC
  CE4E    CD C8C1        C      	CALL	LBYTE
  CE51    C1             C      	POP	BC
  CE52    C9             C      	RET
  CE53    DD 23          C      B2:	INC	IX
  CE55    DD 7E 00       C      	LD	A,(IX)
  CE58    C3 CE4D        C      	JP	M0019
  CE5B    AF             C      B3:	XOR	A
  CE5C    08             C      	EX	AF,AF'
  CE5D    79             C      B4:	LD	A,C
  CE5E    CB 7B          C      	bit	7,e
  CE60    28 68          C      	JR	z,M001F
  CE62    DD 2B          C      	dec	ix
  CE64    18 64          C      	jr	m001f
	MACRO-80 V3.50	25-Oct-85	Page	1-44
'REASSEMBLER'

  CE66    DD 23          C      B5:	INC	IX
  CE68    DD 23          C      	INC	IX
  CE6A    CD CE99        C      	CALL	MOUT
  CE6D    DD 66 00       C      	LD	H,(IX)
  CE70    DD 6E FF       C      	LD	L,(IX-1)
  CE73    18 17          C      	JR	M0018		;AUSGABE SPEICHER,GEDREHT 2BYTE
  CE75    DD 23          C      B6:	INC	IX
  CE77    D9             C      	EXX
  CE78    D5             C      	PUSH	DE
  CE79    D9             C      	EXX
  CE7A    E1             C      	POP	HL
  CE7B    DD E5          C      	PUSH	IX
  CE7D    C1             C      	POP	BC
  CE7E    09             C      	ADD	HL,BC
  CE7F    23             C      	INC	HL
  CE80    CD CE99        C      	CALL	MOUT
  CE83    0A             C      	LD	A,(BC)
  CE84    4F             C      	LD	C,A
  CE85    17             C      	RLA
  CE86    06 00          C      	LD	B,00H
  CE88    30 01          C      	JR	NC,M0017
  CE8A    05             C      	DEC	B
  CE8B    09             C      M0017:	ADD	HL,BC
  CE8C    C5             C      M0018:	PUSH	BC
  CE8D    CD C8BC        C      	CALL	LADR
  CE90    C1             C      	POP	BC
  CE91    C9             C      	RET
  CE92    C5             C      M001B:	PUSH	BC		;AUSGABE AKKU
  CE93    4F             C      	LD	C,A
  CE94    CD C0E6        C      RELO:	CALL	mcO
  CE97    C1             C      	POP	BC
  CE98    C9             C      	RET
  CE99    3E 4D          C      MOUT:	LD	A,'M'
  CE9B    18 F5          C      MOUT1:	JR	M001B
  CE9D    21 CF6F        C      BE:	LD	HL,T3
  CEA0    18 03          C      	JR	M001C
  CEA2    21 CF7D        C      BD:	LD	HL,T4
  CEA5    7A             C      M001C:	LD	A,D
  CEA6    A1             C      	AND	C
  CEA7    18 9F          C      M16:	JR	M0016
  CEA9    3E 02          C      B9:	LD	A,02H
  CEAB    18 04          C      	JR	M001D
  CEAD    CD CC72        C      B8:	CALL	M000A
  CEB0    1F             C      	RRA
  CEB1    21 CF6B        C      M001D:	LD	HL,T5
  CEB4    FE 02          C      	CP	02H
  CEB6    20 90          C      	JR	NZ,M0016
  CEB8    CB 7B          C      	BIT	7,E
  CEBA    28 EB          C      	JR	Z,M16
  CEBC    C6 02          C      	ADD	A,02H
  CEBE    CB 73          C      	BIT	6,E
  CEC0    28 E5          C      	JR	Z,M16
  CEC2    CD CC72        C      BB:	CALL	M000A
  CEC5    18 01          C      	JR	M001E
  CEC7    7A             C      BA:	LD	A,D
  CEC8    3C             C      M001E:	INC	A
  CEC9    A1             C      	AND	C
  CECA    CB 7B          C      M001F:	BIT	7,E
  CECC    28 27          C      	JR	Z,M0022
  CECE    CB 43          C      	BIT	0,E
  CED0    20 4F          C      	JR	NZ,M0026
  CED2    FE 05          C      	CP	05H
  CED4    38 1F          C      	JR	C,M0022
  CED6    47             C      	LD	B,A
  CED7    7A             C      	LD	A,D
	MACRO-80 V3.50	25-Oct-85	Page	1-45
'REASSEMBLER'

  CED8    EE 70          C      	XOR	70H
  CEDA    E6 78          C      	AND	78H
  CEDC    28 3D          C      	JR	Z,M0025
  CEDE    7A             C      	LD	A,D
  CEDF    EE 46          C      	XOR	46H
  CEE1    E6 C7          C      	AND	0C7H
  CEE3    28 36          C      	JR	Z,M0025
  CEE5    78             C      	LD	A,B
  CEE6    B9             C      	CP	C
  CEE7    20 04          C      	JR	NZ,M0021
  CEE9    CB CB          C      M0020:	SET	1,E
  CEEB    DD 23          C      	INC	IX
  CEED    C6 03          C      M0021:	ADD	A,03H
  CEEF    CB 73          C      	BIT	6,E
  CEF1    28 02          C      	JR	Z,M0022
  CEF3    C6 03          C      	ADD	A,03H
  CEF5    21 CFE5        C      M0022:	LD	HL,T6		;REGISTER-TEST
  CEF8    CD CE0E        C      	CALL	M000F
  CEFB    CB 4B          C      	BIT	1,E
  CEFD    C8             C      	RET	Z
  CEFE    CB 8B          C      	RES	1,E
  CF00    08             C      	EX	AF,AF'
  CF01    B7             C      	OR	A
  CF02    28 13          C      	JR	Z,M0024
  CF04    47             C      	LD	B,A
  CF05    3E 2B          C      	LD	A,'+'		;PLUS
  CF07    F2 CF10        C      	JP	P,M0023
  CF0A    78             C      	LD	A,B
  CF0B    ED 44          C      	NEG
  CF0D    47             C      	LD	B,A
  CF0E    3E 2D          C      	LD	A,'-'		;MINUS
  CF10    CD CE92        C      M0023:	CALL	M001B
  CF13    78             C      	LD	A,B
  CF14    CD CE4D        C      	CALL	M0019
  CF17    3E 29          C      M0024:	LD	A,')'		;KLAMMER ZU
  CF19    18 80          C      	JR	MOUT1
  CF1B    78             C      M0025:	LD	A,B
  CF1C    B9             C      	CP	C
  CF1D    28 CA          C      	JR	Z,M0020
  CF1F    18 D4          C      	JR	M0022
  CF21    F5             C      M0026:	PUSH	AF
  CF22    79             C      	LD	A,C
  CF23    CD CEE9        C      	CALL	M0020
  CF26    F1             C      	POP	AF
  CF27    B9             C      	CP	C
  CF28    C8             C      	RET	Z
  CF29    47             C      	LD	B,A
  CF2A    7A             C      	LD	A,D
  CF2B    EE 40          C      	XOR	40H
  CF2D    E6 40          C      	AND	40H
  CF2F    C8             C      	RET	Z
  CF30    AF             C      	XOR	A
  CF31    CD CE45        C      	CALL	M0015
  CF34    78             C      	LD	A,B
  CF35    18 BE          C      	JR	M0022
  CF37    97             C      T2:	DB	LOW(Z77-1)
  CF38    D9             C      	DB	LOW(Z78-1)
  CF39    C9             C      	DB	LOW(Z79-1)
  CF3A    A8             C      	DB	LOW(Z7A-1)
  CF3B    A0             C      	DB	LOW(Z7B-1)
  CF3C    9C             C      	DB	LOW(Z7C-1)	;RLC
  CF3D    B9             C      	DB	LOW(Z7D-1)
  CF3E    B3             C      	DB	LOW(Z7E-1)
  CF3F    86             C      	DB	LOW(Z7F-1)
  CF40                   C      M0027	EQU	$		;TEXTTABELLE ZEICHEN <20H
	MACRO-80 V3.50	25-Oct-85	Page	1-46
'REASSEMBLER'

                         C      ;TEXT V.OPERANDEN, LETZTES ZEICHEN BIT 7 GESETZT
                         C      ;AUCH TEILE DER MNEMONIK KOENNEN ZEICHEN SEIN, Z.B. IN V.INC
  CF40    26             C      TXTAB:	DB	'&'
  CF41    81             C      	DB	81H
  CF42    18             C      	DB	18H
  CF43    83             C      	DB	83H
  CF44    20             C      	DB	20H
  CF45    A0             C      	DB	0A0H
  CF46    02             C      	DB	2
  CF47    A0             C      	DB	0A0H
  CF48    41             C      	DB	'A'
  CF49    C6             C      	DB	0C6H
  CF4A    50 55 53 48    C      	DB	'PUSH'
  CF4E    A0             C      	DB	0A0H
  CF4F    50 4F 50       C      	DB	'POP'
  CF52    82             C      	DB	82H
  CF53    43 41 4C 4C    C      	DB	'CALL'
  CF57    A0             C      	DB	0A0H
  CF58    52 45          C      	DB	'RE'
  CF5A    D4             C      	DB	0D4H		;T
  CF5B    45 58          C      	DB	'EX'
  CF5D    83             C      	DB	83H
  CF5E    2C             C      	DB	','
  CF5F    A8             C      	DB	0A8H		;(
  CF60    29             C      	DB	')'
  CF61    AC             C      	DB	0ACH		;,
  CF62    4A 50          C      	DB	'JP'
  CF64    83             C      	DB	83H
  CF65    49 4D          C      	DB	'IM'
  CF67    83             C      	DB	83H
  CF68    52             C      	DB	'R'
  CF69    CC             C      	DB	0CCH		;L
  CF6A    52             C      	DB	'R'
  CF6B    D2             C      T5:	DB	0D2H		;R
  CF6C    42             C      	DB	'B'
  CF6D    C3             C      	DB	0C3H		;C
  CF6E    44             C      	DB	'D'
  CF6F    C5             C      T3:	DB	0C5H		;E
  CF70    48             C      	DB	'H'
  CF71    CC             C      	DB	0CCH		;L
  CF72    53             C      	DB	'S'
  CF73    D0             C      	DB	0D0H		;P
  CF74    49             C      	DB	'I'
  CF75    D8             C      	DB	0D8H		;X
  CF76    49             C      	DB	'I'
  CF77    D9             C      	DB	0D9H		;Y
  CF78    1A             C      	DB	1AH		;INC
  CF79    43             C      	DB	'C'
  CF7A    82             C      	DB	82H
  CF7B    11             C      	DB	11H		;DEC
  CF7C    43             C      	DB	'C'
  CF7D    82             C      T4:	DB	82H
  CF7E    4C             C      	DB	'L'
  CF7F    C4             C      	DB	0C4H		;D
  CF80    43             C      	DB	'C'
  CF81    D0             C      	DB	0D0H		;P
  CF82    49             C      	DB	'I'
  CF83    CE             C      	DB	0CEH		;N
  CF84    4F 55          C      	DB	'OU'
  CF86    D4             C      	DB	0D4H		;T
  CF87    41 44          C      Z7F:	DB	'AD'
  CF89    C4             C      	DB	0C4H		;D
  CF8A    41 44          C      	DB	'AD'
  CF8C    C3             C      	DB	0C3H		;C
  CF8D    53 55          C      	DB	'SU'
	MACRO-80 V3.50	25-Oct-85	Page	1-47
'REASSEMBLER'

  CF8F    C2             C      	DB	0C2H		;B
  CF90    53             C      	DB	'S'		;SBC
  CF91    90             C      	DB	90H
  CF92    41 4E          C      	DB	'AN'
  CF94    C4             C      	DB	0C4H		;D
  CF95    58 4F          C      	DB	'XO'
  CF97    D2             C      	DB	0D2H		;R
  CF98    4F 52          C      Z77:	DB	'OR'
  CF9A    A0             C      	DB	0A0H
  CF9B    19             C      	DB	19H
  CF9C    A0             C      	DB	0A0H
  CF9D    FB             C      Z7C:	DB	0FBH		;RLC
  CF9E    FB             C      	DB	0FBH		;RRET	C
  CF9F    8E             C      	DB	8EH		;RL
  CFA0    8F             C      	DB	8FH		;RR
  CFA1    0E             C      Z7B:	DB	0EH		;RLC
  CFA2    C3             C      	DB	0C3H
  CFA3    0F             C      	DB	0FH		;RRET	C
  CFA4    C3             C      	DB	0C3H
  CFA5    0E             C      	DB	0EH		;RL
  CFA6    A0             C      	DB	0A0H
  CFA7    0F             C      	DB	0FH		;RR
  CFA8    A0             C      	DB	0A0H
  CFA9    53 4C          C      Z7A:	DB	'SL'
  CFAB    C1             C      	DB	0C1H		;A
  CFAC    53 52          C      	DB	'SR'
  CFAE    C1             C      	DB	0C1H		;A
  CFAF    53 4C          C      	DB	'SL'
  CFB1    D3             C      	DB	0D3H		;S
  CFB2    53             C      	DB	'S'
  CFB3    8E             C      	DB	8EH
  CFB4    C9             C      Z7E:	DB	0C9H		;I
  CFB5    C4             C      	DB	0C4H		;D
  CFB6    49             C      	DB	'I'
  CFB7    D2             C      	DB	0D2H		;R   F.LDIR U.S.W.
  CFB8    44             C      	DB	'D'
  CFB9    D2             C      	DB	0D2H		;R
  CFBA    4E             C      Z7D:	DB	'N'
  CFBB    DA             C      	DB	0DAH		;Z
  CFBC    5A             C      	DB	'Z'
  CFBD    A0             C      	DB	0A0H
  CFBE    4E             C      	DB	'N'
  CFBF    C3             C      	DB	0C3H		;C
  CFC0    43             C      	DB	'C'
  CFC1    A0             C      	DB	0A0H
  CFC2    50             C      	DB	'P'
  CFC3    CF             C      	DB	0CFH		;O
  CFC4    50             C      	DB	'P'
  CFC5    C5             C      	DB	0C5H		;E
  CFC6    50             C      	DB	'P'
  CFC7    A0             C      	DB	0A0H
  CFC8    4D             C      	DB	'M'
  CFC9    A0             C      	DB	0A0H
  CFCA    28             C      Z79:	DB	'('		;(BC),A
  CFCB    10             C      	DB	10H
  CFCC    0B             C      	DB	0BH
  CFCD    C1             C      	DB	0C1H
  CFCE    41             C      	DB	'A'		;A,(BC)
  CFCF    0A             C      	DB	0AH
  CFD0    10             C      	DB	10H
  CFD1    A9             C      	DB	0A9H
  CFD2    28             C      	DB	'('		;(DE),A
  CFD3    11             C      	DB	11H
  CFD4    0B             C      	DB	0BH
  CFD5    C1             C      	DB	0C1H
	MACRO-80 V3.50	25-Oct-85	Page	1-48
'REASSEMBLER'

  CFD6    41             C      	DB	'A'		;A,(DE)
  CFD7    0A             C      	DB	0AH
  CFD8    11             C      	DB	11H
  CFD9    A9             C      	DB	0A9H
  CFDA    49 2C          C      Z78:	DB	'I,'
  CFDC    C1             C      	DB	0C1H		;A
  CFDD    52 2C          C      	DB	'R,'
  CFDF    C1             C      	DB	0C1H		;A
  CFE0    41 2C          C      	DB	'A,'
  CFE2    C9             C      	DB	0C9H		;I
  CFE3    41 2C          C      	DB	'A,'
  CFE5    D2             C      T6:	DB	0D2H		;R
  CFE6    C1             C      	DB	0C1H		;A-L
  CFE7    C2             C      	DB	0C2H
  CFE8    C3             C      	DB	0C3H
  CFE9    C4             C      	DB	0C4H
  CFEA    C5             C      	DB	0C5H
  CFEB    C8             C      	DB	0C8H
  CFEC    CC             C      	DB	0CCH
  CFED    28             C      	DB	'('		;(HL)
  CFEE    12             C      	DB	12H
  CFEF    A9             C      	DB	0A9H
  CFF0    48             C      	DB	'H'
  CFF1    D8             C      	DB	0D8H		;X
  CFF2    4C             C      	DB	'L'
  CFF3    D8             C      	DB	0D8H		;X
  CFF4    28             C      	DB	'('
  CFF5    94             C      	DB	94H		;IX
  CFF6    48             C      	DB	'H'
  CFF7    D9             C      	DB	0D9H		;Y
  CFF8    4C             C      	DB	'L'
  CFF9    D9             C      	DB	0D9H		;Y
  CFFA    28             C      	DB	'('
  CFFB    95             C      	DB	95H		;IY
                         C      
  CFFC                          ds 	monitor+1000h-$,0ffh
                                	SUBTTL	CBIOS
                                page
	MACRO-80 V3.50	25-Oct-85	Page	1-49
CBIOS

                                
                         C      include	URLADER.MAC
                         C      .z80
                         C      
                         C      	SUBTTL	'Urlader'
                         C      
                         C      
                         C      
                         C      ;Lader fuer erste 5 Sektoren und Sprung dorthin
                         C      ;(c) Y23VO 1989
                         C      ;public domain
                         C      
  8100                   C      lram	equ	8100h	;Arbeitsbereich Ladeprogramm
  80E0                   C      lstack	equ	lram-20h
  80F0                   C      dskbuf	equ	lram-10h	;Speicherplatz Ladeadresse
  0400                   C      hstsiz	equ	400h	;Sektorgroesse
  C0E0                   C      cci	equ	mci
                         C      
                         C      ;System: Bios ab Spur 0, Sektor 1
                         C      ;	 Intellader,CCP und BDOS ab Spur 2, Sektor 1
                         C      
                         C      
  D000    31 80E0        C      bium:	ld	sp,lstack
  D003    CD D048        C      	call	inifd
  D006    06 05          C      	ld	b,5		;Anzahl Sektoren
  D008    11 0400        C      	ld	de,hstsiz	;Sektorlaenge
  D00B    21 8500        C      	ld	hl,lram+hstsiz	;Zieladresse
  D00E    22 80F0        C      	ld	(dskbuf),hl
  D011    C5             C      lader:	push	bc
  D012    D5             C      	push	de
  D013    E5             C      	push	hl
  D014    CD D094        C      	call	reahst		;sektorlesen
  D017    B7             C      	or	a
  D018    C2 C050        C      	jp	nz,error	
  D01B    21 D02F        C      	ld	hl,hstsec	;naechster
  D01E    34             C      	inc	(hl)
  D01F    E1             C      	pop	hl
  D020    D1             C      	pop	de
  D021    C1             C      	pop	bc
  D022    19             C      	add	hl,de		;naechste Ladeadresse
  D023    22 80F0        C      	ld	(dskbuf),hl
  D026    10 E9          C      	djnz	lader
  D028    C3 8500        C      	jp	lram+hstsiz
                         C      
                         C      ;Steuertabelle fuer Floppycontroller
  D02B    C6             C      CTAB:	DB	0c6H		;MFM LESEN
  D02C    00             C      UNIT:	DB	0		;LAUFWERK A VOREINGESTELLT
  D02D    00             C      TRCK:	DB	0		;SPUR
  D02E    00             C      HED:	DB	0		;DISK-SEITE
  D02F    01             C      HSTSEC:	DB	1		;SECTOR
  D030    03             C      N:	DB	3		;N=3=1024 BYTES
  D031    05             C      EOT:	DB	5		;5 SECTOREN JE SPUR
  D032    1B             C      GPL:	DB	1BH		;LUECKE
  D033    FF             C      DTL:	DB	0FFH
  D034    00             C      RESLT:	DB	0		;ST0, RESULT TAB F.FDC
  D035    00             C      	DB	0		;ST1
  D036    00             C      	DB	0		;ST2
  D037    00             C      	DB	0		;CYLINDER
  D038    00             C      	DB	0		;HEAD
  D039    00             C      	DB	0		;RECORD
  D03A    00             C      	DB	0		;N
  D03B    00             C      RWCDE:	DB	0
  D03C    00             C      SEKDSK:	DB	0
  D03D    00             C      SEKTRK:	DB	0
	MACRO-80 V3.50	25-Oct-85	Page	1-50
'Urlader'

  D03E    00             C      HEAD:	DB	0
  D03F    00             C      SEKHST:	DB	0	
  D040    00             C      HSTDSK:	DB	0
  D041    00             C      HSTTRK:	DB	0
  D042    02             C      WRTYPE:	DB	2		
  D043    00             C      WRFLG:	DB	0
  D044    00             C      inibit:	db	0
  D045    01             C      SEKSEC:	DB	1		;BDOS-SEKTOR
  D046    0080           C      DMAADR:	DEFW	80H		;BDOS-DMA
  D048                   C      erflag	equ	$		;nicht benutzt
  D048                   C      msg2	equ	$		;nicht benutzt
                         C      
                         C      include	FDC780.MAC
                         C      ;====================================================================
                         C      ;TREIBER MIT U8272
                         C      ;-----------------------------------------------------------
                         C      ;(c) Y23VO 1989
                         C      ;public domain
                         C      ;-----------------------------------------------------------
  D048    CD D07E        C      INIFD:	CALL	TCPLS
  D04B    06 00          C      INI1:	LD	B,0		;INITIALISIERUNG P8272
  D04D    10 FE          C      	DJNZ	INI1+2
  D04F    DB 40          C      	IN	A,(CFDC)
  D051    FE 80          C      	CP	80H
  D053    28 04          C      	JR	Z,SPEZI
  D055    DB 41          C      	IN	A,(DFDC)
  D057    18 F2          C      	JR	INI1
  D059    21 D07B        C      SPEZI:	LD	HL,STAB-1	;PARAMETER LADEN
  D05C    01 0303        C      	LD	BC,0303H	;SPECIFY-COMM 3BYTES
  D05F    CD D124        C      	CALL	WCOM1		;SCHREIBEN COMM
  D062    01 0207        C      RECAL:	LD	BC,0207H	;SPUR 0 EINSTELLEN
  D065    CD D0FB        C      	CALL	RDY		;DRIVE READY?
                         C      ;-----------------------------------------------------------
  D068    01 0108        C      SENSE:	LD	BC,0108H	;PRUEFE INTERRUPT STATUS
  D06B    CD D121        C      	CALL	WCOM
  D06E    CD D140        C      	CALL	RBYTE		;RESULT REG 0:IC1,IC2,SE,EC,NR,HD,US1,US2
  D071    47             C      	LD	B,A
  D072    FE 80          C      	CP	80H
  D074    C4 D140        C      	CALL	NZ,RBYTE	;PCN HOLEN
  D077    CB 68          C      	BIT	5,B		;SEEK ENDE?
  D079    28 ED          C      	JR	Z,SENSE
  D07B    C9             C      	RET
  D07C    E1             C      STAB:	DB	0e1H		;XXXX=SRT,XXXX=HUT
  D07D    03             C      	DB	3H		;XXXXXXX=HLT,X=ND
                         C      ;df,3 mit kopfladen,e1,3 ohne 
                         C      ;-----------------------------------------------------------
  D07E    D3 50          C      TCPLS:	OUT	(TC),A		;ENDEIMPULS EIN
  D080    CD D139        C      	CALL	DELAY
  D083    DB 50          C      	IN	A,(TC)
  D085    C9             C      	RET
                         C      ;-----------------------------------------------------------
                         C      ;SEKTOR SCHREIBEN/LESEN IN BETRIEBSART OHNE DMA-SCHALTKREIS
                         C      ;SECTOR IN (HSTSEC)
                         C      ;SPUR  IN (HSTTRK)
                         C      ;AKT.LAUFWERK IN (HSTDSK)
                         C      ;ZIEL-/QUELLADRESSE = HSTBUF
                         C      ;KILL: A B DE HL
  D086    CD D0E1        C      WRIHST:	call	sds
  D089    CB 77          C      	bit	6,a		;Schreibschutz ?
  D08B    20 39          C      	jr	nz,rwerr
  D08D    11             C      wrhst1:	DB	11H		;CODE LD DE,...
  D08E    ED A3          C      	OUTI			;WRITE DATA
  D090    3E C5          C      	LD	A,0c5H		;SCHREIBKOMMANDO
  D092    18 05          C      	JR	RWIT
                         C      ;-----------------------------------------------------------
	MACRO-80 V3.50	25-Oct-85	Page	1-51
'Urlader'

  D094    11             C      REAHST:	DB	11H		;CODE LD DE,...
  D095    ED A2          C      	INI
  D097    3E C6          C      	LD	A,0c6H		;LESEKOMMANDO
  D099    32 D02B        C      RWIT:	LD	(CTAB),A
  D09C    ED 53 D0D9     C      	LD	(MODE),DE	;EINTRAGEN INI/OUTI-OP-CODE
  D0A0    CD D175        C      	call	heads
  D0A3    CD D0EB        C      	CALL	SEEK
  D0A6    06 0A          C      	ld	b,10
  D0A8    C5             C      RWOP:	PUSH	BC
  D0A9    F3             C      	DI
  D0AA    06 09          C      	LD	B,9		;9COMMANDOBYTES
  D0AC    3A D02B        C      	LD	A,(CTAB)
  D0AF    4F             C      	LD	C,A
  D0B0    CD D0FB        C      	CALL	RDY		;AUSGABE KOMMANDO
  D0B3    2A 80F0        C      	LD	HL,(DSKBUF)	;Ladeadresse
  D0B6    0E 41          C      	LD	C,DFDC
  D0B8    CD D0CC        C      	CALL	RW
  D0BB    CD D07E        C      	CALL	TCPLS		;ENDE-IMPULS
  D0BE    CD D149        C      	CALL	RRSLT
  D0C1    FB             C      	EI
  D0C2    C1             C      	POP	BC
  D0C3    C8             C      	RET	Z		;ST0=0=KEINE FEHLER
  D0C4    10 E2          C      	DJNZ	RWOP
  D0C6    3E 01          C      rwerr:	LD	A,1
  D0C8    32 D048        C      	ld	(erflag),a
  D0CB    C9             C      	RET			;ERROR
                         C      ;-----------------------------------------------------------
                         C      ;SCHREIBEN ODER LESEN 1024 BYTES
                         C      ;IN: HL QUELLE ODER ZIEL
                         C      ; C: DATENPORT
  D0CC    06 04          C      RW:	LD	B,4
  D0CE    C5             C      RW2:	PUSH	BC
  D0CF    06 00          C      	LD	B,0		;256 BYTES
  D0D1    DB 40          C      RW1:	IN	A,(CFDC)
  D0D3    07             C      	RLCA			;RQM-TEST
  D0D4    30 FB          C      	JR	NC,RW1
  D0D6    07             C      	RLCA			;DIO
  D0D7    07             C      	RLCA			;NON-DMA
  D0D8    D0             C      	RET	NC		;FERTIG?
  D0D9    ED A2          C      MODE:	INI			;INI BEI READ DATA SONST OUTI
  D0DB    20 F4          C      	JR	NZ,RW1
  D0DD    C1             C      	POP	BC
  D0DE    10 EE          C      	DJNZ	RW2
  D0E0    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D0E1    01 0204        C      SDS:	LD	BC,0204H	;PRUEFE LAUFWERK STATUS
  D0E4    CD D121        C      	CALL	WCOM
  D0E7    CD D140        C      	CALL	RBYTE		;STATUS REG 3:FAULT,WP,RDY,T0,TS,HD,US1,U
  D0EA    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D0EB    01 030F        C      SEEK:	LD	BC,030FH	;COMM SPUR EINSTELLEN
  D0EE    CD D0FB        C      	CALL	RDY
  D0F1    CD D068        C      	CALL	SENSE
  D0F4    DB 40          C      SKBSY:	IN	A,(CFDC)
  D0F6    E6 0F          C      	AND	0FH
  D0F8    20 FA          C      	JR	NZ,SKBSY
  D0FA    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D0FB    C5             C      RDY:	PUSH	BC		;LAUFWERK BETRIEBSFAEHIG ?
  D0FC    21 7FFF        C      	ld	hl,7fffh	;Wartezeit auf Bereitschaft
  D0FF    E5             C      nrdy:	push	hl
  D100    CD D0E1        C      	CALL	SDS		;nicht 
  D103    E1             C      	pop	hl
  D104    CB 6F          C      	BIT	5,A		;READY-BIT IN STATUSREG.3
  D106    20 18          C      	JR	NZ,RDY1
	MACRO-80 V3.50	25-Oct-85	Page	1-52
'Urlader'

  D108    2B             C      	dec	hl
  D109    CD D139        C      	call	delay
  D10C    7D             C      	ld	a,l
  D10D    B4             C      	or	h
  D10E    20 EF          C      	jr	nz,nrdy
  D110    21 D048        C      	LD	HL,MSG2		;FEHLERMELDUNG
  D113    CD C0F8        C      	CALL	STR
  D116    CD C0E0        C      	CALL	CCI
  D119    FE 6A          C      	CP	'j'		
  D11B    20 E2          C      	JR	NZ,NRDY
  D11D    C3 C800        C      	jp	restr		;Abbruch
  D120    C1             C      RDY1:	POP	BC
                         C      ;-----------------------------------------------------------
  D121    21 D02B        C      WCOM:	LD	HL,CTAB		;COMM IN FDC SCHREIBEN
  D124    F3             C      WCOM1:	DI			;IN: B ANZAHL D. BYTES,C COMM
  D125    CD D139        C      	CALL	DELAY
  D128    DB 40          C      	IN	A,(CFDC)
  D12A    E6 C0          C      	AND	0C0H
  D12C    FE 80          C      	CP	80H		;RQM,DIO=OUT
  D12E    20 F4          C      	JR	NZ,WCOM1
  D130    79             C      	LD	A,C
  D131    D3 41          C      	OUT	(DFDC),A
  D133    23             C      	INC	HL
  D134    4E             C      	LD	C,M
  D135    10 ED          C      	DJNZ	WCOM1
  D137    FB             C      	EI
  D138    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D139    C5             C      DELAY:	PUSH	BC		;VERZOEGERUNG F.STATUSFLAG 8272
  D13A    06 0F          C      	LD	B,0FH
  D13C    10 FE          C      DEL1:	DJNZ	DEL1
  D13E    C1             C      	POP	BC
  D13F    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D140    CD D139        C      RBYTE:	CALL	DELAY		;1 BYTE LESEN
  D143    CD D15F        C      	CALL	IRDY
  D146    DB 41          C      	IN	A,(DFDC)
  D148    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D149    06 06          C      RRSLT:	LD	B,6		;LESE 7 RESULT BYTES
  D14B    CD D140        C      	CALL	RBYTE
  D14E    21 D034        C      	LD	HL,RESLT
  D151    77             C      	LD	M,A
  D152    E6 C0          C      	AND	0C0H		;ERROR?
  D154    4F             C      	LD	C,A
  D155    CD D140        C      RESL1:	CALL	RBYTE
  D158    23             C      	INC	HL
  D159    77             C      	LD	M,A
  D15A    10 F9          C      	DJNZ	RESL1
  D15C    79             C      	LD	A,C		;FEHLERMELDUNG STATUS REG 0
  D15D    B7             C      	OR	A
  D15E    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D15F    DB 40          C      IRDY:	IN	A,(CFDC)	;BEREIT F.DATENEINGABE ?
  D161    07             C      	RLCA
  D162    30 FB          C      	JR	NC,IRDY
  D164    E6 80          C      	AND	80H
  D166    07             C      	RLCA
  D167    D8             C      	RET	C
                         C      ;-----------------------------------------------------------
                         C      ;FEHLERBEHANDLUNG
  D168    C3 C800        C      ERM:	jp	restr		;SPRUNG IN MONITOR
                         C      ;-----------------------------------------------------------
                         C      ;KOMMANDO READ ID
  D16B    01 024A        C      RDID:	LD	BC,024AH
	MACRO-80 V3.50	25-Oct-85	Page	1-53
'Urlader'

  D16E    CD D0FB        C      	CALL	RDY
  D171    CD D149        C      	CALL	RRSLT
  D174    C9             C      	RET
                         C      ;-----------------------------------------------------------
  D175    B7             C      HEADS:	or	a		;Carry-Flag loeschen
  D176    3A D041        C      	LD	A,(HSTTRK)
  D179    4F             C      	LD	C,A
  D17A    3A D040        C      	LD	A,(HSTDSK)
  D17D    CB 19          C      	RR	C
  D17F    38 0E          C      	JR	C,UNTEN
  D181    E6 F3          C      	AND	0F3H
  D183    32 D02C        C      	LD	(UNIT),A
  D186    79             C      	LD	A,C
  D187    32 D02D        C      	LD	(TRCK),A
  D18A    AF             C      	XOR	A
  D18B    32 D02E        C      	LD	(HED),A
  D18E    C9             C      	RET
  D18F    F6 04          C      UNTEN:	OR	4
  D191    32 D02C        C      	LD	(UNIT),A
  D194    79             C      	LD	A,C
  D195    32 D02D        C      	LD	(TRCK),A
  D198    3E 01          C      	LD	A,1
  D19A    32 D02E        C      	LD	(HED),A
  D19D    C9             C      	ret
  D19E                          ds	monitor+1600h-$,0ffh
                                	SUBTTL	'GRAFIK'
                                page
	MACRO-80 V3.50	25-Oct-85	Page	1-54
'GRAFIK'

                                
                         C      include GDC.MAC
                         C      .z80
                         C      ;Programm fuer Grafik-Display-Controller U82720/pD7220
                         C      
                         C      ;erstellt 	17.9.87
                         C      ;aktualisiert 	9.1.88
                         C      
  0280                   C      xmax	equ	640	;Anzahl Punkte
  00C8                   C      ymax	equ	200
                         C      
                         C      ;Programm zur Initialisierung des GDC 
  D600    21 F5FF        C      inigdc:	ld	hl,iobyt	;auf gdc-Ausgabe umschalten
  D603    CB C6          C      	set	0,(hl)
  D605    21 DE05        C      	ld	hl,tabanf	;tabellenadresse im rom
  D608    11 F600        C      	ld	de,gdcram	;adresse ramtabellen gdc
  D60B    01 0093        C      	ld	bc,lgdcram
  D60E    ED B0          C      	ldir
  D610    21 DAC0        C      	ld	hl,inid
  D613    CD D8A5        C      	call	ioup
  D616    C9             C      	ret
                         C      ;Hauptprogramm Zeichen wird in C uebergeben
  D617    F5             C      hp:	push	af
  D618    E5             C      	push	hl
  D619    C5             C      	push	bc
  D61A    D5             C      	push	de
  D61B    DD E5          C      	push	ix
  D61D    79             C      	ld	a,c
  D61E    D6 20          C      	sub	020h
  D620    DA D6EF        C      	jp	c,stup		;wenn Steuerzeichen Sprung
  D623    FE 5F          C      	cp	5fh
  D625    D2 D6EF        C      	jp	nc,stup		;Steuerzeichen
  D628    CD D638        C      	call	hp1		;Zeichen ausgeben Cursor ueberschr.
  D62B    CD D692        C      	call	test		;Test ob eine Pos. weiter moeglich
  D62E    CD D652        C      	call	cursb0		;Cursor setzen 
  D631    DD E1          C      ende:	pop	ix
  D633    D1             C      	pop	de
  D634    C1             C      	pop	bc
  D635    E1             C      	pop	hl
  D636    F1             C      	pop	af
  D637    C9             C      	ret
                         C      ;Prg.zur Zeichenausgabe (A)=ASCII - Zeichen-20h 
  D638    26 00          C      hp1:	ld	h,0
  D63A    6F             C      	ld	l,a
  D63B    ED 5B F61E     C      	ld	de,(zgadr)
  D63F    29             C      	add	hl,hl		;"Zeichen"*8 
  D640    29             C      	add	hl,hl
  D641    29             C      	add	hl,hl
  D642    19             C      	add	hl,de		;+ Zg.Anfangsadr.=Zeichenadr.
  D643    11 F643        C      	ld	de,pramp	;in Datenbereich zur Ausgabe 
  D646    01 0008        C      	ld	bc,0008		;kopieren
  D649    ED B0          C      	ldir
  D64B    21 F641        C      	ld	hl,type		;als Muster (pattern) ausgeben
  D64E    CD D8A5        C      	call	ioup
  D651    C9             C      	ret	
                         C      ;Cursor auf aktueller Position invertieren
  D652    3A F68C        C      cursb0:	ld	a,(flag)
  D655    E6 01          C      	and	1
  D657    C8             C      	ret	z
  D658    FD E5          C      	push	iy
  D65A    FD 21 F66C     C      	ld	iy,smod	
  D65E    FD 36 00 21    C      	ld	(iy),21h	;in Komplm.-Modus setzen
  D662    CD D674        C      	call	cursc0		;Curs.adr. und
  D665    3E 5F          C      	ld	a,5fh		;ASCII fuer Curs.  ausgeben	
	MACRO-80 V3.50	25-Oct-85	Page	1-55
'GRAFIK'

  D667    CD D638        C      	call	hp1
  D66A    FD 36 00 20    C      	ld	(iy),20h	;vom Komplm.-Zeichenmodus
  D66E    CD D674        C      	call	cursc0		;in PATTERN-Modus
  D671    FD E1          C      	pop	iy
  D673    C9             C      	ret
                         C      ;Prg.zur Ausgabe der Cursoradr. fuer den GDC
  D674    ED 5B F691     C      cursc0:	ld	de,(cursa)	;aus Zeilenadr. und x Koord Curs.Adr.er-
  D678    3A F68D        C      	ld	a,(xk)		;rechnen und ausgeben
  D67B    21 F671        C      	ld	hl,pix
  D67E    36 00          C      	ld	(hl),0h
  D680    A7             C      	and	a		;Carry = 0
  D681    1F             C      	rra			;x Koord. durch 2 dividieren
  D682    CB 1E          C      	rr	(hl)		;=>Wortadr.und Punktadr.
  D684    6F             C      	ld	l,a
  D685    26 00          C      	ld	h,0
  D687    19             C      	add	hl,de		;errechnen
  D688    22 F66F        C      	ld	(pos),hl	;und ausgeben
  D68B    21 F66B        C      	ld	hl,zcls1
  D68E    CD D8A5        C      	call	ioup
  D691    C9             C      	ret
                         C      ;Prg. zum Test ob neue Position ,auf die der GDC-Curs nach 
                         C      ;letzter Ausgabeoperation steht,moeglich ist ,sonst neue Zeilenadr.
                         C      ;bestimmen und Bildschirmrollen wenn noetig
  D692    2A F68D        C      test:	ld	hl,(xk)
  D695    2C             C      	inc	l		;eine Position weiter
  D696    22 F68D        C      	ld	(xk),hl
  D699    3E 50          C      	ld	a,xmax/8	;Spaltenzahl
  D69B    BD             C      	cp	l		;letzte Spalte?
  D69C    C0             C      	ret	nz		;nicht-Ruecksprung
  D69D    2E 00          C      	ld	l,0		;neue Zeile,Zeilenanfang
  D69F    24             C      	inc	h
  D6A0    22 F68D        C      	ld	(xk),hl
  D6A3    3E 19          C      	ld	a,ymax/8	;Zeilenzahl
  D6A5    BC             C      	cp	h		;letzte Zeile?
  D6A6    28 1A          C      	jr	z,scrl		;ja Bildschirm rollen
  D6A8    2A F691        C      m003:	ld	hl,(cursa)	;neue Adr.des Zeilenanfanges
  D6AB    D5             C      	push	de		;errechnen(alte+320 Worte)
  D6AC    11 0140        C      	ld	de,xmax/2	;(da obere Adr.bits nicht 
  D6AF    19             C      	add	hl,de		;ausgewertet werden auch
  D6B0    D1             C      	pop	de		;Adr.>8k Worte moeglich)
  D6B1    7C             C      	ld	a,h		;hier auf
  D6B2    E6 1F          C      	and	01fh		;8k Worte begrenzt
  D6B4    67             C      	ld	h,a
  D6B5    22 F691        C      	ld	(cursa),hl	;neue Cursor pos 
  D6B8    22 F66F        C      	ld	(pos),hl	;ausgeben
  D6BB    21 F66B        C      	ld	hl,zcls1
  D6BE    CD D8A5        C      	call	ioup
  D6C1    C9             C      	ret
  D6C2    25             C      scrl:	dec	h	
  D6C3    22 F68D        C      	ld	(xk),hl
  D6C6    2A F68F        C      	ld	hl,(curs0)	;Anfangsadr. fuer Bildschirm 
  D6C9    D5             C      	push	de		;bestimmen (alte +320)
  D6CA    11 0140        C      	ld	de,320
  D6CD    19             C      	add	hl,de
  D6CE    D1             C      	pop	de
  D6CF    7C             C      	ld	a,h		;hier Adr.
  D6D0    E6 1F          C      	and	1fh		;auf max.8k Worte begrenzt
  D6D2    67             C      	ld	h,a
  D6D3    22 F68F        C      	ld	(curs0),hl	;und ausgeben bzw zwischen-
  D6D6    22 F689        C      	ld	(pos0),hl	;speichern
  D6D9    21 F687        C      	ld	hl,scroll
  D6DC    CD D8A5        C      	call	ioup
  D6DF    CD D6A8        C      	call	m003		;Zeilenadr. bestimmen
  D6E2    21 F673        C      	ld	hl,zcls2	;Zeile loeschen
  D6E5    CD D8A5        C      	call	ioup
	MACRO-80 V3.50	25-Oct-85	Page	1-56
'GRAFIK'

  D6E8    21 F66B        C      	ld	hl,zcls1	;letzte Curs.pos neu einschr.
  D6EB    CD D8A5        C      	call	ioup
  D6EE    C9             C      	ret
                         C      ;=============================================================
                         C      ;Steuerzeichenauswertung
  D6EF    C5             C      stup:	push	bc
  D6F0    CD D652        C      	call	cursb0	        ;alten Cursor loeschen
  D6F3    C1             C      	pop	bc
  D6F4    79             C      	ld	a,c		;Steuerzeichen neu laden
  D6F5    F5             C      	push	af
  D6F6    ED 4B F68D     C      	ld	bc,(xk)		;Koordin.laden
  D6FA    17             C      	rla			;Zeichen groesser 80h?
  D6FB    30 3D          C      	jr	nc,m0288	;nein,Steuerz <20h u Sprung)
  D6FD    3A F68C        C      	ld	a,(flag)
  D700    F5             C      	push	af
  D701    17             C      	rla			;Teset ob x o.y Koordin.
  D702    30 35          C      	jr	nc,m0289	;erwartet werden (zuvor 1Bh)
  D704    17             C      	rla			;Verzweigung y o. y Koordin.
  D705    30 21          C      	jr	nc,m028a	;Sprung bei x Koordin
  D707    F1             C      	pop	af		
  D708    CB B7          C      	res	6,a		;speichern, dass x Koordin.
  D70A    32 F68C        C      	ld	(flag),a	;noch erwartet wird	
  D70D    F1             C      	pop	af
  D70E    E6 1F          C      	and	01fh		;
  D710    32 F68E        C      	ld	(yk),a
  D713    47             C      	ld	b,a
  D714    2A F68F        C      	ld	hl,(curs0)	;aktuelle Cursoradr.
  D717    11 0140        C      	ld	de,320		;errechnen und ausgeben 
  D71A    A7             C      	and	a
  D71B    28 03          C      	jr	z,m0300
  D71D    19             C      m0301:	add	hl,de
  D71E    10 FD          C      	djnz	m0301
  D720    22 F691        C      m0300:	ld	(cursa),hl
  D723    CD D674        C      	call	cursc0	
  D726    18 20          C      	jr	m0280
                         C      	
  D728    F1             C      m028a:	pop	af	
  D729    CB BF          C      	res	7,a		;Steuerzeichenfolge (1Bh)
  D72B    32 F68C        C      	ld	(flag),a	;beenden	
  D72E    F1             C      	pop	af
  D72F    E6 7F          C      	and	07fh
  D731    32 F68D        C      	ld	(xk),a		;aktuelle Adr. ausgeben
  D734    CD D674        C      	call	cursc0
  D737    18 0F          C      	jr	m0280
                         C      
  D739    F1             C      m0289:	pop	af
  D73A    F1             C      m0288:	pop	af		;Steuerzeichen hohlen 
  D73B    21 D877        C      	ld	hl,jptab	;Tabellenanfang laden
  D73E    CD C073        C      	call	FCGA
  D741    38 05          C      	jr	c,m0280		;Sprung wenn Zeichen kein Steuerzei.
  D743    11 D748        C      	ld	de,m0280	;RET-Adr. fuer Unterprg. auf Stack
  D746    D5             C      	push	de		;schaffen
  D747    E9             C      	jp	(hl)
                         C      
  D748    CD D652        C      m0280:	call	cursb0
  D74B    C3 D631        C      	jp	ende
  D74E    01 0000        C      ghome:	ld	bc,0		;Zeile u Spalte 0 ausgeben
  D751    ED 43 F68D     C      	ld	(xk),bc
  D755    ED 4B F68F     C      	ld	bc,(curs0)
  D759    ED 43 F691     C      	ld	(cursa),bc
  D75D    CD D674        C      	call	cursc0
  D760    C9             C      	ret
  D761    CD D822        C      del:	call	cu1l	
  D764    AF             C      	xor	a
  D765    CD D638        C      	call	hp1		;Leerzeichen ausgeben 
	MACRO-80 V3.50	25-Oct-85	Page	1-57
'GRAFIK'

  D768    CD D674        C      	call	cursc0
  D76B    C9             C      	ret
  D76C    3E 4F          C      lf:	ld	a,79		;rechten Rand als x Koord.
  D76E    32 F68D        C      	ld	(xk),a
  D771    C5             C      	push	bc
  D772    CD D692        C      	call	test		;=>naechste Position
  D775    C1             C      	pop	bc
  D776    79             C      	ld	a,c
  D777    32 F68D        C      	ld	(xk),a		;alte x Position einsetzen
  D77A    CD D674        C      	call	cursc0
  D77D    C9             C      	ret
  D77E    21 1FFF        C      bloeh:	ld	hl,01fffh	;Byteanzahl der wdat-Funktion
  D781    22 F67E        C      	ld	(laeng),hl	;auf ges.Bilds.erhoehen 
  D784    21 F673        C      	ld	hl,zcls2
  D787    CD D8A5        C      	call	ioup
  D78A    21 0140        C      	ld	hl,320		;und auf Zeilenlaenge setzen
  D78D    22 F67E        C      	ld	(laeng),hl
  D790    01 0000        C      	ld	bc,0		;Adr. Bildanfang auf 00
  D793    ED 43 F689     C      	ld	(pos0),bc	;(z.B.def.Zustand fuer
  D797    ED 43 F68F     C      	ld	(curs0),bc	;Graphicarbeiten
  D79B    21 F687        C      	ld	hl,scroll
  D79E    CD D8A5        C      	call	ioup
  D7A1    18 AB          C      	jr	ghome
  D7A3    0E 00          C      cr:	ld	c,0h		;linken Rand eintragen
  D7A5    ED 43 F68D     C      	ld	(xk),bc		;
  D7A9    CD D674        C      	call	cursc0
  D7AC    C9             C      	ret
  D7AD    3E 4F          C      clszc:	ld	a,4fh		;Differenz zum rechten Rand
  D7AF    91             C      	sub	c
  D7B0    28 16          C      	jr	z,clszc3	;Cursor am rechten Rand
  D7B2    1F             C      	rra			;durch 2 div.
  D7B3    38 06          C      	jr	c,clszc2	;ungerade Diff.=>xKoord. war gerade
  D7B5    F5             C      	push	af
  D7B6    CD D7C8        C      	call	clszc3		;Leerzeichen ausgeben ,aktive Cursor-
  D7B9    F1             C      	pop	af		;Position gerade
  D7BA    3D             C      	dec	a
  D7BB    32 F661        C      clszc2:	ld	(clspos),a	;aktive Koord.ist gerade 
  D7BE    21 F652        C      	ld	hl,clszc0	;a*16 Bit werden in x Richt.
  D7C1    CD D8A5        C      	call	ioup		;geloeschet
  D7C4    CD D674        C      	call	cursc0
  D7C7    C9             C      	ret
  D7C8    F5             C      clszc3:	push	af
  D7C9    AF             C      	xor	a
  D7CA    CD D638        C      	call	hp1		;Leerzeichen ausgeben
  D7CD    F1             C      	pop	af
  D7CE    C0             C      	ret	nz
  D7CF    CD D674        C      	call	cursc0
  D7D2    C9             C      	ret
  D7D3    CD D692        C      cu1r:	call	test		;Cursor eine Position weiter
  D7D6    CD D674        C      	call	cursc0
  D7D9    C9             C      	ret
  D7DA    CD D7A3        C      clszi:	call	cr		;Cursor an Zeilenanfang
  D7DD    21 F673        C      	ld	hl,zcls2	;u Zeile loeschen
  D7E0    CD D8A5        C      	call	ioup
  D7E3    CD D674        C      	call	cursc0
  D7E6    C9             C      	ret
  D7E7    78             C      cu1h:	ld	a,b
  D7E8    D6 01          C      	sub	1		;Carry wird registriert 
  D7EA    47             C      	ld	b,a	
  D7EB    30 0A          C      	jr	nc,cu1h0	;Cursor nicht Oben,Sprung
  D7ED    06 00          C      	ld	b,0	
  D7EF    ED 43 F68D     C      cu1h1:	ld	(xk),bc
  D7F3    CD D674        C      	call	cursc0
  D7F6    C9             C      	ret	
  D7F7    2A F691        C      cu1h0:	ld	hl,(cursa)	;neue Zeilenadr. errechn. 
	MACRO-80 V3.50	25-Oct-85	Page	1-58
'GRAFIK'

  D7FA    11 0140        C      	ld	de,320
  D7FD    A7             C      	and	a		;Carry auf 0 setzen
  D7FE    ED 52          C      	sbc	hl,de
  D800    22 F691        C      	ld	(cursa),hl
  D803    18 EA          C      	jr	cu1h1
  D805    3A F68C        C      xyein:	ld	a,(flag)
  D808    CB F7          C      	set	6,a		;folgendes Zeichen or 80 =y Koordin.
  D80A    CB FF          C      	set	7,a
  D80C    32 F68C        C      	ld	(flag),a
  D80F    C9             C      	ret
  D810    3A F68C        C      cuein:	ld	a,(flag)	;Cursor ein(ca 3*langsamer
  D813    CB C7          C      	set	0,a		;als ohne Cursor)
  D815    32 F68C        C      	ld	(flag),a
  D818    C9             C      	ret
  D819    3A F68C        C      cuaus:	ld	a,(flag)	;Cursor aus
  D81C    CB 87          C      	res	0,a
  D81E    32 F68C        C      	ld	(flag),a
  D821    C9             C      	ret
  D822    79             C      cu1l:	ld	a,c
  D823    D6 01          C      	sub	1
  D825    4F             C      	ld	c,a
  D826    30 06          C      	jr	nc,cu1l0	;Sprung wenn Cu.nicht links 
  D828    0E 4F          C      	ld	c,4fh		;Cursor zum rechten Rand
  D82A    CD D7E7        C      	call	cu1h		;Cu.eine Zeile hoch
  D82D    C9             C      	ret
  D82E    ED 43 F68D     C      cu1l0:	ld	(xk),bc
  D832    CD D674        C      	call	cursc0
  D835    C9             C      	ret
  D836    2A F691        C      clsbs:	ld	hl,(cursa)	;ab Cursor bis Bildende
  D839    E5             C      	push	hl		;loeschen,
  D83A    CD D7AD        C      	call	clszc		;erst bis Zeilenende
  D83D    ED 4B F68D     C      	ld	bc,(xk)
  D841    C5             C      	push	bc
  D842    3E 18          C      	ld	a,24		
  D844    B8             C      	cp	b		;Sprung wenn
  D845    28 23          C      	jr	z,clsbs2	;Cu.in der letzten Zeile
  D847    0E 00          C      	ld	c,0		;Cu eine Zeile tiefer
  D849    CD D76C        C      	call	lf		;und zum linken Rand
  D84C    3A F68E        C      	ld	a,(yk)		;
  D84F    2F             C      	cpl			;Zeilenanzahl bis 
  D850    3C             C      	inc	a		;zum Bildende
  D851    C6 19          C      	add	a,19h
  D853    47             C      	ld	b,a
  D854    11 0140        C      	ld	de,320
  D857    21 0000        C      	ld	hl,0
  D85A    19             C      clsbs0:	add	hl,de		;Anzahl der zu loeschenden
  D85B    10 FD          C      	djnz	clsbs0		;Worte bilden
  D85D    22 F67E        C      clsbs1:	ld	(laeng),hl	;und Ausgabebereich ein-
  D860    21 F673        C      	ld	hl,zcls2	;tragen
  D863    CD D8A5        C      	call	ioup
  D866    ED 53 F67E     C      	ld	(laeng),de	;Laenge zum Zeilenloeschen
  D86A    C1             C      clsbs2:	pop	bc		;alte Cursoradr.
  D86B    ED 43 F68D     C      	ld	(xk),bc		;wieder ausgeben
  D86F    E1             C      	pop	hl
  D870    22 F691        C      	ld	(cursa),hl
  D873    CD D674        C      	call	cursc0
  D876    C9             C      	ret
                         C      ;=============================================================
                         C      ;Tabelle der Bildschirmsteuerzeichen und Adressen dazu
  D877    01             C      jptab:	db	01h
  D878    D74E           C      	dw	ghome
  D87A    07             C      	db	07h
  D87B    C329           C      	dw	ton
  D87D    08             C      	db	08h
  D87E    D822           C      	dw	cu1l
	MACRO-80 V3.50	25-Oct-85	Page	1-59
'GRAFIK'

  D880    0A             C      	db	0ah
  D881    D76C           C      	dw	lf
  D883    0C             C      	db	0ch
  D884    D77E           C      	dw	bloeh
  D886    0D             C      	db	0dh
  D887    D7A3           C      	dw	cr
  D889    16             C      	db	16h
  D88A    D7AD           C      	dw	clszc	;loescht ab Cu Zeile
  D88C    15             C      	db	15h
  D88D    D7D3           C      	dw	cu1r
  D88F    14             C      	db	14h
  D890    D836           C      	dw	clsbs	;loeschen ab Cu ges Bildsch
  D892    18             C      	db	18h
  D893    D7DA           C      	dw	clszi	;loeschen Zeile ,Cu nach links
  D895    1A             C      	db	1ah
  D896    D7E7           C      	dw	cu1h
  D898    1B             C      	db	1bh
  D899    D805           C      	dw	xyein
  D89B    82             C      	db	82h	;Es ist darauf zu achten,dass
  D89C    D810           C      	dw	cuein	;1bh-Folgen beendet sind, da
  D89E    83             C      	db	83h	;sonst diese Kommandos als Bild-
  D89F    D819           C      	dw	cuaus	;koordinaten gewertet werden!!
  D8A1    7F             C      	db	7fh
  D8A2    D761           C      	dw	del
  D8A4    FF             C      	db	0ffh	;Ende der Tab
                         C      ;Prg. zur Ausgabe zum GDC  
                         C      ;(HL)=Datenbereich ;(Laenge,Kommando,Parameter)
  D8A5    46             C      ioup:	ld	b,(hl)
  D8A6    04             C      	inc	b
  D8A7    C8             C      	ret	z	;wenn (hl)=ffh dann Sprung
  D8A8    05             C      	dec	b
  D8A9    23             C      	inc	hl
  D8AA    0E 8F          C      	ld	c,gdcd
  D8AC    ED A3          C      	outi	
  D8AE    F5             C      	push	af
  D8AF    DB 8E          C      ioup0:	in	a,(gdcc)	;Test ob letzte Operation ausge-
  D8B1    E6 04          C      	and	4		;fuehrt wurde
  D8B3    28 FA          C      	jr	z,ioup0	
  D8B5    F1             C      	pop	af
  D8B6    28 ED          C      	jr	z,ioup
  D8B8    0D             C      	dec	c
  D8B9    DB 8E          C      ioup1:	in	a,(gdcc)	;Test ob FIFO-Puffer nicht
  D8BB    E6 02          C      	and	2		;voll ist
  D8BD    20 FA          C      	jr	nz,ioup1
  D8BF    ED A3          C      	outi
  D8C1    20 F6          C      	jr	nz,ioup1
  D8C3    18 E0          C      	jr	ioup
                         C      ;===============================================================
                         C      ;Unterprogramm Punkt setzen/ruecksetzen
  D8C5    F5             C      pixel:	push	af
  D8C6    E5             C      	push	hl
  D8C7    C5             C      	push	bc
  D8C8    D5             C      	push	de
  D8C9    DD E5          C      	push	ix
  D8CB    CD DA70        C      	call	upcup
  D8CE    21 0000        C      	ld 	hl,0h
  D8D1    22 F62F        C      	ld	(drich),hl
  D8D4    22 F631        C      	ld	(drich+2),hl
  D8D7    21 F622        C      	ld	hl,dwdat
  D8DA    CD D8A5        C      	call	ioup
  D8DD    C3 D631        C      	jp	ende
                         C      ;Programm zum Zeichnen von Strecken entsp.x1 y1 x2 y2
  D8E0    F5             C      draw:	push	af
  D8E1    E5             C      	push	hl
  D8E2    C5             C      	push	bc
	MACRO-80 V3.50	25-Oct-85	Page	1-60
'GRAFIK'

  D8E3    D5             C      	push	de
  D8E4    DD E5          C      	push	ix
  D8E6    CD D9AC        C      	call	upokt	
  D8E9    CD DA05        C      	call	upprg
  D8EC    CD DA70        C      	call	upcup
  D8EF    21 F622        C      	ld	hl,dwdat
  D8F2    CD D8A5        C      	call	ioup
  D8F5    C3 D631        C      	jp	ende
                         C      ;Zeichnung eines Rechtecks x1,y1 Bezugskoordin.
                         C      ;x2,y2 entsprechen Seitenlaenge, rotat Rotation
                         C      ;um je 45 grd
  D8F8    F5             C      prbox:	push	af
  D8F9    E5             C      	push	hl
  D8FA    C5             C      	push	bc
  D8FB    D5             C      	push	de
  D8FC    DD E5          C      	push	ix
  D8FE    CD DA70        C      	call	upcup
  D901    DD 21 F62F     C      	ld	ix,drich
  D905    06 40          C      	ld	b,40h
  D907    3A F61D        C      	ld	a,(rotat)
  D90A    B0             C      	or	b
  D90B    DD 77 00       C      	ld	(ix),a
  D90E    DD 36 01 03    C      	ld	(ix+1),3
  D912    2A F61B        C      	ld	hl,(y2)
  D915    ED 5B F619     C      	ld	de,(x2)
  D919    2B             C      	dec	hl
  D91A    1B             C      	dec	de
  D91B    DD 75 03       C      	ld	(ix+3),l
  D91E    DD 74 04       C      	ld	(ix+4),h
  D921    DD 73 05       C      	ld	(ix+5),e
  D924    DD 72 06       C      	ld	(ix+6),d
  D927    DD 36 07 FF    C      	ld	(ix+7),0ffh
  D92B    DD 36 08 3F    C      	ld	(ix+8),3fh
  D92F    DD 75 09       C      	ld	(ix+9),l
  D932    DD 74 0A       C      	ld	(ix+0ah),h
  D935    21 F622        C      	ld	hl,dwdat
  D938    CD D8A5        C      	call	ioup
  D93B    C3 D631        C      	jp	ende
                         C      ;Zeile des aktuellen Cursors in den
                         C      ;RAM-Bereich schreiben
  D93E    F5             C      hpr:	push	af
  D93F    E5             C      	push	hl
  D940    C5             C      	push	bc
  D941    D5             C      	push	de
  D942    DD E5          C      	push	ix
  D944    CD D652        C      	call	cursb0
  D947    CD DAAF        C      	call	curss
  D94A    21 DADF        C      	ld	hl,cmask
  D94D    CD D8A5        C      	call	ioup
  D950    21 DAEE        C      	ld	hl,figsr
  D953    CD D8A5        C      	call	ioup
  D956    3E A1          C      	ld	a,0a1h
  D958    D3 8F          C      	out	(gdcd),a
  D95A    2A F620        C      	ld	hl,(pber)
  D95D    06 08          C      	ld	b,8		;Pixelzeilen
  D95F    C5             C      hpr1:	push	bc
  D960    06 50          C      	ld	b,xmax/8	;Zeichen je Zeile
  D962    CD DAA2        C      	call	inup
  D965    C1             C      	pop	bc
  D966    10 F7          C      	djnz	hpr1
  D968    CD DAAF        C      	call	curss
  D96B    CD D652        C      	call	cursb0
  D96E    C3 D631        C      	jp	ende
                         C      ;Zeile auf Bilschirm schreiben,
                         C      ;es wird die aktuelle Cursorzeile be-
	MACRO-80 V3.50	25-Oct-85	Page	1-61
'GRAFIK'

                         C      ;nutzt
  D971    F5             C      hpw:	push	af
  D972    E5             C      	push	hl
  D973    C5             C      	push	bc
  D974    D5             C      	push	de
  D975    DD E5          C      	push	ix
  D977    CD D652        C      	call	cursb0
  D97A    21 DAE4        C      	ld	hl,synca
  D97D    CD D8A5        C      	call	ioup
  D980    CD DAAF        C      	call	curss
  D983    21 DADF        C      	ld	hl,cmask
  D986    CD D8A5        C      	call	ioup
  D989    3E 20          C      	ld	a,20h
  D98B    D3 8F          C      	out	(gdcd),a
  D98D    06 08          C      	ld	b,8		;Pixel
  D98F    2A F620        C      	ld	hl,(pber)
  D992    C5             C      hpw1:	push	bc
  D993    06 50          C      	ld	b,xmax/8	;Zeichen/Zeile
  D995    0E 8E          C      	ld	c,gdcc
  D997    CD DA97        C      	call	ioup3
  D99A    C1             C      	pop	bc
  D99B    10 F5          C      	djnz	hpw1
  D99D    21 DAF4        C      	ld	hl,syncb
  D9A0    CD D8A5        C      	call	ioup
  D9A3    CD DAAF        C      	call	curss
  D9A6    CD D652        C      	call	cursb0
  D9A9    C3 D631        C      	jp 	ende
                         C      
                         C      ;Zeichnungsrichtung (8-tel) sowie deltax und deltay
                         C      ;fuer figs-Kommando aus x1,y1,x2,y2 errechnen 
  D9AC    2A F619        C      upokt:	ld	hl,(x2)
  D9AF    ED 4B F615     C      	ld	bc,(x1)
  D9B3    A7             C      	and	a
  D9B4    ED 42          C      	sbc	hl,bc
  D9B6    38 22          C      	jr	c,m1
  D9B8    22 F63D        C      	ld	(dx),hl
  D9BB    ED 4B F617     C      	ld	bc,(y1)
  D9BF    2A F61B        C      	ld	hl,(y2)
  D9C2    A7             C      	and	a
  D9C3    ED 42          C      	sbc	hl,bc
  D9C5    38 06          C      	jr	c,m2
  D9C7    22 F63F        C      	ld	(dy),hl
  D9CA    3E 03          C      	ld	a,3
  D9CC    C9             C      	ret
  D9CD    E5             C      m2:	push	hl
  D9CE    C1             C      	pop	bc
  D9CF    21 0000        C      	ld	hl,0
  D9D2    A7             C      	and	a
  D9D3    ED 42          C      	sbc	hl,bc
  D9D5    22 F63F        C      	ld	(dy),hl
  D9D8    AF             C      	xor	a
  D9D9    C9             C      	ret
  D9DA    E5             C      m1:	push	hl
  D9DB    C1             C      	pop	bc
  D9DC    21 0000        C      	ld	hl,0
  D9DF    A7             C      	and	a
  D9E0    ED 42          C      	sbc	hl,bc
  D9E2    22 F63D        C      	ld	(dx),hl
  D9E5    ED 4B F617     C      	ld	bc,(y1)
  D9E9    2A F61B        C      	ld	hl,(y2)
  D9EC    A7             C      	and	a
  D9ED    ED 42          C      	sbc	hl,bc
  D9EF    38 06          C      	jr	c,m3
  D9F1    22 F63F        C      	ld	(dy),hl
  D9F4    3E 02          C      	ld	a,2
	MACRO-80 V3.50	25-Oct-85	Page	1-62
'GRAFIK'

  D9F6    C9             C      	ret
  D9F7    E5             C      m3:	push	hl
  D9F8    C1             C      	pop	bc
  D9F9    21 0000        C      	ld	hl,0
  D9FC    A7             C      	and	a
  D9FD    ED 42          C      	sbc	hl,bc
  D9FF    22 F63F        C      	ld	(dy),hl
  DA02    3E 01          C      	ld	a,1
  DA04    C9             C      	ret
                         C      ;figs-Kommando fuer Zeichenoperation vorbereiten,
                         C      ;spezifische Kommandodaten errechnen
  DA05    ED 4B F63D     C      upprg:	ld	bc,(dx)
  DA09    2A F63F        C      	ld	hl,(dy)
  DA0C    A7             C      	and	a
  DA0D    ED 42          C      	sbc	hl,bc
  DA0F    2A F63D        C      	ld	hl,(dx)
  DA12    ED 5B F63F     C      	ld	de,(dy)
  DA16    38 03          C      	jr	c,m4
  DA18    EB             C      	ex	de,hl
  DA19    C6 04          C      	add	a,4
  DA1B    ED 53 F63D     C      m4:	ld	(dx),de
  DA1F    22 F63F        C      	ld	(dy),hl
  DA22    21 DAFD        C      	ld	hl,okt1
  DA25    85             C      	add	a,l
  DA26    30 01          C      	jr	nc,m5
  DA28    24             C      	inc	h
  DA29    6F             C      m5:	ld	l,a
  DA2A    7E             C      	ld	a,(hl)
  DA2B    F6 08          C      	or	8
  DA2D    32 F62F        C      	ld	(drich),a
  DA30    2A F63F        C      	ld	hl,(dy)
  DA33    7C             C      	ld	a,h
  DA34    E6 3F          C      	and	3fh
  DA36    67             C      	ld	h,a
  DA37    22 F630        C      	ld	(drich+1),hl
  DA3A    ED 5B F63D     C      	ld	de,(dx) 
  DA3E    A7             C      	and	a
  DA3F    CB 13          C      	rl	e
  DA41    CB 12          C      	rl	d
  DA43    EB             C      	ex	de,hl
  DA44    A7             C      	and	a	;theor. Carry nicht gesetzt
  DA45    ED 52          C      	sbc	hl,de
  DA47    7C             C      	ld	a,h
  DA48    E6 3F          C      	and	3fh
  DA4A    67             C      	ld	h,a
  DA4B    22 F632        C      	ld	(drich+3),hl
  DA4E    2A F63D        C      	ld	hl,(dx)
  DA51    ED 5B F63F     C      	ld	de,(dy)
  DA55    A7             C      	and	a
  DA56    ED 52          C      	sbc	hl,de
  DA58    A7             C      	and	a
  DA59    CB 15          C      	rl	l
  DA5B    CB 14          C      	rl	h
  DA5D    7C             C      	ld	a,h
  DA5E    E6 3F          C      	and	3fh
  DA60    67             C      	ld	h,a
  DA61    22 F634        C      	ld	(drich+5),hl
  DA64    2A F63D        C      	ld	hl,(dx)
  DA67    A7             C      	and	a
  DA68    CB 15          C      	rl	l
  DA6A    CB 14          C      	rl	h
  DA6C    22 F636        C      	ld	(drich+7),hl
  DA6F    C9             C      	ret
                         C      ;aus x1,y1 Cursoradr. errechnen und in Ausgabe-
                         C      ;datenbereich eintragen
	MACRO-80 V3.50	25-Oct-85	Page	1-63
'GRAFIK'

  DA70    2A F617        C      upcup:	ld	hl,(y1)
  DA73    29             C      upcup1:	add	hl,hl
  DA74    29             C      	add	hl,hl
  DA75    29             C      	add	hl,hl
  DA76    E5             C      	push	hl
  DA77    29             C      	add	hl,hl
  DA78    29             C      	add	hl,hl
  DA79    D1             C      	pop	de
  DA7A    19             C      	add	hl,de
  DA7B    ED 5B F615     C      	ld	de,(x1)
  DA7F    AF             C      	xor	a
  DA80    06 04          C      	ld	b,4
  DA82    CB 1A          C      m6:	rr	d
  DA84    CB 1B          C      	rr	e
  DA86    CB 1F          C      	rr	a
  DA88    10 F8          C      	djnz	m6
  DA8A    19             C      	add	hl,de
  DA8B    ED 5B F68F     C      	ld	de,(curs0)
  DA8F    19             C      	add	hl,de	;errechnete Adr.+Bildanf.
  DA90    22 F62A        C      	ld	(dpos),hl
  DA93    32 F62C        C      	ld	(dpix),a
  DA96    C9             C      	ret
  DA97    DB 8E          C      ioup3:	in	a,(gdcc)
  DA99    E6 02          C      	and	2
  DA9B    20 FA          C      	jr	nz,ioup3
  DA9D    ED A3          C      	outi
  DA9F    20 F6          C      	jr	nz,ioup3
  DAA1    C9             C      	ret
  DAA2    0E 8F          C      inup:	ld	c,gdcd
  DAA4    DB 80          C      inup1:	in	a,(80h)
  DAA6    E6 01          C      	and	1
  DAA8    28 FA          C      	jr	z,inup1
  DAAA    ED A2          C      	ini
  DAAC    20 F6          C      	jr	nz,inup1
  DAAE    C9             C      	ret
                         C      
  DAAF    2A F691        C      curss:	ld	hl,(cursa)
  DAB2    22 F66F        C      	ld	(pos),hl
  DAB5    AF             C      	xor	a
  DAB6    32 F671        C      	ld	(pix),a
  DAB9    21 F66B        C      	ld	hl,zcls1
  DABC    CD D8A5        C      	call 	ioup
  DABF    C9             C      	ret
                         C      
                         C      ;Initialisierungsparameter fuer den GDC (Laenge,Kommando,Parameter...)
                         C      ;Daten koennen auch im ROM stehen
  DAC0    09 00 12 26    C      inid:	defm	9,0,12h,26h	;Reset GDC und Bildschirm-
  DAC4    48 1D 07 37    C      	defm	48h,1dh,7h,37h	;parameter 640*200 Pixel
  DAC8    C8 98          C      	defm	0c8h,98h	;kein Refresh,Graphikbetrieb
  DACA    01 6F          C      	defm	1,6fh		;Vertikalsync. durch GDC ein
  DACC    09 70 00 00    C      	defm	9,70h,0,0	;PRAM auf 640*200 festlegen
  DAD0    80 0C FF FF    C      	defm	80h,0ch,0ffh,0ffh	
  DAD4    FF FF          C      	defm	0ffh,0ffh
  DAD6    02 47 28       C      	defm	2,47h,28h	;Pitch (Worte pro Zeile)
  DAD9    02 46 00       C      	defm	2,46h,00	;Zoom 00
  DADC    01 6B FF       C      	defm	1,6bh,0ffh	;Bildschirmfreigabe
                         C      ;Zeichenparameter
  DADF    03 4A FF FF    C      cmask:	db	3,4ah,0ffh,0ffh,0ffh	
  DAE3    FF             C      
  DAE4    02 0E 10       C      synca:	db	2,0eh,10h
  DAE7    02 73 4F       C      mpram:	db	2,73h,4fh
  DAEA    02 4C 02 FF    C      figsw:	db	2,4ch,02h,0ffh
  DAEE    04 4C 02 40    C      figsr:	db	4,4ch,02h,040h,1,0ffh
  DAF2    01 FF          C      
  DAF4    02 0E 12       C      syncb:	db	2,0eh,12h
	MACRO-80 V3.50	25-Oct-85	Page	1-64
'GRAFIK'

  DAF7    02 73 0F 01    C      gpram:	db	2,73h,0fh,1,0dh,0ffh
  DAFB    0D FF          C      
  DAFD    02 05 06 01    C      okt1:	db	2,5,6,1,3,4,7,0
  DB01    03 04 07 00    C      
                         C      include GDCZG2.MAC
  DB05    00 00 00 00    C      zganf:	db	0,0,0,0,0,0,0,0
  DB09    00 00 00 00    C      
  DB0D    00 00 00 5F    C      	db	0,0,0,5fh,5fh,0,0,0
  DB11    5F 00 00 00    C      
  DB15    00 00 07 07    C      	db	0,0,7,7,0,7,7,0
  DB19    00 07 07 00    C      
  DB1D    00 14 7F 7F    C      	db	0,14h,7fh,7fh,14h,7fh,7fh,14h
  DB21    14 7F 7F 14    C      
  DB25    00 12 2A 7F    C      	db	0,12h,2ah,7fh,7fh,2ah,24h,0
  DB29    7F 2A 24 00    C      
  DB2D    00 62 66 0C    C      	db	0,62h,66h,0ch,18h,30h,66h,46h
  DB31    18 30 66 46    C      
  DB35    00 48 7A 37    C      	db	0,48h,7ah,37h,5dh,4fh,7ah,30h
  DB39    5D 4F 7A 30    C      
  DB3D    00 00 00 03    C      	db	0,0,0,3,7,4,0,0
  DB41    07 04 00 00    C      
  DB45    00 00 41 63    C      	db	0,0,41h,63h,3eh,1ch,0,0
  DB49    3E 1C 00 00    C      
  DB4D    00 00 1C 3E    C      	db	0,0,1ch,3eh,63h,41h,0,0
  DB51    63 41 00 00    C      
  DB55    08 2A 3E 1C    C      	db	8,2ah,3eh,1ch,1ch,3eh,2ah,8
  DB59    1C 3E 2A 08    C      
  DB5D    00 08 08 3E    C      	db	0,8,8,3eh,3eh,8,8,0
  DB61    3E 08 08 00    C      
  DB65    00 00 00 60    C      	db	0,0,0,60h,0e0h,80h,0,0
  DB69    E0 80 00 00    C      
  DB6D    00 08 08 08    C      	db	0,8,8,8,8,8,8,0
  DB71    08 08 08 00    C      
  DB75    00 00 00 60    C      	db	0,0,0,60h,60h,0,0,0
  DB79    60 00 00 00    C      
  DB7D    00 01 03 06    C      	db	0,1,3,6,0ch,18h,30h,60h
  DB81    0C 18 30 60    C      
  DB85    00 3E 7F 45    C      	db	0,3eh,7fh,45h,49h,51h,7fh,3eh
  DB89    49 51 7F 3E    C      
  DB8D    00 40 40 7F    C      	db	0,40h,40h,7fh,7fh,42h,40h,0
  DB91    7F 42 40 00    C      
  DB95    00 66 6F 49    C      	db	0,66h,6fh,49h,49h,7bh,72h,0
  DB99    49 7B 72 00    C      
  DB9D    00 36 7F 49    C      	db	0,36h,7fh,49h,49h,63h,22h,0
  DBA1    49 63 22 00    C      
  DBA5    00 50 7F 7F    C      	db	0,50h,7fh,7fh,53h,16h,1ch,18h
  DBA9    53 16 1C 18    C      
  DBAD    00 33 79 49    C      	db	0,33h,79h,49h,49h,6fh,2fh,0
  DBB1    49 6F 2F 00    C      
  DBB5    00 32 7B 49    C      	db	0,32h,7bh,49h,49h,7fh,3eh,0
  DBB9    49 7F 3E 00    C      
  DBBD    00 07 0F 79    C      	db	0,7,0fh,79h,71h,3,3,0
  DBC1    71 03 03 00    C      
  DBC5    00 36 7F 49    C      	db	0,36h,7fh,49h,49h,7fh,36h,0
  DBC9    49 7F 36 00    C      
  DBCD    00 3E 7F 49    C      	db	0,3eh,7fh,49h,49h,6fh,26h,0
  DBD1    49 6F 26 00    C      
  DBD5    00 00 00 6C    C      	db	0,0,0,6ch,6ch,0,0,0
  DBD9    6C 00 00 00    C      
  DBDD    00 00 00 6C    C      	db	0,0,0,6ch,0ech,80h,0,0
  DBE1    EC 80 00 00    C      
  DBE5    00 00 41 63    C      	db	0,0,41h,63h,36h,1ch,8,0
  DBE9    36 1C 08 00    C      
  DBED    00 24 24 24    C      	db	0,24h,24h,24h,24h,24h,24h,0
  DBF1    24 24 24 00    C      
	MACRO-80 V3.50	25-Oct-85	Page	1-65
'GRAFIK'

  DBF5    00 00 08 1C    C      	db	0,0,8,1ch,36h,63h,41h,0
  DBF9    36 63 41 00    C      
  DBFD    00 06 0F 59    C      	db	0,6,0fh,59h,51h,7,6,0
  DC01    51 07 06 00    C      
  DC05    00 1E 5F 5D    C      	db	0,1eh,5fh,5dh,5dh,41h,7fh,3eh
  DC09    5D 41 7F 3E    C      
  DC0D    00 7C 7E 13    C      	db	0,7ch,7eh,13h,13h,7eh,7ch,0
  DC11    13 7E 7C 00    C      
  DC15    00 36 7F 49    C      	db	0,36h,7fh,49h,49h,7fh,7fh,41h
  DC19    49 7F 7F 41    C      
  DC1D    00 22 63 41    C      	db	0,22h,63h,41h,41h,63h,3eh,1ch
  DC21    41 63 3E 1C    C      
  DC25    00 1C 3E 63    C      	db	0,1ch,3eh,63h,41h,7fh,7fh,41h
  DC29    41 7F 7F 41    C      
  DC2D    00 63 41 5D    C      	db	0,63h,41h,5dh,49h,7fh,7fh,41h
  DC31    49 7F 7F 41    C      
  DC35    00 03 01 1D    C      	db	0,3,1,1dh,49h,7fh,7fh,41h
  DC39    49 7F 7F 41    C      
  DC3D    00 72 73 51    C      	db	0,72h,73h,51h,41h,63h,3eh,1ch
  DC41    41 63 3E 1C    C      
  DC45    00 7F 7F 08    C      	db	0,7fh,7fh,8,8,7fh,7fh,0
  DC49    08 7F 7F 00    C      
  DC4D    00 41 41 7F    C      	db	0,41h,41h,7fh,7fh,41h,41h,0
  DC51    7F 41 41 00    C      
  DC55    00 01 3F 7F    C      	db	0,1,3fh,7fh,41h,40h,70h,30h
  DC59    41 40 70 30    C      
  DC5D    00 63 77 1C    C      	db	0,63h,77h,1ch,8,7fh,7fh,41h
  DC61    08 7F 7F 41    C      
  DC65    00 70 60 40    C      	db	0,70h,60h,40h,41h,7fh,7fh,41h
  DC69    41 7F 7F 41    C      
  DC6D    00 7F 7F 0E    C      	db	0,7fh,7fh,0eh,1ch,0eh,7fh,7fh
  DC71    1C 0E 7F 7F    C      
  DC75    00 7F 7F 18    C      	db	0,7fh,7fh,18h,0ch,6,7fh,7fh
  DC79    0C 06 7F 7F    C      
  DC7D    00 1C 3E 63    C      	db	0,1ch,3eh,63h,41h,63h,3eh,1ch
  DC81    41 63 3E 1C    C      
  DC85    00 06 0F 09    C      	db	0,6,0fh,9,49h,7fh,7fh,41h
  DC89    49 7F 7F 41    C      
  DC8D    00 5C 6E 33    C      	db	0,5ch,6eh,33h,51h,43h,7eh,3ch
  DC91    51 43 7E 3C    C      
  DC95    00 66 7F 19    C      	db	0,66h,7fh,19h,9,7fh,7fh,41h
  DC99    09 7F 7F 41    C      
  DC9D    00 32 7B 49    C      	db	0,32h,7bh,49h,49h,6fh,26h,0
  DCA1    49 6F 26 00    C      
  DCA5    00 03 41 7F    C      	db	0,3,41h,7fh,7fh,41h,3,0
  DCA9    7F 41 03 00    C      
  DCAD    00 3F 7F 40    C      	db	0,3fh,7fh,40h,40h,7fh,3fh,0
  DCB1    40 7F 3F 00    C      
  DCB5    00 1F 3F 60    C      	db	0,1fh,3fh,60h,60h,3fh,1fh,0
  DCB9    60 3F 1F 00    C      
  DCBD    00 7F 7F 30    C      	db	0,7fh,7fh,30h,18h,30h,7fh,7fh
  DCC1    18 30 7F 7F    C      
  DCC5    00 61 73 1E    C      	db	0,61h,73h,1eh,0ch,1eh,73h,61h
  DCC9    0C 1E 73 61    C      
  DCCD    00 07 4F 78    C      	db	0,7,4fh,78h,78h,4fh,7,0
  DCD1    78 4F 07 00    C      
  DCD5    00 73 67 4D    C      	db	0,73h,67h,4dh,59h,71h,63h,47h
  DCD9    59 71 63 47    C      
  DCDD    00 00 41 41    C      	db	0,0,41h,41h,7fh,7fh,0,0
  DCE1    7F 7F 00 00    C      
  DCE5    80 80 80 80    C      	db	80h,80h,80h,80h,80h,80h,80h,80h
  DCE9    80 80 80 80    C      
  DCED    00 00 7F 7F    C      	db	0,0,7fh,7fh,41h,41h,0,0
  DCF1    41 41 00 00    C      
  DCF5    00 04 06 7F    C      	db	0,4,6,7fh,7fh,6,4,0
	MACRO-80 V3.50	25-Oct-85	Page	1-66
'GRAFIK'

  DCF9    7F 06 04 00    C      
  DCFD    C0 C0 C0 C0    C      	db	0c0h,0c0h,0c0h,0c0h,0c0h,0c0h,0c0h,0c0h
  DD01    C0 C0 C0 C0    C      
  DD05    00 00 04 06    C      	db	0,0,4,6,3,1,0,0
  DD09    03 01 00 00    C      
  DD0D    00 40 78 3C    C      	db	0,40h,78h,3ch,54h,54h,74h,20h
  DD11    54 54 74 20    C      
  DD15    00 38 7C 44    C      	db	0,38h,7ch,44h,44h,3fh,7fh,41h
  DD19    44 3F 7F 41    C      
  DD1D    00 28 6C 44    C      	db	0,28h,6ch,44h,44h,7ch,38h,0
  DD21    44 7C 38 00    C      
  DD25    00 40 7F 3F    C      	db	0,40h,7fh,3fh,45h,44h,7ch,38h
  DD29    45 44 7C 38    C      
  DD2D    00 18 5C 54    C      	db	0,18h,5ch,54h,54h,7ch,38h,0
  DD31    54 7C 38 00    C      
  DD35    00 02 03 49    C      	db	0,2,3,49h,7fh,7eh,48h,0
  DD39    7F 7E 48 00    C      
  DD3D    00 7C FC A4    C      	db	0,7ch,0fch,0a4h,0a4h,0bch,98h,0
  DD41    A4 BC 98 00    C      
  DD45    00 78 7C 04    C      	db	0,78h,7ch,4,8,7fh,7fh,41h
  DD49    08 7F 7F 41    C      
  DD4D    00 00 40 7D    C      	db	0,0,40h,7dh,7dh,44h,0,0
  DD51    7D 44 00 00    C      
  DD55    00 7D FD 84    C      	db	0,7dh,0fdh,84h,80h,0e0h,60h,0
  DD59    80 E0 60 00    C      
  DD5D    00 44 6C 38    C      	db	0,44h,6ch,38h,10h,7fh,7fh,41h
  DD61    10 7F 7F 41    C      
  DD65    00 00 40 7F    C      	db	0,0,40h,7fh,7fh,41h,0,0
  DD69    7F 41 00 00    C      
  DD6D    00 78 7C 0C    C      	db	0,78h,7ch,0ch,38h,0ch,7ch,78h
  DD71    38 0C 7C 78    C      
  DD75    00 78 7C 04    C      	db	0,78h,7ch,4,4,78h,7ch,4
  DD79    04 78 7C 04    C      
  DD7D    00 38 7C 44    C      	db	0,38h,7ch,44h,44h,7ch,38h,0
  DD81    44 7C 38 00    C      
  DD85    00 18 3C 24    C      	db	0,18h,3ch,24h,0a4h,0f8h,0fch,84h
  DD89    A4 F8 FC 84    C      
  DD8D    00 84 FC F8    C      	db	0,84h,0fch,0f8h,0a4h,24h,3ch,18h
  DD91    A4 24 3C 18    C      
  DD95    00 08 0C 04    C      	db	0,8,0ch,4,4ch,78h,7ch,44h
  DD99    4C 78 7C 44    C      
  DD9D    00 20 74 54    C      	db	0,20h,74h,54h,54h,5ch,48h,0
  DDA1    54 5C 48 00    C      
  DDA5    00 20 64 44    C      	db	0,20h,64h,44h,7fh,3fh,4,0
  DDA9    7F 3F 04 00    C      
  DDAD    00 7C 7C 40    C      	db	0,7ch,7ch,40h,40h,7ch,3ch,0
  DDB1    40 7C 3C 00    C      
  DDB5    00 1C 3C 60    C      	db	0,1ch,3ch,60h,60h,3ch,1ch,0
  DDB9    60 3C 1C 00    C      
  DDBD    00 3C 7C 60    C      	db	0,3ch,7ch,60h,38h,60h,7ch,3ch
  DDC1    38 60 7C 3C    C      
  DDC5    00 44 6C 38    C      	db	0,44h,6ch,38h,10h,38h,6ch,44h
  DDC9    10 38 6C 44    C      
  DDCD    00 7C FC A0    C      	db	0,7ch,0fch,0a0h,0a0h,0bch,9ch,0
  DDD1    A0 BC 9C 00    C      
  DDD5    00 64 4C 5C    C      	db	0,64h,4ch,5ch,74h,64h,4ch,0
  DDD9    74 64 4C 00    C      
  DDDD    00 41 41 77    C      	db	0,41h,41h,77h,3eh,8,8,0
  DDE1    3E 08 08 00    C      
  DDE5    00 00 00 7F    C      	db	0,0,0,7fh,7fh,0,0,0
  DDE9    7F 00 00 00    C      
  DDED    00 08 08 3E    C      	db	0,8,8,3eh,77h,41h,41h,0
  DDF1    77 41 41 00    C      
  DDF5    00 01 03 02    C      	db	0,1,3,2,3,1,3,2
  DDF9    03 01 03 02    C      
	MACRO-80 V3.50	25-Oct-85	Page	1-67
'GRAFIK'

  DDFD    FF FF FF FF    C      	db	0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
  DE01    FF FF FF FF    C      
                         C      
  DE05                          tabanf	equ	$
                                .dephase
                                .phase	gdcram
                         C      include	GDCRAM.MAC
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;einspruenge fuer grafik-display-controller 82720/7220
  F600    C3 D600        C      gdcini:	jp	inigdc		;initialisierung
  F603    C3 D617        C      gdcco:	jp	hp		;zeichenausgabe
  F606    C3 D8C5        C      	jp      pixel 		;punkt zeichnen /loeschen
  F609    C3 D8E0        C      	jp	draw		;linie zeichnen
  F60C    C3 D8F8        C      	jp	prbox		;rechteck zeichnen
  F60F    C3 D93E        C      	jp	hpr		;bildschirmzeile ruecklesen
  F612    C3 D971        C      	jp	hpw		;bildschirmzeile in speicher bringen
                         C      ;*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*---*
                         C      ;ram-tabellen fuer graphic-display-controller 7220
                         C      ;Bereich mit Daten zum Zeichnen(draw,prbox,circle)
  F615    00 00          C      x1:	db	0,0
  F617    00 00          C      y1:	db	0,0
  F619    0A 00          C      x2:	db	10,0
  F61B    0A 00          C      y2:	db	10,0
  F61D    00             C      rotat:	db	0		;fuer prbox
  F61E    DB05           C      zgadr:	dw	zganf	;Adresse des Zeichengenerators
  F620    00 FD          C      pber:	db	0,0fdh		;Adr. des Copybereichs im RAM(27fh lang)
  F622    01 20          C      dwdat:	db	1,20h		;Pattern-Pixel Linienart beim
  F624    03 78 FF FF    C      dpram:	db	3,78h,0ffh,0ffh	;Zeichnen
  F628    04 49          C      dcurs:	db	4,49h
  F62A    00 00          C      dpos:	db	0,0
  F62C    00             C      dpix:	db	0
  F62D    0C 4C          C      dfigs:	db	0ch,4ch
  F62F    08 00 00 00    C      drich:	db	8,0,0,0,0,0,0,0,0,0ffh,0ffh
  F633    00 00 00 00    C      
  F637    00 FF FF       C      
  F63A    01 6C FF       C      	db	1,6ch,0ffh
  F63D    00 00          C      dx:	db	0,0
  F63F    00 00          C      dy:	db	0,0
                         C      ;Datenbereich zur Ausgabe der ASCII-Zeichen (Pattern) 
  F641    09 78          C      type:	db	9,78h
  F643    00 FF 00 FF    C      pramp:	db	0,0ffh,0,0ffh,0,0ffh,0,0ffh
  F647    00 FF 00 FF    C      
  F64B    03 4C 10 07    C      	db	3,4ch,10h,7		;8 Byte Laenge
  F64F    01 68 FF       C      	db	1,68h,0ffh		;Graphikzeichen ausgeben
                         C      ;Datenbereich zum Loeschen von Bildschirmausschnitten 
  F652    01 22 09 78    C      clszc0:	db	1,22h,9,78h,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
  F656    FF FF FF FF    C      
  F65A    FF FF          C      
  F65C    FF FF 03 4C    C      	db	0ffh,0ffh,3,4ch,10h
  F660    10             C      
  F661    2C 03 4A FF    C      clspos:	db	2ch,3,4ah,0ffh,0ffh,1,68h,1,20h,0ffh
  F665    FF 01 68 01    C      
  F669    20 FF          C      
  F66B    01             C      zcls1:	db	1
  F66C    20 04 49       C      smod:	db	20h,4,49h	        ;Cursorpositionierung
  F66F    00 00          C      pos:	db	0,0
  F671    00 FF          C      pix:	db	0,0ffh
  F673    03 78 FF FF    C      zcls2:	db	3,78h,0ffh,0ffh
  F677    03 4A FF FF    C              db	3,4ah,0ffh,0ffh		;Maske auf ffffh setzen
  F67B    04 4C 02       C      	db	4,4ch,2			;figs Kommando
  F67E    3F 01          C      laeng:	db	3fh,1	;
  F680    03 22 FF FF    C      	db	3,22h,0ffh,0ffh		;wdat reset Pixel
  F684    01 20 FF       C      cursa2:	db	1,20h,0ffh		;wdat Pattern Pixel
                         C      ;Datenbereich zum Bildschirmrollen
  F687    03 70          C      scroll:	db	3,70h	; im PRAM Adr. des Bilds.anfangs aendern
	MACRO-80 V3.50	25-Oct-85	Page	1-68
'GRAFIK'

  F689    00 00 FF       C      pos0:	db	0,0,0ffh
                         C      ;System Daten 
  F68C    01             C      flag:	db	1		;Curs.ein aus usw. 
  F68D    00             C      xk:	db	0		;x Koord.
  F68E    00             C      yk:	db	0		;y Koord.
  F68F    00 00          C      curs0:	db	0,0		;Adr. des Bildanfanges fuer GDC
  F691    00 00          C      cursa:	db	0,0		;Adr. der Zeile des Cursors  
  0093                   C      lgdcram	equ	$-gdcini
                         C      
                                .dephase
                                end
	MACRO-80 V3.50	25-Oct-85	Page	S
'GRAFIK'

Macros:

Symbols:
C345 	ACI             C356 	ACI1            C35E 	ACSTS           
CBA9 	ACTBL           C64B 	ADR             F5CFI 	ALOC            
C3C8 	ALZ             C00E 	ANF             0027 	APST            
C3C0 	APZ             C3B8 	ARZ             C37B 	AS1             
C393 	AS2             C39D 	AS3             C36F 	ASG             
C366 	ASGN            C1D9 	ASIO            F5DDI 	ASLC            
B400 	ASS             CE4A 	B1              CE53 	B2              
CE5B 	B3              CE5D 	B4              CE66 	B5              
CE75 	B6              CE31 	B7              CEAD 	B8              
CEA9 	B9              CEC7 	BA              8000 	BASIC           
CEC2 	BB              C5BA 	BBS             C50A 	BCCO            
C59C 	BCR             C5A2 	BCR1            CEA2 	BD              
C5B9 	BDEL            B000 	BDOS            CE9D 	BE              
C00E 	BEGIN           C60A 	BELL            C6A5 	BEND            
C6AB 	BIANF           C6A8 	BIEND           BE00 	BIOS            
C6B3 	BIOUT           C6B1 	BISET           C741 	BIT             
D000 	BIUM            C5AC 	BLF             C5C3 	BLHM            
C18AI 	BLK             F5CDI 	BLOC            D77E 	BLOEH           
C696 	BOUT            C69F 	BOUT1           FC00 	BRAM            
C16F 	BREAK           C4FE 	BS1CO           F5DBI 	BSLC            
C62B 	BSTAB           CC78 	CBTAB           C0E0 	CCI             
A800 	CCP             C210 	CENTR           C21E 	CENTR1          
0040 	CFDC            C73F 	CFLAG           C5D8 	CHOME           
C3F4I 	CI              C40B 	CI1             C3FA 	CI2             
C42B 	CI3             C43B 	CI4             C442 	CI5             
F5CCI 	CLOC            D836 	CLSBS           D85A 	CLSBS0          
D85D 	CLSBS1          D86A 	CLSBS2          F661 	CLSPOS          
D7AD 	CLSZC           F652 	CLSZC0          D7BB 	CLSZC2          
D7C8 	CLSZC3          D7DA 	CLSZI           DADF 	CMASK           
C18C 	CO              C5EC 	CO10            C5FB 	CO11            
C601 	CO13            C545 	CO15            C5C6 	CO8             
C524 	CO9             C036I 	COMC            C8A1 	CONV            
C970I 	COPY            D7A3 	CR              C320I 	CRLF            
F5DAI 	CSLC            C49E 	CSTS            D02B 	CTAB            
006C 	CTCA            006D 	CTCB            006F 	CTCD            
D7E7 	CU1H            D7F7 	CU1H0           D7EF 	CU1H1           
D822 	CU1L            D82E 	CU1L0           D7D3 	CU1R            
D819 	CUAUS           D810 	CUEIN           C5DC 	CUP             
F5ED 	CURS            F68F 	CURS0           F691 	CURSA           
F684 	CURSA2          D652 	CURSB0          D674 	CURSC0          
DAAF 	CURSS           C237 	CVAC            C242 	CVAC0           
C250 	CVAC1           C25C 	CVAC2           C26A 	CVAC3           
C271 	CVAC4           C276 	CVAC5           C270 	CVAC6           
C284 	CVCA            C29E 	CVCA0           C28E 	CVCA1           
C294 	CVCA2           C472 	CVTA            C475 	CVTA0           
C492 	CVTA2           F628 	DCURS           D761 	DEL             
D13C 	DEL1            D139 	DELAY           0041 	DFDC            
F62D 	DFIGS           C981 	DI0             C987 	DI1             
C97CI 	DISP            F5CBI 	DLOC            D046 	DMAADR          
F62C 	DPIX            F62A 	DPOS            F624 	DPRAM           
D8E0 	DRAW            F62F 	DRICH           80F0 	DSKBUF          
F5D9I 	DSLC            D033 	DTL             F622 	DWDAT           
F63D 	DX              F63F 	DY              CC98 	EDTAB           
F5CAI 	ELOC            D631 	ENDE            C4AD 	ENDF            
C99DI 	EOF             F500 	EOM             D031 	EOT             
D048 	ERFLAG          D168 	ERM             C8E0 	ERR1            
C050I 	ERROR           C1A8 	ESIO            F5D8I 	ESLC            
0003 	ETX             C8DE 	EX0             C720 	EXAF            
F5E0I 	EXI1            C879 	EXIT            C8D3 	EXPR            
C229 	FAP             C073I 	FCGA            C075 	FCGA1           
C082 	FCGA2           C08B 	FCGA3           C08D 	FCGA4           
	MACRO-80 V3.50	25-Oct-85	Page	S-1
'GRAFIK'

C1B3 	FEP             C9C8 	FI0             DAEE 	FIGSR           
DAEA 	FIGSW           C9C1I 	FILL            F68C 	FLAG            
F5FE 	FLGIO           C764 	FLNK            C75E 	FLNK1           
C75A 	FLNK2           F5CEI 	FLOC            C2E8 	FSA             
C2EE 	FSA1            C2FB 	FSE             C301 	FSE1            
F5DCI 	FSLC            0001 	GC              008E 	GDCC            
F603 	GDCCO           008F 	GDCD            F600 	GDCINI          
F600 	GDCRAM          D74E 	GHOME           C9E2 	GO0             
C9E7 	GO1             C9F8 	GO2             C9FB 	GO3             
CA09 	GO4             C9CFI 	GOTO            D032 	GPL             
DAF7 	GPRAM           C66A 	HD              D03E 	HEAD            
C671 	HEADR           D175 	HEADS           D02E 	HED             
C6F7 	HEDIN           CA0CI 	HEXN            C890 	HILO            
F5E2I 	HLOC            D617 	HP              D638 	HP1             
D93E 	HPR             D95F 	HPR1            D971 	HPW             
D992 	HPW1            F5D7I 	HSLC            D040 	HSTDSK          
D02F 	HSTSEC          0400 	HSTSIZ          D041 	HSTTRK          
C933 	IBYTE           F5D5I 	ILOC            D04B 	INI1            
D044 	INIBIT          DAC0 	INID            D048 	INIFD           
D600 	INIGDC          C10B 	INIT            DAA2 	INUP            
DAA4 	INUP1           F5FF 	IOBYT           C102 	IOCHK           
C106 	IOSET           D8A5 	IOUP            D8AF 	IOUP0           
D8B9 	IOUP1           DA97 	IOUP3           0004 	IP              
D15F 	IRDY            0008 	IS              0000 	IT              
000C 	IU              C119 	IV24            D877 	JPTAB           
C08F 	JPTBL           CAD5I 	KNOW            D011 	LADER           
C8BC 	LADR            F67E 	LAENG           00B0 	LBITA0          
00B2 	LBITA1          00CD 	LBITE           000F 	LBSTAB          
C8C1 	LBYTE           0080 	LC              C316I 	LCRLF           
C642 	LD              C6E3 	LDBEG           C6E0 	LDBRK           
C72A 	LDTYP           0414 	LDWART          C6EB 	LDWRT           
C9BA 	LE0             C9B8 	LEAD            D76C 	LF              
0016 	LFLNK0          0093 	LGDCRAM         009C 	LHEADA          
00C6 	LHEADE          C3D0 	LINK            F5E1I 	LLOC            
003F 	LMSK            C1E3 	LO              C6D0 	LOAD1           
C382 	LOOP0           C389 	LOOP1           F5F9 	LOUSR           
0003 	LPIOA           0003 	LPIOB           8100 	LRAM            
C8AB 	LREG            0007 	LSIOA           0007 	LSIOB           
F5D6I 	LSLC            C1FE 	LST2            80E0 	LSTACK          
C1F7 	LSTV24          00C9 	LSYNA           00D4 	LSYNE           
0000 	LT              0040 	LTB             C3AC 	LTBL            
0036 	LTOS            00C0 	LU              0040 	LV              
CC0A 	M0001           CC1E 	M0002           CC29 	M0003           
CC2F 	M0004           CC37 	M0005           CC51 	M0006           
CC55 	M0007           CC5A 	M0008           CC5B 	M0009           
CC72 	M000A           CDE3 	M000C           CDE8 	M000D           
CE05 	M000E           CE0E 	M000F           CE0F 	M0010           
CE28 	M0011           CE3B 	M0012           CE40 	M0013           
CE43 	M0014           CE45 	M0015           CE48 	M0016           
CE8B 	M0017           CE8C 	M0018           CE4D 	M0019           
CE92 	M001B           CEA5 	M001C           CEB1 	M001D           
CEC8 	M001E           CECA 	M001F           CEE9 	M0020           
CEED 	M0021           CEF5 	M0022           CF10 	M0023           
CF17 	M0024           CF1B 	M0025           CF21 	M0026           
CF40 	M0027           D6A8 	M003            C522 	M0042           
C52C 	M0043           C54E 	M0044           C573 	M0049           
C589 	M004A           C58D 	M004B           C5E8 	M004E           
C5F4 	M004F           C605 	M0050           C606 	M0051           
D748 	M0280           D73A 	M0288           D739 	M0289           
D728 	M028A           D720 	M0300           D71D 	M0301           
D9DA 	M1              CEA7 	M16             D9CD 	M2              
D9F7 	M3              DA1B 	M4              DA29 	M5              
DA82 	M6              C0E0I 	MCI             C0E6I 	MCO             
C0EF 	MCSTS           C0F2 	MIOC            C0F5 	MIOS            
C73B 	MK1             C0ECI 	MLO             F5D4 	MLOC            
	MACRO-80 V3.50	25-Oct-85	Page	S-2
'GRAFIK'

CCED 	MNETB           D0D9 	MODE            C000 	MONITOR         
CE99 	MOUT            CE9B 	MOUT1           CA23I 	MOVE            
DAE7 	MPRAM           C0E3I 	MRI             D048 	MSG2            
CA2A 	MV0             C0E9I 	MWO             CB61 	MX1             
CB64 	MX2             D030 	N               0002 	NDISK           
C920 	NI0             C912 	NIBLE           D0FF 	NRDY            
000B 	NREGS           C94C 	OADR            C951 	OBYTE           
C967 	OCRLF           DAFD 	OKT1            0010 	OP              
0020 	OS              0000 	OT              0030 	OU              
00AE 	P1AC            00AC 	P1AD            00AF 	P1BC            
00AD 	P1BD            C927 	P2C             C8E8 	PA0             
C8ED 	PA1             C906 	PA2             C69D 	PAR             
C8E3 	PARAM           F620 	PBER            C924 	PCHK            
00FE 	PIOAC           00FC 	PIOAD           00FF 	PIOBC           
00FD 	PIOBD           F671 	PIX             D8C5 	PIXEL           
F5E6I 	PLOC            00CF 	PMSK            C89A 	POC             
F66F 	POS             F689 	POS0            F5EF 	POS1            
F5F0 	POS2            F643 	PRAMP           D8F8 	PRBOX           
CC00 	PRINT           CA3B 	Q0              CA57 	Q1              
CA5F 	Q2              CA36 	QUERY           F5E4 	RAMJP           
D140 	RBYTE           D16B 	RDID            7000 	RDSK            
D0FB 	RDY             D120 	RDY1            CA67I 	READ            
D094 	REAHST          D062 	RECAL           CA6E 	RED0            
CA8E 	RED1            CAA5 	RED2            CAAB 	RED3            
CE94 	RELO            F5F1 	RES             D155 	RESL1           
D034 	RESLT           C800I 	RESTR           C197I 	RI              
F5F3 	RIUSR           00F3 	RMSK            F61D 	ROTAT           
D149 	RRSLT           C81E 	RST0            C840 	RST1            
C859 	RST2            C866 	RST3            C834 	RSTA            
C83F 	RSTB            C04A 	RUFZ            D0CC 	RW              
D0D1 	RW1             D0CE 	RW2             D03B 	RWCDE           
D0C6 	RWERR           D099 	RWIT            D0A8 	RWOP            
C65C 	SAVE0           C6BC 	SAVE8           C6CE 	SAVLD           
003E 	SBIT0           0042 	SBIT1           2220 	SBITBC          
0031 	SBITS2          D6C2 	SCRL            F687 	SCROLL          
D0E1 	SDS             0C98 	SDTTON          D0EB 	SEEK            
D03C 	SEKDSK          D03F 	SEKHST          D045 	SEKSEC          
D03D 	SEKTRK          003B 	SENDE           D068 	SENSE           
C49B 	SH1             C498 	SH2             1F80 	SHDTON          
00A4 	SHEAD           C494 	SHIFT           007A 	SIOAC           
0078 	SIOAD           007B 	SIOBC           0079 	SIOBD           
D0F4 	SKBSY           F5DFI 	SLOC            F66C 	SMOD            
C56F 	SPALT1          C569 	SPALTE          D059 	SPEZI           
002F 	SSYN1           0037 	SSYN2           CADB 	ST1             
CADD 	ST2             CAE7 	ST3             D07C 	STAB            
F5CA 	STACK           C057I 	START           C0F8 	STR             
D6EF 	STUP            CABD 	SU0             CAD2 	SU1             
CAB9I 	SUBS            C63A 	SV              C683 	SYN1            
C68B 	SYN2            DAE4 	SYNCA           DAF4 	SYNCB           
C706 	SYNWT           CF37 	T2              CF6F 	T3              
CF7D 	T4              CF6B 	T5              CFE5 	T6              
CE19 	TAB2            DE05 	TABANF          C2C8 	TBCVB           
C2A8 	TBCVZ           0050 	TC              D07E 	TCPLS           
C3E6 	TERM1           C3EE 	TERM2           D692 	TEST            
B000 	TEXT            C174I 	TI              C188 	TI1             
F5E7I 	TLOC            C329I 	TON             C32D 	TON1            
C32F 	TON2            C341 	TON3            C339 	TON4            
C7CA 	TOS             C15B 	TPIOA           C15E 	TPIOB           
D02D 	TRCK            C161 	TSIOA           C168 	TSIOB           
C4AE 	TTAB            CF40 	TXTAB           F641 	TYPE            
D02C 	UNIT            D18F 	UNTEN           DA70 	UPCUP           
DA73 	UPCUP1          D9AC 	UPOKT           DA05 	UPPRG           
F5C2 	USER            CB44 	V1              CB39 	V2              
0001 	V24             C1F8 	V241            CB32I 	VER             
C734 	VERFY           C6CC 	WAIT            D121 	WCOM            
	MACRO-80 V3.50	25-Oct-85	Page	S-3
'GRAFIK'

D124 	WCOM1           C739 	WEITR           C1C8I 	WO              
C1CD 	WO1             F5F6 	WOUSR           CAFB 	WR0             
CB03 	WR1             CB0C 	WR2             CB1B 	WR3             
D043 	WRFLG           D08D 	WRHST1          D086 	WRIHST          
CAF3I 	WRITE           C760 	WRTLD           D042 	WRTYPE          
CB4BI 	X               CB55 	X0              F615 	X1              
F619 	X2              CB80 	X3              CB81 	X4              
CB8A 	X5              CB96 	X6              F68D 	XK              
F5D0I 	XLOC            0280 	XMAX            D805 	XYEIN           
F617 	Y1              F61B 	Y2              F68E 	YK              
F5D2I 	YLOC            00C8 	YMAX            CF98 	Z77             
CFDA 	Z78             CFCA 	Z79             CFA9 	Z7A             
CFA1 	Z7B             CF9D 	Z7C             CFBA 	Z7D             
CFB4 	Z7E             CF87 	Z7F             CBD8 	ZACTL           
F66B 	ZCLS1           F673 	ZCLS2           C565 	ZEIL1           
C55C 	ZEILE           F61E 	ZGADR           DB05 	ZGANF           
F5FC 	ZK              0040 	ZL              CBCBI 	ZR              
000B 	ZREGS           C03DI 	ZS              C042 	ZS1             
C454 	ZY1             C45A 	ZY2             C448 	ZYK1            
C46C 	ZYK2            C46E 	ZYK3            C416 	ZYKL            
0010 	ZZ              



No Fatal error(s)


            
F619 	X2              CB80 	X3           